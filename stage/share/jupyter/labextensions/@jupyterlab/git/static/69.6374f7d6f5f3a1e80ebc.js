"use strict";(self.webpackChunk_jupyterlab_git=self.webpackChunk_jupyterlab_git||[]).push([[69],{8081:(e,t,s)=>{s.r(t),s.d(t,{DiffModel:()=>v,Git:()=>ue,IGitExtension:()=>ge,LoggerContext:()=>hs,NotebookDiff:()=>Is,PlainTextDiff:()=>le,default:()=>xr,logger:()=>cs});var i=s(7894),n=s(2049),r=s(4076),o=s(9268),a=s(5236),l=s(8374),c=s(9762),h=s(393),d=s(40),p=s(3572),m=s(7993),g=s(8918),u=s(1526),f=s(3992),_=s(6271),b=s.n(_),y=s(1840);class v{constructor(e){this._isDisposed=!1,this._challenger=e.challenger,this._filename=e.filename,this._reference=e.reference,this._repositoryPath=e.repositoryPath,this._base=e.base,this._changed=new y.Signal(this)}get changed(){return this._changed}_didContentChange(e,t){return e.label!==t.label||e.source!==t.source||e.updateAt!==t.updateAt}get challenger(){return this._challenger}set challenger(e){this._didContentChange(this._challenger,e)&&(this._challenger=e,this._changed.emit({type:"challenger"}))}get filename(){return this._filename}get reference(){return this._reference}set reference(e){this._didContentChange(this._reference,e)&&(this._reference=e,this._changed.emit({type:"reference"}))}get repositoryPath(){return this._repositoryPath}get base(){return this._base}get hasConflict(){return void 0!==this._base}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,y.Signal.clearData(this))}}var C=s(5918),w=s(8681),k=s.n(w),x=s(3708);const E="CodeMirror-patchgutter";var S;!function(e){e[e.Equal=x.DIFF_EQUAL]="Equal",e[e.Delete=x.DIFF_DELETE]="Delete",e[e.Insert=x.DIFF_INSERT]="Insert"}(S||(S={}));const F=k().Pos,R="http://www.w3.org/2000/svg";class D{constructor(e,t){this.mv=e,this.type=t,this.classes="left"==t?{chunk:"CodeMirror-merge-l-chunk",start:"CodeMirror-merge-l-chunk-start",end:"CodeMirror-merge-l-chunk-end",insert:"CodeMirror-merge-l-inserted",del:"CodeMirror-merge-l-deleted",connect:"CodeMirror-merge-l-connect"}:{chunk:"CodeMirror-merge-r-chunk",start:"CodeMirror-merge-r-chunk-start",end:"CodeMirror-merge-r-chunk-end",insert:"CodeMirror-merge-r-inserted",del:"CodeMirror-merge-r-deleted",connect:"CodeMirror-merge-r-connect"}}init(e,t,s){this.edit=this.mv.edit,(this.edit.state.diffViews||(this.edit.state.diffViews=[])).push(this),this.orig=k()(e,Object.assign(Object.assign({},s),{value:t,readOnly:!this.mv.options.allowEditingOriginals})),"align"==this.mv.options.connect&&(this.edit.state.trackAlignable||(this.edit.state.trackAlignable=new oe(this.edit)),this.orig.state.trackAlignable=new oe(this.orig)),this.lockButton.title=this.edit.phrase("Toggle locked scrolling"),this.orig.state.diffViews=[this];let i=s.chunkClassLocation||"background";"[object Array]"!=Object.prototype.toString.call(i)&&(i=[i]),this.classes.classLocation=i,this.diff=X(q(t),q(s.value),this.mv.options.ignoreWhitespace),this.chunks=Y(this.diff),this.diffOutOfDate=this.dealigned=!1,this.needsScrollSync=null,this.showDifferences=!1!==s.showDifferences}registerEvents(e){this.forceUpdate=D.registerUpdate(this),D.setScrollLock(this,!0,!1),D.registerScroll(this,e)}setShowDifferences(e){(e=!1!==e)!=this.showDifferences&&(this.showDifferences=e,this.forceUpdate("full"))}static setScrollLock(e,t,s){e.lockScroll=t,t&&0!=s&&D.syncScroll(e,!0)&&L(e),(t?k().addClass:k().rmClass)(e.lockButton,"CodeMirror-merge-scrolllock-enabled")}static registerUpdate(e){const t={from:0,to:0,marked:[]},s={from:0,to:0,marked:[]};let i,n=!1;function r(i){D.updating=!0,n=!1,"full"==i&&(e.svg&&re.clear(e.svg),e.copyButtons&&re.clear(e.copyButtons),B(e.edit,t.marked,e.classes),B(e.orig,s.marked,e.classes),t.from=t.to=s.from=s.to=0),N(e),e.showDifferences&&(P(e.edit,e.diff,t,S.Insert,e.classes),P(e.orig,e.diff,s,S.Delete,e.classes)),"align"==e.mv.options.connect&&U(e),L(e),null!=e.needsScrollSync&&D.syncScroll(e,e.needsScrollSync),D.updating=!1}function o(t){D.updating||(e.dealigned=!0,a(t))}function a(e){D.updating||n||(window.clearTimeout(i),!0===e&&(n=!0),i=window.setTimeout(r,!0===e?20:250))}function l(i,n){e.diffOutOfDate||(e.diffOutOfDate=!0,t.from=t.to=s.from=s.to=0),o(n.text.length-1!=n.to.line-n.from.line)}function c(){e.diffOutOfDate=!0,e.dealigned=!0,r("full")}return e.edit.on("change",l),e.orig.on("change",l),e.edit.on("swapDoc",c),e.orig.on("swapDoc",c),"align"===e.mv.options.connect&&(k().on(e.edit.state.trackAlignable,"realign",o),k().on(e.orig.state.trackAlignable,"realign",o)),e.edit.on("viewportChange",(function(){a(!1)})),e.orig.on("viewportChange",(function(){a(!1)})),r(),r}static registerScroll(e,t){e.edit.on("scroll",(function(){D.syncScroll(e,!0)&&L(e)})),e.orig.on("scroll",(function(){D.syncScroll(e,!1)&&L(e),t&&D.syncScroll(t,!0)&&L(t)}))}static syncScroll(e,t){if(e.diffOutOfDate)return e.lockScroll&&null==e.needsScrollSync&&(e.needsScrollSync=t),!1;if(e.needsScrollSync=null,!e.lockScroll)return!0;let s,i;const n=+new Date;if(t?(s=e.edit,i=e.orig):(s=e.orig,i=e.edit),s.state.scrollSetBy==e&&(s.state.scrollSetAt||0)+250>n)return!1;const r=s.getScrollInfo();let o=0;if("align"==e.mv.options.connect)o=r.top;else{const n=.5*r.clientHeight,a=r.top+n,l=s.lineAtHeight(a,"local"),c=function(e,t,s){let i,n,r,o;for(let a=0;a<e.length;a++){const l=e[a],c=s?l.editFrom:l.origFrom,h=s?l.editTo:l.origTo;null==n&&(c>t?(n=l.editFrom,o=l.origFrom):h>t&&(n=l.editTo,o=l.origTo)),h<=t?(i=l.editTo,r=l.origTo):c<=t&&(i=l.editFrom,r=l.origFrom)}return{edit:{before:i,after:n},orig:{before:r,after:o}}}(e.chunks,l,t),h=D.getOffsets(s,t?c.edit:c.orig),d=D.getOffsets(i,t?c.orig:c.edit),p=(a-h.top)/(h.bot-h.top);let m,g;if(o=d.top-n+p*(d.bot-d.top),o>r.top)g=r.top/n,g<1&&(o=o*g+r.top*(1-g));else if(m=r.height-r.clientHeight-r.top,m<n){const e=i.getScrollInfo();e.height-e.clientHeight-o>m&&(g=m/n,g<1&&(o=o*g+(e.height-e.clientHeight-m)*(1-g)))}}return i.scrollTo(r.left,o),i.state.scrollSetAt=n,i.state.scrollSetBy=e,!0}static getOffsets(e,t){let s=t.after;return null==s&&(s=e.lastLine()+1),{top:e.heightAtLine(t.before||0,"local"),bot:e.heightAtLine(s,"local")}}}function N(e){e.diffOutOfDate&&(e.diff=X(e.orig.getValue(),e.edit.getValue(),e.mv.options.ignoreWhitespace),e.chunks=Y(e.diff),e.diffOutOfDate=!1,k().signal(e.edit,"updateDiff",e.diff))}function j(e,t,s){const i=s.classLocation;for(let n=0;n<i.length;n++)e.removeLineClass(t,i[n],s.chunk),e.removeLineClass(t,i[n],s.start),e.removeLineClass(t,i[n],s.end)}function B(e,t,s){for(let i=0;i<t.length;++i){const n=t[i];"clear"in n?n.clear():n.parent&&j(e,n,s)}t.length=0,e.clearGutter(E)}function P(e,t,s,i,n){const r=e.getViewport();e.operation((function(){s.from==s.to||r.from-s.to>20||s.from-r.to>20?(B(e,s.marked,n),O(e,t,i,s.marked,r.from,r.to,n),s.from=r.from,s.to=r.to):(r.from<s.from&&(O(e,t,i,s.marked,r.from,s.from,n),s.from=r.from),r.to>s.to&&(O(e,t,i,s.marked,s.to,r.to,n),s.to=r.to))}))}function M(e,t,s,i,n,r){const o=s.classLocation,a=e.getLineHandle(t);for(let t=0;t<o.length;t++)i&&e.addLineClass(a,o[t],s.chunk),n&&e.addLineClass(a,o[t],s.start),r&&e.addLineClass(a,o[t],s.end);return a}function I(e){const t=document.createElement("div");return t.className=e?"CodeMirror-patchgutter-delete":"CodeMirror-patchgutter-insert",t}function O(e,t,s,i,n,r,o){let a=F(0,0);const l=F(n,0),c=e.clipPos(F(r-1)),h=s==S.Delete?o.del:o.insert;function d(t,a){const l=Math.max(n,t),c=Math.min(r,a);for(let n=l;n<c;++n)i.push(M(e,n,o,!0,n==t,n==a-1)),e.setGutterMarker(n,E,I(s==S.Delete));t==a&&l==a&&c==a&&(l?i.push(M(e,l-1,o,!1,!1,!0)):i.push(M(e,l,o,!1,!0,!1)))}let p=0,m=!1;for(let n=0;n<t.length;++n){const r=t[n],o=r[0],g=r[1];if(o==S.Equal){const e=a.line+(Q(t,n)?0:1);ie(a,g);const s=a.line+(J(t,n)?1:0);s>e&&(m&&(d(p,e),m=!1),p=s)}else if(m=!0,o==s){const t=ie(a,g,!0),s=re.posMax(l,a),n=re.posMin(c,t);re.posEq(s,n)||i.push(e.markText(s,n,{className:h})),a=t}}m&&d(p,a.line+1)}function L(e){if(!e.showDifferences)return;let t=0;e.svg&&(re.clear(e.svg),t=e.gap.offsetWidth,re.attrs(e.svg,"width",t,"height",e.gap.offsetHeight)),e.copyButtons&&re.clear(e.copyButtons);const s=e.edit.getViewport(),i=e.orig.getViewport(),n=e.mv.wrap.getBoundingClientRect().top,r=n-e.edit.getScrollerElement().getBoundingClientRect().top+e.edit.getScrollInfo().top,o=n-e.orig.getScrollerElement().getBoundingClientRect().top+e.orig.getScrollInfo().top;for(let n=0;n<e.chunks.length;n++){const a=e.chunks[n];a.editFrom<=s.to&&a.editTo>=s.from&&a.origFrom<=i.to&&a.origTo>=i.from&&G(e,a,o,r,t)}}function T(e,t){let s=0,i=0;for(let n=0;n<t.length;n++){const r=t[n];if(r.editTo>e&&r.editFrom<=e)return null;if(r.editFrom>e)break;s=r.editTo,i=r.origTo}return i+(e-s)}function A(e,t,s){const i=e.state.trackAlignable;let n=e.firstLine(),r=0;const o=[];for(let e=0;;e++){const a=t[e],l=a?s?a.origFrom:a.editFrom:1e9;for(;r<i.alignable.length;r+=2){const e=i.alignable[r]+1;if(!(e<=n)){if(!(e<=l))break;o.push(e)}}if(!a)break;o.push(n=s?a.origTo:a.editTo)}return o}function H(e,t,s,i){let n=0,r=0,o=0,a=0;e:for(;;n++){const l=e[n],c=t[r];if(!l&&null==c)break;const h=l?l[0]:1e9,d=null==c?1e9:c;for(;o<s.length;){const e=s[o];if(e.origFrom<=d&&e.origTo>d){r++,n--;continue e}if(e.editTo>h){if(e.editFrom<=h)continue e;break}a+=e.origTo-e.origFrom-(e.editTo-e.editFrom),o++}if(h==d-a)l[i]=d,r++;else if(h<d-a)l[i]=h+a;else{const t=[d-a,null,null];t[i]=d,e.splice(n,0,t),r++}}}function U(e,t){if(!e.dealigned&&!t)return;if(!e.orig.curOp)return e.orig.operation((function(){U(e,t)}));e.dealigned=!1;const s=e.mv.left==e?e.mv.right:e.mv.left;s&&(N(s),s.dealigned=!1);const i=function(e,t){const s=A(e.edit,e.chunks,!1),i=[];if(t)for(let e=0,i=0;e<t.chunks.length;e++){const n=t.chunks[e].editTo;for(;i<s.length&&s[i]<n;)i++;i!=s.length&&s[i]==n||s.splice(i++,0,n)}for(let e=0;e<s.length;e++)i.push([s[e],null,null]);return H(i,A(e.orig,e.chunks,!0),e.chunks,1),t&&H(i,A(t.orig,t.chunks,!0),t.chunks,2),i}(e,s),n=e.mv.aligners;for(let e=0;e<n.length;e++)n[e].clear();n.length=0;const r=[e.edit,e.orig],o=[];s&&r.push(s.orig);for(let e=0;e<r.length;e++)o.push(r[e].getScrollInfo().top);for(let e=0;e<i.length;e++)z(r,i[e],n);for(let e=0;e<r.length;e++)r[e].scrollTo(null,o[e])}function z(e,t,s){let i=0;const n=[];for(let s=0;s<e.length;s++)if(null!=t[s]){const r=e[s].heightAtLine(t[s],"local");n[s]=r,i=Math.max(i,r)}for(let r=0;r<e.length;r++)if(null!=t[r]){const o=i-n[r];o>1&&s.push(W(e[r],t[r],o))}}function W(e,t,s){let i=!0;t>e.lastLine()&&(t--,i=!1);const n=document.createElement("div");return n.className="CodeMirror-merge-spacer",n.style.height=s+"px",n.style.minWidth="1px",e.addLineWidget(t,n,{height:s,above:i,mergeSpacer:!0,handleMouseEvents:!0})}function G(e,t,s,i,n){const r="left"==e.type,o=e.orig.heightAtLine(t.origFrom,"local",!0)-s;if(e.svg){let a=o,l=e.edit.heightAtLine(t.editFrom,"local",!0)-i;if(r){const e=a;a=l,l=e}let c=e.orig.heightAtLine(t.origTo,"local",!0)-s,h=e.edit.heightAtLine(t.editTo,"local",!0)-i;if(r){const e=c;c=h,h=e}const d=" C "+n/2+" "+l+" "+n/2+" "+a+" "+(n+2)+" "+a,p=" C "+n/2+" "+c+" "+n/2+" "+h+" -1 "+h;re.attrs(e.svg.appendChild(document.createElementNS(R,"path")),"d","M -1 "+l+d+" L "+(n+2)+" "+c+p+" z","class",e.classes.connect)}if(e.copyButtons){const s=e.copyButtons.appendChild(re.elt("div","left"===e.type?"⇝":"⇜","CodeMirror-merge-copy")),n=e.mv.options.allowEditingOriginals;if(s.title=e.edit.phrase(n?"Push to left":"Revert chunk"),s.chunk=t,s.style.top=(t.origTo>t.origFrom?o:e.edit.heightAtLine(t.editFrom,"local")-i)+"px",n){const s=e.edit.heightAtLine(t.editFrom,"local")-i,n=e.copyButtons.appendChild(re.elt("div","right"==e.type?"⇝":"⇜","CodeMirror-merge-copy-reverse"));n.title="Push to right",n.chunk={editFrom:t.origFrom,editTo:t.origTo,origFrom:t.editFrom,origTo:t.editTo},n.style.top=s+"px","right"==e.type?n.style.left="2px":n.style.right="2px"}}}function $(e,t,s,i){if(e.diffOutOfDate)return;const n=i.origTo>s.lastLine()?F(i.origFrom-1):F(i.origFrom,0),r=F(i.origTo,0),o=i.editTo>t.lastLine()?F(i.editFrom-1):F(i.editFrom,0),a=F(i.editTo,0),l=e.mv.options.revertChunk;l?l(e.mv,s,n,r,t,o,a):t.replaceRange(s.getRange(n,r),o,a)}D.updating=!1;class V{constructor(e,t){this.options=t;const s=null==t.origLeft?t.orig:t.origLeft,i=t.origRight,n=null!=s,r=null!=i,o=1+(n?1:0)+(r?1:0),a=[];let l=this.left=null,c=this.right=null;const h=this;let d=null;n&&(l=this.left=new D(this,"left"),d=re.elt("div",null,"CodeMirror-merge-pane CodeMirror-merge-left"),a.push(d),a.push(Z(l)));const p=re.elt("div",null,"CodeMirror-merge-pane CodeMirror-merge-editor");a.push(p);let m=null;r&&(c=this.right=new D(this,"right"),a.push(Z(c)),m=re.elt("div",null,"CodeMirror-merge-pane CodeMirror-merge-right"),a.push(m)),(r?m:p).className+=" CodeMirror-merge-pane-rightmost",a.push(re.elt("div",null,null,"height: 0; clear: both;"));const g=this.wrap=e.appendChild(re.elt("div",a,"CodeMirror-merge CodeMirror-merge-"+o+"pane"));if(this.edit=k()(p,Object.assign({},t)),this.edit.getOption("gutters").indexOf(E)<0){const e=[];this.edit.getOption("lineNumbers")&&e.push("CodeMirror-linenumbers"),e.push(E),this.edit.setOption("gutters",e),t.gutters=e}l&&l.init(d,s,t),c&&c.init(m,i,t),t.collapseIdentical&&this.editor().operation((function(){!function(e,t){"number"!=typeof t&&(t=2);const s=[],i=e.editor(),n=i.firstLine();for(let e=n,t=i.lastLine();e<=t;e++)s.push(!0);e.left&&se(e.left,t,n,s),e.right&&se(e.right,t,n,s);for(let r=0;r<s.length;r++)if(s[r]){const o=r+n;let a=0;for(a=1;r<s.length-1&&s[r+1];r++,a++);if(a>t){const t=[{line:o,cm:i}];e.left&&t.push({line:T(o,e.left.chunks),cm:e.left.orig}),e.right&&t.push({line:T(o,e.right.chunks),cm:e.right.orig});const s=te(a,t);e.options.onCollapse&&e.options.onCollapse(e,o,a,s)}}}(h,t.collapseIdentical)})),"align"==t.connect&&(this.aligners=[],U(this.left||this.right,!0)),l&&l.registerEvents(c),c&&c.registerEvents(l);const u=function(){l&&L(l),c&&L(c)};k().on(window,"resize",u);const f=setInterval((function(){let e=null;for(e=g.parentNode;e&&e!==document.body;e=e.parentNode);e||(clearInterval(f),k().off(window,"resize",u))}),5e3)}editor(){return this.edit}rightOriginal(){return this.right&&this.right.orig}leftOriginal(){return this.left&&this.left.orig}setShowDifferences(e){this.right&&this.right.setShowDifferences(e),this.left&&this.left.setShowDifferences(e)}rightChunks(){if(this.right)return N(this.right),this.right.chunks}leftChunks(){if(this.left)return N(this.left),this.left.chunks}}function Z(e){const t=e.lockButton=re.elt("div",null,"CodeMirror-merge-scrolllock"),s=re.elt("div",[t],"CodeMirror-merge-scrolllock-wrap");k().on(t,"click",(function(){D.setScrollLock(e,!e.lockScroll)}));const i=[s];if(!1!==e.mv.options.revertButtons&&(e.copyButtons=re.elt("div",null,"CodeMirror-merge-copybuttons-"+e.type),k().on(e.copyButtons,"click",(function(t){const s=t.target||t.srcElement;s.chunk&&("CodeMirror-merge-copy-reverse"!=s.className?$(e,e.edit,e.orig,s.chunk):$(e,e.orig,e.edit,s.chunk))})),i.unshift(e.copyButtons)),"align"!=e.mv.options.connect){let t=document.createElementNS&&document.createElementNS(R,"svg");t&&!t.createSVGRect&&(t=null),e.svg=t,t&&i.push(t)}return e.gap=re.elt("div",i,"CodeMirror-merge-gap")}function q(e){return"string"==typeof e?e:e.getValue()}let K;function X(e,t,s){K||(K=new x.diff_match_patch);const i=K.diff_main(e,t);K.diff_cleanupSemantic(i);for(let e=0;e<i.length;++e){const t=i[e];(s?/[^ \t]/.test(t[1]):t[1])?e&&i[e-1][0]==t[0]&&(i.splice(e--,1),i[e][1]+=t[1]):i.splice(e--,1)}return i}function Y(e){const t=[];if(!e.length)return t;let s=0,i=0;const n=F(0,0),r=F(0,0);for(let o=0;o<e.length;++o){const a=e[o],l=a[0];if(l==S.Equal){const l=!Q(e,o)||n.line<s||r.line<i?1:0,c=n.line+l,h=r.line+l;ie(n,a[1],null,r);const d=J(e,o)?1:0,p=n.line+d,m=r.line+d;p>c&&(o&&t.push({origFrom:i,origTo:h,editFrom:s,editTo:c}),s=p,i=m)}else ie(l==S.Insert?n:r,a[1])}return(s<=n.line||i<=r.line)&&t.push({origFrom:i,origTo:r.line+1,editFrom:s,editTo:n.line+1}),t}function J(e,t){if(t===e.length-1)return!0;let s=e[t+1][1];return!(1===s.length&&t<e.length-2||10!==s.charCodeAt(0)||t!==e.length-2&&(s=e[t+2][1],!(s.length>1||t==e.length-3)||10!==s.charCodeAt(0)))}function Q(e,t){if(0===t)return!0;let s=e[t-1][1];return 10==s.charCodeAt(s.length-1)&&(1==t||(s=e[t-2][1],10==s.charCodeAt(s.length-1)))}function ee(e,t,s){e.addLineClass(t,"wrap","CodeMirror-merge-collapsed-line");const i=document.createElement("span");i.className="CodeMirror-merge-collapsed-widget",i.title=e.phrase("Identical text collapsed. Click to expand.");const n=e.markText(F(t,0),F(s-1),{inclusiveLeft:!0,inclusiveRight:!0,replacedWith:i,clearOnEnter:!0});function r(){n.clear(),e.removeLineClass(t,"wrap","CodeMirror-merge-collapsed-line")}return n.explicitlyCleared&&r(),k().on(i,"click",r),n.on("clear",r),k().on(i,"click",r),{mark:n,clear:r}}function te(e,t){const s=[];function i(){for(let e=0;e<s.length;e++)s[e].clear()}for(let n=0;n<t.length;n++){const r=t[n],o=ee(r.cm,r.line,r.line+e);s.push(o),o.mark.on("clear",i)}return s[0].mark}function se(e,t,s,i){for(let n=0;n<e.chunks.length;n++){const r=e.chunks[n];for(let e=r.editFrom-t;e<r.editTo+t;e++){const t=e+s;t>=0&&t<i.length&&(i[t]=!1)}}}function ie(e,t,s,i){const n=s?F(e.line,e.ch):e;let r=0;for(;;){const e=t.indexOf("\n",r);if(-1==e)break;++n.line,i&&++i.line,r=e+1}return n.ch=(r?0:n.ch)+(t.length-r),i&&(i.ch=(r?0:i.ch)+(t.length-r)),n}var ne,re;!function(e){e[e.F_WIDGET=1]="F_WIDGET",e[e.F_WIDGET_BELOW=2]="F_WIDGET_BELOW",e[e.F_MARKER=4]="F_MARKER"}(ne||(ne={}));class oe{constructor(e){this.cm=e,this.alignable=[],this.height=e.doc.height;const t=this;e.on("markerAdded",(function(e,s){if(!s.collapsed)return;const i=s.find(1);null!=i&&t.set(i.line,ne.F_MARKER)})),e.on("markerCleared",(function(e,s,i,n){null!==n&&s.collapsed&&t.check(n,ne.F_MARKER,t.hasMarker)})),e.on("markerChanged",this.signal.bind(this)),e.on("lineWidgetAdded",(function(e,s,i){s.mergeSpacer||(s.above?t.set(i-1,ne.F_WIDGET_BELOW):t.set(i,ne.F_WIDGET))})),e.on("lineWidgetCleared",(function(e,s,i){s.mergeSpacer||(s.above?t.check(i-1,ne.F_WIDGET_BELOW,t.hasWidgetBelow):t.check(i,ne.F_WIDGET,t.hasWidget))})),e.on("lineWidgetChanged",this.signal.bind(this)),e.on("change",(function(e,s){const i=s.from.line,n=s.to.line-s.from.line,r=s.text.length-1,o=i+r;(n||r)&&t.map(i,n,r),t.check(o,ne.F_MARKER,t.hasMarker),(n||r)&&t.check(s.from.line,ne.F_MARKER,t.hasMarker)})),e.on("viewportChange",(function(){t.cm.doc.height!==t.height&&t.signal()}))}signal(){k().signal(this,"realign"),this.height=this.cm.doc.height}set(e,t){let s=-1;for(;s<this.alignable.length;s+=2){const i=this.alignable[s]-e;if(0==i){if((this.alignable[s+1]&t)==t)return;return this.alignable[s+1]|=t,void this.signal()}if(i>0)break}this.signal(),this.alignable.splice(s,0,e,t)}find(e){for(let t=0;t<this.alignable.length;t+=2)if(this.alignable[t]==e)return t;return-1}check(e,t,s){const i=this.find(e);if(-1!=i&&this.alignable[i+1]&t&&!s.call(this,e)){this.signal();const e=this.alignable[i+1]&~t;e?this.alignable[i+1]=e:this.alignable.splice(i,2)}}hasMarker(e){const t=this.cm.getLineHandle(e);if(t.markedSpans)for(let e=0;e<t.markedSpans.length;e++)if(t.markedSpans[e].marker.collapsed&&null!==t.markedSpans[e].to)return!0;return!1}hasWidget(e){const t=this.cm.getLineHandle(e);if(t.widgets)for(let e=0;e<t.widgets.length;e++)if(!t.widgets[e].above&&!t.widgets[e].mergeSpacer)return!0;return!1}hasWidgetBelow(e){if(e==this.cm.lastLine())return!1;const t=this.cm.getLineHandle(e+1);if(t.widgets)for(let e=0;e<t.widgets.length;e++)if(t.widgets[e].above&&!t.widgets[e].mergeSpacer)return!0;return!1}map(e,t,s){const i=s-t,n=e+t;let r=-1,o=-1;for(let t=0;t<this.alignable.length;t+=2){const s=this.alignable[t];s==e&&this.alignable[t+1]&ne.F_WIDGET_BELOW&&(r=t),s==n&&this.alignable[t+1]&ne.F_WIDGET_BELOW&&(o=t),s<=e||(s<n?this.alignable.splice(t--,2):this.alignable[t]+=i)}if(r>-1){const e=this.alignable[r+1];e==ne.F_WIDGET_BELOW?this.alignable.splice(r,2):this.alignable[r+1]=e&~ne.F_WIDGET_BELOW}o>-1&&s&&this.set(e+s,ne.F_WIDGET_BELOW)}}k().commands.goNextDiff=function(e){return re.goNearbyDiff(e,1)},k().commands.goPrevDiff=function(e){return re.goNearbyDiff(e,-1)},function(e){function t(e,t,s){for(let i=e.length-1;i>=0;i--){const n=e[i],r=(s?n.origTo:n.editTo)-1;if(r<t)return r}}function s(e,t,s){for(let i=0;i<e.length;i++){const n=e[i],r=s?n.origFrom:n.editFrom;if(r>t)return r}}e.elt=function(e,t,s,i){const n=document.createElement(e);if(s&&(n.className=s),i&&(n.style.cssText=i),"string"==typeof t)n.appendChild(document.createTextNode(t));else if(t)for(let e=0;e<t.length;++e)n.appendChild(t[e]);return n},e.clear=function(e){for(let t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild)},e.attrs=function(e,...t){for(let s=1;s<t.length;s+=2)e.setAttribute(t[s],t[s+1])},e.posMin=function(e,t){return(e.line-t.line||e.ch-t.ch)<0?e:t},e.posMax=function(e,t){return(e.line-t.line||e.ch-t.ch)>0?e:t},e.posEq=function(e,t){return e.line==t.line&&e.ch==t.ch},e.goNearbyDiff=function(e,i){let n=null;const r=e.state.diffViews,o=e.getCursor().line;if(r)for(let a=0;a<r.length;a++){const l=r[a],c=e==l.orig;N(l);const h=i<0?t(l.chunks,o,c):s(l.chunks,o,c);null==h||null!=n&&!(i<0?h>n:h<n)||(n=h)}if(null==n)return k().Pass;e.setCursor(n,0)}}(re||(re={}));const ae=async(e,t,s)=>{const i=new le(e,s.load("jupyterlab_git"));return await i.ready,i};class le extends f.Widget{constructor(e,t){var s,i,n;super({node:le.createNode(e.reference.label,null===(s=e.base)||void 0===s?void 0:s.label,e.challenger.label)}),this._reference=null,this._challenger=null,this._base=null;const r=new u.PromiseDelegate;this._isReady=r.promise,this._container=this.node.lastElementChild,this._model=e,this._trans=null!=t?t:d.nullTranslator.load("jupyterlab_git"),this._translations={"Control character":this._trans.__("Control character"),"Selection deleted":this._trans.__("Selection deleted"),"Folded lines":this._trans.__("Folded lines"),"Unfolded lines":this._trans.__("Unfolded lines"),to:this._trans.__("to"),"folded code":this._trans.__("folded code"),unfold:this._trans.__("unfold"),"Fold line":this._trans.__("Fold line"),"Unfold line":this._trans.__("Unfold line"),"Go to line":this._trans.__("Go to line"),go:this._trans.__("go"),Find:this._trans.__("Find"),Replace:this._trans.__("Replace"),next:this._trans.__("next"),previous:this._trans.__("previous"),all:this._trans.__("all"),"match case":this._trans.__("match case"),replace:this._trans.__("replace"),"replace all":this._trans.__("replace all"),close:this._trans.__("close"),"current match":this._trans.__("current match"),"replaced $ matches":this._trans.__("replaced $ matches"),"replaced match on line $":this._trans.__("replaced match on line $"),"on line":this._trans.__("on line"),"Identical text collapsed. Click to expand.":this._trans.__("Identical text collapsed. Click to expand."),"Toggle locked scrolling":this._trans.__("Toggle locked scrolling"),"Push to left":this._trans.__("Push to left"),"Revert chunk":this._trans.__("Revert chunk")},Promise.all([this._model.reference.content(),this._model.challenger.content(),null!==(n=null===(i=this._model.base)||void 0===i?void 0:i.content())&&void 0!==n?n:Promise.resolve(null)]).then((([e,t,s])=>{this._reference=e,this._challenger=t,this._base=s,r.resolve()})).catch((e=>{this.showError(e),r.resolve()}))}get _hasConflict(){return this._model.hasConflict}get isFileResolved(){return!0}get model(){return this._model}get ready(){return this._isReady}getResolvedFile(){var e,t;const s=null!==(t=null===(e=this._mergeView)||void 0===e?void 0:e.editor().getValue())&&void 0!==t?t:null;return null!==s?Promise.resolve({type:"file",format:"text",content:s}):Promise.reject(this._trans.__("Failed to get a valid file value."))}onAfterAttach(){this.ready.then((()=>{null!==this._challenger&&null!==this._reference&&this.createDiffView(this._challenger,this._reference,this._translations,this._hasConflict?this._base:null)})).catch((e=>{this.showError(e)}))}onBeforeDetach(){this._container.innerHTML=""}async refresh(){var e,t;await this.ready;try{this._container.innerHTML="",this._mergeView=null,null!==this._reference&&(this._reference=await this._model.reference.content()),null!==this._challenger&&(this._challenger=await this._model.challenger.content()),null!==this._base&&(this._base=null!==(t=await(null===(e=this._model.base)||void 0===e?void 0:e.content()))&&void 0!==t?t:null),this.createDiffView(this._challenger,this._reference,this._translations,this._hasConflict?this._base:null),this._challenger=null,this._reference=null,this._base=null}catch(e){this.showError(e)}}static createNode(...e){const t=void 0!==e[1]?"jp-git-merge-banner":"jp-git-diff-banner",s=document.createElement("div");return s.className="jp-git-diff-root",s.innerHTML=`\n    <div class="${t}">\n      ${e.filter((e=>!!e)).map((e=>`<span>${e}</span>`)).join('<span class="jp-spacer"></span>')}\n    </div>\n    <div class="jp-git-PlainText-diff"></div>`,s}async createDiffView(e,t,s,i){if(!this._mergeView){const n=C.Mode.findByFileName(this._model.filename)||C.Mode.findBest(this._model.filename);let r=Object.assign({value:e,orig:t,mode:n.mime,phrases:s},this.getDefaultOptions());null!=i&&(r=Object.assign(Object.assign({},r),{origLeft:t,value:i,origRight:e,readOnly:!1,revertButtons:!0})),this._mergeView=function(e,t){return new V(e,t)}(this._container,r)}return Promise.resolve()}showError(e){var t;console.error(this._trans.__("Failed to load file diff."),e,null===(t=e)||void 0===t?void 0:t.traceback);const s=(e.message||e).replace("\n","<br />");this.node.innerHTML=`<p class="jp-git-diff-error">\n      <span>${this._trans.__("Error Loading File Diff:")}</span>\n      <span class="jp-git-diff-error-message">${s}</span>\n    </p>`}getDefaultOptions(){return{lineNumbers:!0,theme:"jupyter",connect:"align",collapseIdentical:!0,readOnly:!0,revertButtons:!1}}}var ce=s(8196),he=s.n(ce),de=s(6101),pe=s(6078),me=s(189);const ge=new u.Token("jupyter.extensions.git_plugin");var ue,fe,_e,be;!function(e){let t;!function(e){let t;!function(e){e[e.WORKING=0]="WORKING",e[e.INDEX=1]="INDEX",e[e.BASE=2]="BASE"}(t=e.SpecialRef||(e.SpecialRef={}))}(t=e.Diff||(e.Diff={}));class s extends me.ServerConnection.ResponseError{constructor(e,t=`Invalid response: ${e.status} ${e.statusText}`,s="",i={}){super(e,t),this.traceback=s,this._json=i}get json(){return this._json}}e.GitResponseError=s;class i extends Error{constructor(){super("Not in a Git Repository")}}e.NotInRepository=i}(ue||(ue={})),function(e){e[e.SUCCESS=10]="SUCCESS",e[e.INFO=20]="INFO",e[e.RUNNING=30]="RUNNING",e[e.WARNING=40]="WARNING",e[e.ERROR=50]="ERROR"}(fe||(fe={})),function(e){e.gitCommitAmendStaged="git:context-commitAmendStaged",e.gitFileAdd="git:context-add",e.gitFileDiff="git:context-diff",e.gitFileDiscard="git:context-discard",e.gitFileDelete="git:context-delete",e.gitFileOpen="git:context-open",e.gitFileUnstage="git:context-unstage",e.gitFileStage="git:context-stage",e.gitFileTrack="git:context-track",e.gitFileHistory="git:context-history",e.gitIgnore="git:context-ignore",e.gitIgnoreExtension="git:context-ignoreExtension",e.gitNoAction="git:no-action",e.openFileFromDiff="git:open-file-from-diff"}(_e||(_e={})),function(e){e.gitUI="git:ui",e.gitTerminalCommand="git:terminal-command",e.gitInit="git:init",e.gitOpenUrl="git:open-url",e.gitToggleSimpleStaging="git:toggle-simple-staging",e.gitToggleDoubleClickDiff="git:toggle-double-click-diff",e.gitManageRemote="git:manage-remote",e.gitClone="git:clone",e.gitMerge="git:merge",e.gitOpenGitignore="git:open-gitignore",e.gitPush="git:push",e.gitPull="git:pull",e.gitResetToRemote="git:reset-to-remote",e.gitSubmitCommand="git:submit-commit",e.gitShowDiff="git:show-diff"}(be||(be={}));const ye=["Invalid username or password","could not read Username","could not read Password"];async function ve(e="",t="GET",s=null,i="git"){const n=me.ServerConnection.makeSettings(),r=p.URLExt.join(n.baseUrl,i,e),o={method:t,body:s?JSON.stringify(s):void 0};let a;try{a=await me.ServerConnection.makeRequest(r,o,n)}catch(e){throw new me.ServerConnection.NetworkError(e)}let l=await a.text(),c=!1;if(l.length>0)try{l=JSON.parse(l),c=!0}catch(e){console.log("Not a JSON response body.",a)}if(!a.ok){if(c){const{message:e,traceback:t}=l,s=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(s[i[n]]=e[i[n]])}return s}(l,["message","traceback"]);throw new ue.GitResponseError(a,e||`Invalid response: ${a.status} ${a.statusText}`,t||"",s)}throw new ue.GitResponseError(a,l)}return l}var Ce=s(8908);class we{constructor(e){this._isDisposed=!1,this._taskList=new Ce.LinkedList,this._taskChanged=new y.Signal(e)}get isDisposed(){return this._isDisposed}get taskChanged(){return this._taskChanged}add(e){const t=this._generateTaskID();return this._taskList.addLast({id:t,task:e}),1===this._taskList.length&&this._taskChanged.emit(e),t}dispose(){this.isDisposed||(this._isDisposed=!0,y.Signal.clearData(this))}async execute(e,t){const s=this.add(e);try{return await t()}finally{this.remove(s)}}remove(e){let t=this._taskList.firstNode;if((null==t?void 0:t.value.id)===e)this._taskList.removeNode(t);else for(;t.next;)if(t=t.next,t.value&&t.value.id===e){this._taskList.removeNode(t);break}0===this._taskList.length?this._taskChanged.emit("empty"):this._taskChanged.emit(this._taskList.first.task)}_generateTaskID(){return u.UUID.uuid4()}}function ke(e,t){var s;return(null!==(s={D:["D","U"],A:["U","A"],U:["D","A","U"]}[e])&&void 0!==s?s:[]).includes(t)?"unmerged":"?"===e&&"?"===t?"untracked":" "!==e?" "!==t?"partially-staged":"staged":" "!==t?"unstaged":null}const xe=e=>(t,s)=>(i,n,r)=>async o=>{var a;if(o.stopPropagation(),n)try{e.execute(_e.gitFileDiff,{files:[{filePath:i,previousFilePath:r,isText:n,context:{previousRef:null!==(a=null==s?void 0:s.commit)&&void 0!==a?a:t.pre_commits[0],currentRef:t.commit}}]})}catch(e){console.error(`Failed to open diff view for ${i}.\n${e}`)}},Ee={};function Se(e){var t,s;return null===(s=Ee[null===(t=p.PathExt.extname(e))||void 0===t?void 0:t.toLocaleLowerCase()])||void 0===s?void 0:s.callback}class Fe{constructor(e=null,t=null,s){this._fetchRemotes=async()=>{if(!this.credentialsRequired)try{await this.fetch()}catch(e){console.error("Failed to fetch remotes",e),ye.some((t=>e.message.indexOf(t)>-1))&&(this.credentialsRequired=!0)}},this._refreshModel=async()=>{await this._taskHandler.execute("git:refresh",(async()=>{try{await this.refreshBranch(),await this.refreshStatus(),await this.checkRemoteChangeNotified()}catch(e){console.error("Failed to refresh git status",e)}}))},this._refreshStandby=()=>!(null!==this.pathRepository&&!this._standbyCondition())||"when-hidden",this._pathRepository=null,this._branches=[],this._currentBranch=null,this._isDisposed=!1,this._markerCache=new De((()=>this._markChanged.emit())),this.__currentMarker=null,this._readyPromise=Promise.resolve(),this._pendingReadyPromise=0,this._standbyCondition=()=>!1,this._remoteChangedFiles=[],this._changeUpstreamNotified=[],this._selectedHistoryFile=null,this._hasDirtyFiles=!1,this._credentialsRequired=!1,this._statusForDirtyState=["staged","partially-staged"],this._branchesChanged=new y.Signal(this),this._headChanged=new y.Signal(this),this._markChanged=new y.Signal(this),this._selectedHistoryFileChanged=new y.Signal(this),this._repositoryChanged=new y.Signal(this),this._statusChanged=new y.Signal(this),this._notifyRemoteChanges=new y.Signal(this),this._dirtyFilesStatusChanged=new y.Signal(this),this._credentialsRequiredChanged=new y.Signal(this),this._docmanager=e,this._docRegistry=t,this._settings=s||null,this._taskHandler=new we(this),this._clearStatus(),this._statusPoll=new pe.Poll({factory:this._refreshModel,frequency:{interval:3e3,backoff:!0,max:3e5},standby:this._refreshStandby}),this._fetchPoll=new pe.Poll({auto:!1,factory:this._fetchRemotes,frequency:{interval:3e3,backoff:!0,max:3e5},standby:this._refreshStandby}),s&&(s.changed.connect(this._onSettingsChange,this),this._onSettingsChange(s))}get branches(){return this._branches}get currentBranch(){return this._currentBranch}get isDisposed(){return this._isDisposed}get isReady(){return 0===this._pendingReadyPromise}get ready(){return this._readyPromise}get pathRepository(){return this._pathRepository}set pathRepository(e){const t={name:"pathRepository",newValue:null,oldValue:this._pathRepository};if(null===e)this._pendingReadyPromise+=1,this._readyPromise.then((()=>{this._pathRepository=null,this._pendingReadyPromise-=1,t.newValue!==t.oldValue&&this.refresh().then((()=>this._repositoryChanged.emit(t)))}));else{const s=this._readyPromise;this._pendingReadyPromise+=1;const i=e;this._readyPromise=Promise.all([s,this.showPrefix(i)]).then((([e,s])=>{null!==s&&(s=i.slice(0,Math.max(0,i.length-s.length))),t.newValue=this._pathRepository=s,t.newValue!==t.oldValue&&this.refresh().then((()=>this._repositoryChanged.emit(t))),this._pendingReadyPromise-=1})).catch((e=>{this._pendingReadyPromise-=1,console.error(`Fail to find Git top level for path ${i}.\n${e}`)}))}}get refreshStandbyCondition(){return this._standbyCondition}set refreshStandbyCondition(e){this._standbyCondition=e}get selectedHistoryFile(){return this._selectedHistoryFile}set selectedHistoryFile(e){this._selectedHistoryFile!==e&&(this._selectedHistoryFile=e,this._selectedHistoryFileChanged.emit(e))}get status(){return this._status}get branchesChanged(){return this._branchesChanged}get headChanged(){return this._headChanged}get markChanged(){return this._markChanged}get selectedHistoryFileChanged(){return this._selectedHistoryFileChanged}get repositoryChanged(){return this._repositoryChanged}get statusChanged(){return this._statusChanged}get taskChanged(){return this._taskHandler.taskChanged}get notifyRemoteChanges(){return this._notifyRemoteChanges}get hasDirtyFiles(){return this._hasDirtyFiles}set hasDirtyFiles(e){this._hasDirtyFiles!==e&&(this._hasDirtyFiles=e,this._dirtyFilesStatusChanged.emit(e))}get dirtyFilesStatusChanged(){return this._dirtyFilesStatusChanged}get credentialsRequired(){return this._credentialsRequired}set credentialsRequired(e){this._credentialsRequired!==e&&(this._credentialsRequired=e,this._credentialsRequiredChanged.emit(e))}get credentialsRequiredChanged(){return this._credentialsRequiredChanged}get _currentMarker(){return this.__currentMarker||this._setMarker(this.pathRepository,this._currentBranch?this._currentBranch.name:""),this.__currentMarker}async add(...e){const t=await this._getPathRepository();await this._taskHandler.execute("git:add:files",(async()=>{await ve(p.URLExt.join(t,"add"),"POST",{add_all:!e,filename:e||""})})),await this.refreshStatus()}getFile(e){if(null===this.pathRepository)return null;const t=this._status.files.find((t=>this.getRelativeFilePath(t.to)===e));if(t)return t;{const t=p.PathExt.relative("/"+this.pathRepository,"/"+e);return t.startsWith("../")?null:{x:"",y:"",to:t,from:"",is_binary:null,status:"unmodified",type:this._resolveFileType(e)}}}async addAllUnstaged(){const e=await this._getPathRepository();await this._taskHandler.execute("git:add:files:all_unstaged",(async()=>{await ve(p.URLExt.join(e,"add_all_unstaged"),"POST")})),await this.refreshStatus()}async addAllUntracked(){const e=await this._getPathRepository();await this._taskHandler.execute("git:add:files:all_untracked",(async()=>{await ve(p.URLExt.join(e,"add_all_untracked"),"POST")})),await this.refreshStatus()}async addRemote(e,t){const s=await this._getPathRepository();await this._taskHandler.execute("git:add:remote",(async()=>{await ve(p.URLExt.join(s,"remote","add"),"POST",{url:e,name:t})}))}async getRemotes(){const e=await this._getPathRepository();return(await this._taskHandler.execute("git:show:remote",(async()=>await ve(p.URLExt.join(e,"remote","show"),"GET")))).remotes}async removeRemote(e){const t=await this._getPathRepository();await this._taskHandler.execute("git:remove:remote",(async()=>{await ve(p.URLExt.join(t,"remote",e),"DELETE")}))}async allHistory(e=25){const t=await this._getPathRepository();return await this._taskHandler.execute("git:fetch:history",(async()=>await ve(p.URLExt.join(t,"all_history"),"POST",{history_count:e})))}async checkout(e){const t=await this._getPathRepository(),s={checkout_branch:!1,new_check:!1,branchname:"",startpoint:"",checkout_all:!0,filename:""};void 0!==e&&(e.branchname?(s.branchname=e.branchname,s.checkout_branch=!0,s.new_check=!0===e.newBranch,e.newBranch&&(s.startpoint=e.startpoint||this._currentBranch.name)):e.filename&&(s.filename=e.filename,s.checkout_all=!1));const i=await this._taskHandler.execute("git:checkout",(async()=>{var e;let i;s.new_check||(i=s.checkout_branch&&!s.new_check?await this._changedFiles(this._currentBranch.name,s.branchname):s.filename?{files:[s.filename]}:await this._changedFiles("WORKING","HEAD"));const n=await ve(p.URLExt.join(t,"checkout"),"POST",s);return null===(e=null==i?void 0:i.files)||void 0===e||e.forEach((e=>this._revertFile(e))),n}));return s.checkout_branch?await this.refreshBranch():await this.refreshStatus(),i}async merge(e){const t=await this._getPathRepository();return this._taskHandler.execute("git:merge",(()=>ve(p.URLExt.join(t,"merge"),"POST",{branch:e})))}async clone(e,t,s,i=!0,n=!1){return await this._taskHandler.execute("git:clone",(async()=>await ve(p.URLExt.join(e,"clone"),"POST",{clone_url:t,versioning:i,submodules:n,auth:s})))}async commit(e,t=!1){const s=await this._getPathRepository();await this._taskHandler.execute("git:commit:create",(async()=>{await ve(p.URLExt.join(s,"commit"),"POST",{commit_msg:e,amend:t})})),await this.refresh()}async config(e){const t=await this._getPathRepository();return await this._taskHandler.execute("git:config:"+(e?"set":"get"),(async()=>{if(!e)return await ve(p.URLExt.join(t,"config"),"POST");await ve(p.URLExt.join(t,"config"),"POST",{options:e})}))}async deleteBranch(e){const t=await this._getPathRepository();await this._taskHandler.execute("git:branch:delete",(async()=>await ve(p.URLExt.join(t,"branch","delete"),"POST",{branch:e})))}async detailedLog(e){const t=await this._getPathRepository(),s=await this._taskHandler.execute("git:fetch:commit_log",(async()=>await ve(p.URLExt.join(t,"detailed_log"),"POST",{selected_hash:e})));return s.modified_files=s.modified_files.map((e=>(e.type=this._resolveFileType(e.modified_file_path),e))),s}async diff(e,t){const s=await this._getPathRepository(),i=await this._taskHandler.execute("git:diff",(async()=>await ve(p.URLExt.join(s,"diff"),"POST",{previous:e,current:t})));return i.result=i.result.map((e=>(e.filetype=this._resolveFileType(e.filename),e))),i}dispose(){this.isDisposed||(this._isDisposed=!0,this._fetchPoll.dispose(),this._statusPoll.dispose(),this._taskHandler.dispose(),this._settings.changed.disconnect(this._onSettingsChange,this),y.Signal.clearData(this))}async ensureGitignore(){const e=await this._getPathRepository();await ve(p.URLExt.join(e,"ignore"),"POST",{}),this._openGitignore(),await this.refreshStatus()}async fetch(e){const t=await this._getPathRepository();return this._taskHandler.execute("git:fetch:remote",(async()=>await ve(p.URLExt.join(t,"remote","fetch"),"POST",{auth:e})))}getRelativeFilePath(e){return null===this.pathRepository?null:p.PathExt.join(this.pathRepository,null!=e?e:"")}async ignore(e,t){const s=await this._getPathRepository();await ve(p.URLExt.join(s,"ignore"),"POST",{file_path:e,use_extension:t}),this._openGitignore(),await this.refreshStatus()}async init(e){await this._taskHandler.execute("git:init",(async()=>{await ve(p.URLExt.join(e,"init"),"POST")}))}async log(e=25){const t=await this._getPathRepository();return await this._taskHandler.execute("git:fetch:log",(async()=>{var s;return await ve(p.URLExt.join(t,"log"),"POST",{history_count:e,follow_path:null===(s=this.selectedHistoryFile)||void 0===s?void 0:s.to})}))}async pull(e){var t,s;const i=await this._getPathRepository(),n=null===(t=this._currentBranch)||void 0===t?void 0:t.top_commit,r=await this._taskHandler.execute("git:pull",(async()=>{var t;return await ve(p.URLExt.join(i,"pull"),"POST",{auth:e,cancel_on_conflict:(null===(t=this._settings)||void 0===t?void 0:t.composite.cancelPullMergeConflict)||!1})})),o=await this._changedFiles(n,"HEAD");return null===(s=null==o?void 0:o.files)||void 0===s||s.forEach((e=>this._revertFile(e))),await this.refreshBranch(),r}async push(e,t=!1,s){const i=await this._getPathRepository(),n=this._taskHandler.execute("git:push",(async()=>await ve(p.URLExt.join(i,"push"),"POST",{auth:e,force:t,remote:s})));return this.refreshBranch(),n}async refresh(){await this._statusPoll.refresh(),await this._statusPoll.tick}async refreshBranch(){var e,t;try{const s=await this._taskHandler.execute("git:refresh:branches",(async()=>await this._branch()));let i=!1;i=this._currentBranch&&s?this._currentBranch.name!==s.current_branch.name||this._currentBranch.top_commit!==s.current_branch.top_commit:this._currentBranch!==s.current_branch;const n=!u.JSONExt.deepEqual(this._branches,null!==(e=s.branches)&&void 0!==e?e:[]);this._branches=null!==(t=s.branches)&&void 0!==t?t:[],this._currentBranch=s.current_branch,this._currentBranch&&this._setMarker(this.pathRepository,this._currentBranch.name),i&&this._headChanged.emit(),n&&this._branchesChanged.emit();this._branches.some((e=>e.is_remote_branch))?this._fetchPoll.start():this._fetchPoll.stop()}catch(e){const t=this._branches.length>0,s=null!==this._currentBranch;if(this._branches=[],this._currentBranch=null,this._fetchPoll.stop(),s&&this._headChanged.emit(),t&&this._branchesChanged.emit(),!(e instanceof ue.NotInRepository))throw e}}async refreshStatus(){var e;let t;try{t=await this._getPathRepository()}catch(e){if(this._clearStatus(),!(e instanceof ue.NotInRepository))throw e;return}try{const s=await this._taskHandler.execute("git:refresh:status",(async()=>await ve(p.URLExt.join(t,"status"),"POST"))),i=null===(e=s.files)||void 0===e?void 0:e.map((e=>Object.assign(Object.assign({},e),{status:ke(e.x,e.y),type:this._resolveFileType(e.to)})));this._setStatus({branch:s.branch||null,remote:s.remote||null,ahead:s.ahead||0,behind:s.behind||0,files:i}),await this.refreshDirtyStatus()}catch(e){return this._clearStatus(),void console.error(e)}}async remoteChangedFiles(){this._remoteChangedFiles=[];try{let e=null;if(this.status.remote&&this.status.behind>0)return e=(await this._changedFiles("WORKING",this.status.remote)).files,null==e||e.forEach((e=>{this._remoteChangedFiles.push({status:"remote-changed",type:this._resolveFileType(e),x:"?",y:"B",to:e,from:"?",is_binary:!1})})),this._remoteChangedFiles}catch(e){return console.error(e),this._remoteChangedFiles}}async checkRemoteChangeNotified(){if(this.status.remote&&this.status.behind>0){const e=[],t=[];for(const s of this._remoteChangedFiles){const i=this._docmanager.findWidget(this.getRelativeFilePath(s.to)),n=this._changeUpstreamNotified.findIndex((e=>e.from===s.from&&e.to===s.to&&e.x===s.x&&e.y===s.y));void 0!==i?i.isAttached&&(-1===n?(this._changeUpstreamNotified.push(s),e.push(s)):t.push(s)):n>-1&&this._changeUpstreamNotified.splice(n,1)}this._settings.composite.openFilesBehindWarning&&e.length>0&&this._notifyRemoteChanges.emit({notNotified:e,notified:t})}else this._changeUpstreamNotified=[]}async refreshDirtyStatus(){const e=this.status.files.filter((e=>this._statusForDirtyState.includes(e.status))).map((e=>e.to));let t=!1;for(const s of e){const e=this._docmanager.findWidget(this.getRelativeFilePath(s));if(void 0!==e&&this._docmanager.contextForWidget(e).model.dirty){t=!0;break}}this.hasDirtyFiles=t}async reset(e){const t=await this._getPathRepository();await this._taskHandler.execute("git:reset:changes",(async()=>{let s;s=void 0===e?(await this._changedFiles("INDEX","HEAD")).files:[e],await ve(p.URLExt.join(t,"reset"),"POST",{reset_all:void 0===e,filename:void 0===e?null:e}),s.forEach((e=>{this._revertFile(e)}))})),await this.refreshStatus()}async resetToCommit(e=""){const t=await this._getPathRepository();await this._taskHandler.execute("git:reset:hard",(async()=>{const s=(await this._changedFiles(null,null,e)).files;await ve(p.URLExt.join(t,"reset_to_commit"),"POST",{commit_id:e}),null==s||s.forEach((e=>{this._revertFile(e)}))})),await this.refreshBranch()}async showPrefix(e){var t;try{return null!==(t=(await this._taskHandler.execute("git:fetch:prefix_path",(async()=>await ve(p.URLExt.join(e,"show_prefix"),"POST")))).path)&&void 0!==t?t:null}catch(e){if(e instanceof ue.GitResponseError&&500===e.response.status&&128===e.json.code)return null;throw e}}async showTopLevel(e){var t;try{return null!==(t=(await this._taskHandler.execute("git:fetch:top_level_path",(async()=>await ve(p.URLExt.join(e,"show_top_level"),"POST")))).path)&&void 0!==t?t:null}catch(e){if(e instanceof ue.GitResponseError&&500===e.response.status&&128===e.json.code)return null;throw e}}async tags(){const e=await this._getPathRepository();return await this._taskHandler.execute("git:tag:list",(async()=>await ve(p.URLExt.join(e,"tags"),"POST")))}async checkoutTag(e){const t=await this._getPathRepository();return await this._taskHandler.execute("git:tag:checkout",(async()=>await ve(p.URLExt.join(t,"tag_checkout"),"POST",{tag_id:e})))}addMark(e,t){this._currentMarker.add(e,t)}setMark(e,t){this._currentMarker.set(e,t)}getMark(e){return this._currentMarker.get(e)}toggleMark(e){this._currentMarker.toggle(e)}get markedFiles(){return this._currentMarker.markedFilePaths.filter((e=>this.status.files.some((t=>t.to===e)))).map((e=>this.status.files.find((t=>t.to===e))))}registerDiffProvider(e,t,s){t.forEach((t=>{Ee[t.toLocaleLowerCase()]={name:e,callback:s}}))}async revertCommit(e,t){const s=await this._getPathRepository();await this._taskHandler.execute("git:commit:revert",(async()=>{const e=(await this._changedFiles(null,null,t+"^!")).files;await ve(p.URLExt.join(s,"delete_commit"),"POST",{commit_id:t}),null==e||e.forEach((e=>{this._revertFile(e)}))})),await this.commit(e)}async _branch(){const e=await this._getPathRepository();return await this._taskHandler.execute("git:fetch:branches",(async()=>await ve(p.URLExt.join(e,"branch"),"POST")))}async _changedFiles(e,t,s){return await ve(p.URLExt.join(this.pathRepository,"changed_files"),"POST",{base:e,remote:t,single_commit:s})}_clearStatus(){this._status={branch:null,remote:null,ahead:0,behind:0,files:[]}}async _getPathRepository(){await this.ready;const e=this.pathRepository;if(null===e)throw new ue.NotInRepository;return e}_resolveFileType(e){return e.endsWith("/")?de.DocumentRegistry.getDefaultDirectoryFileType():this._docRegistry.getFileTypesForPath(e)[0]||de.DocumentRegistry.getDefaultTextFileType()}_setStatus(e){let t=this._status.ahead===e.ahead&&this._status.behind===e.behind&&this._status.branch===e.branch&&this._status.files.length===e.files.length;if(t)for(const s of e.files)if(this._status.files.findIndex((e=>e.from===s.from&&e.to===s.to&&e.x===s.x&&e.y===s.y))){t=!1;break}t||(this._status=e,this._statusChanged.emit(this._status))}_onSettingsChange(e){this._fetchPoll.frequency=Object.assign(Object.assign({},this._fetchPoll.frequency),{interval:e.composite.refreshInterval}),this._statusPoll.frequency=Object.assign(Object.assign({},this._statusPoll.frequency),{interval:e.composite.refreshInterval}),this._statusForDirtyState=e.composite.simpleStaging?["staged","partially-staged","unstaged"]:["staged","partially-staged"],this.refreshDirtyStatus()}_openGitignore(){if(this._docmanager){const e=this._docmanager.openOrReveal(this.getRelativeFilePath(".gitignore"));e&&!e.context.model.dirty&&e.context.revert()}}_revertFile(e){const t=this._docmanager.findWidget(this.getRelativeFilePath(e));t&&!t.context.model.dirty&&t.context.revert()}_setMarker(e,t){this.__currentMarker=this._markerCache.get(e,t)}}class Re{constructor(e){this._refresh=e,this._marks={}}add(e,t=!0){e in this._marks||this.set(e,t)}get(e){return this._marks[e]}set(e,t){this._marks[e]=t,this._refresh()}toggle(e){this.set(e,!this._marks[e])}get markedFilePaths(){const e=[];for(const t in this._marks)this._marks[t]&&e.push(t);return e}}class De{constructor(e){this._refresh=e,this._branchMarkers={}}get(e,t){const s=De.markerKey(e,t);if(s in this._branchMarkers)return this._branchMarkers[s];const i=new Re(this._refresh);return this._branchMarkers[s]=i,i}static markerKey(e,t){return[e,t].join(":")}}var Ne=s(1926);const je=(0,Ne.style)({flex:"0 0 auto",background:"none",lineHeight:"0px",padding:"0px 4px",width:"16px",border:"none",outline:"none",cursor:"pointer",$nest:{"&:active":{transform:"scale(1.272019649)",overflow:"hidden",backgroundColor:"var(--jp-layout-color3)"},"&:disabled":{opacity:.4,background:"none",cursor:"not-allowed"},"&:hover":{backgroundColor:"var(--jp-layout-color2)"}}}),Be=(0,Ne.style)({display:"none"}),Pe=(()=>{const e={$nest:{}},t=`&:hover .${Be}`;return e.$nest[t]={display:"block"},e})(),Me=(0,Ne.style)({height:"inherit",minHeight:"150px",overflow:"hidden",overflowY:"auto"}),Ie=new m.LabIcon({name:"git",svgstr:'<svg\n  xmlns="http://www.w3.org/2000/svg"\n  viewBox="0 0 20 20"\n  width="16"\n>\n  <path\n    class="jp-icon3 jp-icon-selectable"\n    d="M19.6 9.1 10.9 0.4c-0.5-0.5-1.3-0.5-1.8 0l-1.8 1.8 2.3 2.3c0.5-0.2 1.1-0.1 1.6 0.4 0.4 0.4 0.5 1 0.4 1.6l2.2 2.2c0.5-0.2 1.2-0.1 1.6 0.4 0.6 0.6 0.6 1.6 0 2.2-0.6 0.6-1.6 0.6-2.2 0C12.7 10.7 12.6 10.1 12.8 9.5l-2.1-2.1v5.4c0.1 0.1 0.3 0.2 0.4 0.3 0.6 0.6 0.6 1.6 0 2.2-0.6 0.6-1.6 0.6-2.2 0-0.6-0.6-0.6-1.6 0-2.2 0.1-0.1 0.3-0.3 0.5-0.3V7.4C9.3 7.3 9.1 7.2 9 7 8.5 6.6 8.4 5.9 8.6 5.3L6.4 3.1 0.4 9.1c-0.5 0.5-0.5 1.3 0 1.8l8.7 8.7c0.5 0.5 1.3 0.5 1.8 0l8.7-8.7c0.5-0.5 0.5-1.3 0-1.8"\n    fill="#616161"\n  />\n</svg>\n'}),Oe=new m.LabIcon({name:"git:add",svgstr:'<svg\n   xmlns="http://www.w3.org/2000/svg"\n   width="16"\n   viewBox="0 0 24 24"\n   version="1.1">\n  <g\n     class="jp-icon3 jp-icon-selectable"\n     fill="#4F4F4F">\n    <path\n       d="m 22,13 h -9 v 9 H 11 V 13 H 2 v -2 h 9 V 2 h 2 v 9 h 9 z"/>\n  </g>\n</svg>\n'}),Le=new m.LabIcon({name:"git:branch",svgstr:'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="16" viewBox="0 0 18 18">\n<path class="jp-icon3 jp-icon-selectable" d="M12.499,3.177 C11.205,3.177 10.166,4.216 10.166,5.51 C10.166,6.366 10.64,7.114 11.333,7.515 L11.333,7.843 C11.333,9.009 10.166,10.176 9,10.176 C8.034,10.176 7.269,10.376 6.667,10.704 L6.667,5.182 C7.36,4.781 7.834,4.034 7.834,3.177 C7.834,1.883 6.795,0.844 5.501,0.844 C4.207,0.844 3.168,1.883 3.168,3.177 C3.168,4.034 3.642,4.781 4.334,5.182 L4.334,12.818 C3.642,13.219 3.168,13.966 3.168,14.823 C3.168,16.117 4.207,17.156 5.501,17.156 C6.795,17.156 7.834,16.117 7.834,14.823 C7.834,14.203 7.597,13.656 7.214,13.237 C7.56,12.818 8.107,12.49 9,12.49 C11.333,12.49 13.666,10.157 13.666,7.824 L13.666,7.496 C14.358,7.095 14.832,6.348 14.832,5.492 C14.832,4.198 13.793,3.159 12.499,3.159 z M5.501,2.011 C6.139,2.011 6.667,2.539 6.667,3.177 C6.667,3.815 6.139,4.344 5.501,4.344 C4.863,4.344 4.334,3.815 4.334,3.177 C4.334,2.539 4.863,2.011 5.501,2.011 z M5.501,16.008 C4.863,16.008 4.334,15.479 4.334,14.841 C4.334,14.203 4.863,13.675 5.501,13.675 C6.139,13.675 6.667,14.203 6.667,14.841 C6.667,15.479 6.139,16.008 5.501,16.008 z M12.499,6.676 C11.861,6.676 11.333,6.148 11.333,5.51 C11.333,4.872 11.861,4.344 12.499,4.344 C13.137,4.344 13.666,4.872 13.666,5.51 C13.666,6.148 13.137,6.676 12.499,6.676 z" fill="#4F4F4F"/>\n</svg>\n'}),Te=new m.LabIcon({name:"git:clone",svgstr:'<svg width="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<g class="jp-icon3" fill="#616161">\n<path d="M18.3438 13.2365L10.7648 5.65849C10.3311 5.22492 9.61471 5.22492 9.18108 5.65849L7.61625 7.22311L9.61471 9.2213C10.086 9.07049 10.6139 9.16474 10.9721 9.54176C11.3492 9.91878 11.4435 10.4466 11.2927 10.9179L13.2157 12.8407C13.687 12.6898 14.2149 12.7841 14.592 13.1611C15.1199 13.6701 15.1199 14.5184 14.592 15.0462C14.0641 15.574 13.2345 15.574 12.7067 15.0462C12.3107 14.6503 12.2165 14.0848 12.4239 13.5947L10.6328 11.8039V16.5166C10.7648 16.5731 10.8779 16.6674 10.991 16.7616C11.5189 17.2894 11.5189 18.1189 10.991 18.6467C10.4631 19.1557 9.63356 19.1557 9.10567 18.6467C8.57777 18.1189 8.57777 17.2894 9.10567 16.7616C9.23764 16.6297 9.38847 16.5354 9.53929 16.4789V11.7096C9.38847 11.6531 9.23764 11.5399 9.10567 11.4268C8.70975 11.031 8.61548 10.4654 8.82287 9.97533L6.84326 8.01484L1.65859 13.1988C1.22497 13.6324 1.22497 14.3487 1.65859 14.7823L9.21879 22.3415C9.65241 22.775 10.3688 22.775 10.8025 22.3415L18.325 14.82C18.7774 14.3676 18.7774 13.6701 18.3438 13.2365Z"/>\n<rect x="14.6666" y="5.33331" width="6.66667" height="1.33333"/>\n<rect x="18.6666" y="2.66669" width="6.66667" height="1.33333" transform="rotate(90 18.6666 2.66669)"/>\n</g>\n</svg>\n'}),Ae=new m.LabIcon({name:"git:compare-with-selected",svgstr:'<svg width="16" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <g class="jp-icon3 jp-icon-selectable" fill="#4F4F4F">\n    <path d="M9.5 1H3.5C2.675 1 2.0075 1.63 2.0075 2.4L2 13.6C2 14.37 2.6675 15 3.4925 15H12.5C13.325 15 14 14.37 14 13.6V5.2L9.5 1ZM3.5 13.6V2.4H8.75L12.5 5.9V13.6H3.5Z" />\n    <path d="M5,8 L5,9 L7,9 L7,11 L11,8 L7,5 L7,7 L5,7 z" transform="rotate(180 7.75 8)" />\n  </g>\n</svg>'}),He=new m.LabIcon({name:"git:deletions",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" viewBox="0 0 24 24">\n    <path d="M0 0h24v24H0z" fill="none"/>\n    <path class="jp-icon3" fill="white" d="M7 11v2h10v-2H7zm5-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>\n</svg>\n'}),Ue=new m.LabIcon({name:"git:desktop",svgstr:'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="16" viewBox="0 0 24 24">\n  <path class="jp-icon3" d="M21 2H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h7l-2 3v1h8v-1l-2-3h7c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 12H3V4h18v10z" fill="#4F4F4F">\n  </path>\n</svg>'}),ze=new m.LabIcon({name:"git:diff",svgstr:'<svg width="16" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <g class="jp-icon3 jp-icon-selectable" fill="#4F4F4F">\n    <path d="M9.5 1H3.5C2.675 1 2.0075 1.63 2.0075 2.4L2 13.6C2 14.37 2.6675 15 3.4925 15H12.5C13.325 15 14 14.37 14 13.6V5.2L9.5 1ZM3.5 13.6V2.4H8.75L12.5 5.9V13.6H3.5Z"/>\n    <rect x="7" y="10.5" width="4" height="0.999998"/>\n    <rect x="5" y="5.49988" width="4" height="0.999998"/>\n    <rect x="7.5" y="4" width="4" height="1" transform="rotate(90 7.5 4)"/>\n  </g>\n</svg>\n'}),We=new m.LabIcon({name:"git:discard",svgstr:'<svg\n   xmlns="http://www.w3.org/2000/svg"\n   width="16"\n   viewBox="0 0 24 24"\n   version="1.1">\n  <g class="jp-icon3 jp-icon-selectable" stroke="#4F4F4F" stroke-width="2px">\n    <path\n       fill="none"\n       d="m 8.9223529,22.334118 c 0,0 8.2027491,-6.710405 10.3905881,-10.164706 C 21.50078,8.7151116 20.317794,5.8252391 17.957647,3.5011764 15.597501,1.1771138 12.452863,1.6307769 9.8541176,2.1458824 7.2553727,2.6609879 3.1905882,5.8164706 3.1905882,5.8164706" \n      />\n    <path\n       fill="none"\n       d="M 5.3082353,0.90352943 3.1905882,5.8164706 8.0752941,6.6070589"\n      />\n  </g>\n</svg>\n'}),Ge=new m.LabIcon({name:"git:insertions",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" viewBox="0 0 24 24">\n    <path d="M0 0h24v24H0z" fill="none"/>\n    <path class="jp-icon3" fill="white" d="M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>\n</svg>\n'}),$e=new m.LabIcon({name:"git:history",svgstr:'<svg\n  aria-hidden="true"\n  role="img"\n  xmlns="http://www.w3.org/2000/svg"\n  width="16"\n  viewBox="0 0 512 512"\n>\n  <path\n    class="jp-icon3"\n    fill="currentColor"\n    d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"\n  ></path>\n</svg>\n'}),Ve=new m.LabIcon({name:"git:merge",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16">\n  <path class="jp-icon3" fill="#4F4F4F"\n    d="M5.59 1.5c-2.041.023-3.607 2.277-2.958 4.202.346 1.087 1.299 1.946 2.404 2.211-.062 2.722-.036 5.448-.02 8.171-2.08.393-3.226 3.07-2.055 4.836.898 1.555 3.134 2.098 4.604 1.033 1.56-1.024 1.945-3.427.656-4.82-.47-.58-.783-.861-1.722-1.102-.004-1.233-.008-3.364-.007-4.596 1.281 1.648 3.342 2.65 5.436 2.555 1.052.03 2.105.015 3.157.011.414 1.848 2.597 3.043 4.361 2.285 1.804-.682 2.655-3.088 1.594-4.725-.99-1.698-3.596-2.12-5-.692-.538.426-.664 1.019-.86 1.63-1.68-.055-4.554.254-6.053-.702-1.39-.825-2.392-2.3-2.576-3.913 1.963-.439 3.092-2.914 2.074-4.669C8.053 2.124 6.81 1.458 5.59 1.5zm.026 1.515c1.26-.18 2.305 1.278 1.736 2.413-.446 1.301-2.442 1.454-3.081.237-.73-1.057.058-2.619 1.345-2.65zm12.501 8.502c1.26-.182 2.301 1.276 1.735 2.41-.445 1.301-2.442 1.455-3.082.238-.727-1.056.062-2.617 1.347-2.648zm-12.5 6c1.26-.183 2.304 1.275 1.735 2.41-.446 1.3-2.44 1.454-3.081.238-.73-1.055.06-2.617 1.345-2.648z" />\n</svg>'}),Ze=new m.LabIcon({name:"git:open-file",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" viewBox="0 0 15 15">\n  <g class="jp-icon3 jp-icon-selectable" fill="#4F4F4F">\n    <path\n       d="m 6.5,1 h 6 c 0.825,0 1.4925,0.63 1.4925,1.4 L 14,13.6 C 14,14.37 13.3325,15 12.5075,15 H 3.5 C 2.675,15 2,14.37 2,13.6 V 5.2 Z m 6,12.6 V 2.4 H 7.25 L 3.5,5.9 v 7.7 z"/>\n    <path\n       d="M 7.5195314,11.679686 V 9.3359374 l -2.8320313,-1e-7 V 8.457031 7.5781248 h 2.8320313 v -2.34375 l 4.0527336,3.2226563 z"\n       style="stroke-width:2.66873717" />\n  </g>\n</svg>\n'}),qe=new m.LabIcon({name:"git:pull",svgstr:'<svg width="16" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">\n  <path class="jp-icon3" \n    d="M14.5125 7.53C14.0025 4.9425 11.73 3 9 3C6.8325 3 4.95 4.23 4.0125 6.03C1.755 6.27 0 8.1825 0 10.5C0 12.9825 2.0175 15 4.5 15H14.25C16.32 15 18 13.32 18 11.25C18 9.27 16.4625 7.665 14.5125 7.53ZM14.25 13.5H4.5C2.8425 13.5 1.5 12.1575 1.5 10.5C1.5 8.9625 2.6475 7.68 4.17 7.5225L4.9725 7.44L5.3475 6.7275C6.06 5.355 7.455 4.5 9 4.5C10.965 4.5 12.66 5.895 13.0425 7.8225L13.2675 8.9475L14.415 9.03C15.585 9.105 16.5 10.0875 16.5 11.25C16.5 12.4875 15.4875 13.5 14.25 13.5ZM10.0875 7.5H7.9125V9.75H6L9 12.75L12 9.75H10.0875V7.5Z" \n    fill="#4F4F4F"/>\n</svg>\n'}),Ke=new m.LabIcon({name:"git:push",svgstr:'<svg width="16" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">\n<path class="jp-icon3" d="M14.5125 7.53C14.0025 4.9425 11.73 3 9 3C6.8325 3 4.95 4.23 4.0125 6.03C1.755 6.27 0 8.1825 0 10.5C0 12.9825 2.0175 15 4.5 15H14.25C16.32 15 18 13.32 18 11.25C18 9.27 16.4625 7.665 14.5125 7.53ZM14.25 13.5H4.5C2.8425 13.5 1.5 12.1575 1.5 10.5C1.5 8.9625 2.6475 7.68 4.17 7.5225L4.9725 7.44L5.3475 6.7275C6.06 5.355 7.455 4.5 9 4.5C10.965 4.5 12.66 5.895 13.0425 7.8225L13.2675 8.9475L14.415 9.03C15.585 9.105 16.5 10.0875 16.5 11.25C16.5 12.4875 15.4875 13.5 14.25 13.5ZM6 9.75H7.9125V12H10.0875V9.75H12L9 6.75L6 9.75Z" fill="#4F4F4F"/>\n</svg>\n'}),Xe=new m.LabIcon({name:"git:remove",svgstr:'<svg\n   xmlns="http://www.w3.org/2000/svg"\n   width="16"\n   viewBox="0 0 24 24"\n   version="1.1">\n  <g class="jp-icon3 jp-icon-selectable" stroke="#4F4F4F" stroke-width="2px">\n  <path\n     fill="none"\n     d="M 2,12 H 22" />\n   </g>\n</svg>\n'}),Ye=new m.LabIcon({name:"git:rewind",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" viewBox="0 0 24 24">\n    <path class="jp-icon3" fill="#4F4F4F" d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/>\n</svg>\n'}),Je=new m.LabIcon({name:"git:select-for-compare",svgstr:'<svg width="16" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <g class="jp-icon3 jp-icon-selectable" fill="#4F4F4F">\n    <path d="M9.5 1H3.5C2.675 1 2.0075 1.63 2.0075 2.4L2 13.6C2 14.37 2.6675 15 3.4925 15H12.5C13.325 15 14 14.37 14 13.6V5.2L9.5 1ZM3.5 13.6V2.4H8.75L12.5 5.9V13.6H3.5Z" />\n    <path d="M5,8 L5,9 L7,9 L7,11 L11,8 L7,5 L7,7 L5,7 z" />\n  </g>\n</svg>'}),Qe=new m.LabIcon({name:"git:tag",svgstr:'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 512.001 512.001" width="16">\n\t<path class="jp-icon3" fill="#4F4F4F" d="M506.513,311.066L253.87,58.423c-2.024-2.026-4.486-3.559-7.195-4.483L140.15,17.593\n\t\t\tc-6.758-2.305-14.242-0.568-19.294,4.483L84.709,58.222L31.977,5.491c-7.314-7.315-19.176-7.315-26.49,0\n\t\t\tc-7.315,7.315-7.315,19.175,0,26.49l52.732,52.731l-36.14,36.141c-5.051,5.05-6.79,12.534-4.483,19.294L53.943,246.67\n\t\t\tc0.924,2.71,2.458,5.172,4.483,7.197L311.071,506.51c7.314,7.315,19.175,7.315,26.49,0l168.954-168.954\n\t\t\tC513.83,330.241,513.83,318.382,506.513,311.066z M227.241,227.238c-21.817,21.819-57.132,21.82-78.952,0\n\t\t\tc-21.768-21.768-21.768-57.185,0.001-78.953c21.817-21.819,57.132-21.82,78.953,0C249.009,170.053,249.009,205.47,227.241,227.238\n\t\t\tz"/>\n</svg>\n'}),et=new m.LabIcon({name:"git:trash",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" viewBox="0 0 24 24">\n    <path class="jp-icon3" fill="#4F4F4F" d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>\n    <path d="M0 0h24v24H0z" fill="none"/>\n</svg>\n'}),tt=new m.LabIcon({name:"git:vertical-more",svgstr:'<svg width="16" height="16" version="1.1" viewBox="0 0 6.35 6.35" xmlns="http://www.w3.org/2000/svg">\n  <path class="jp-icon3" transform="scale(.26458)"\n    d="m11.939 1.7676a2.1655 2.1655 0 0 0-2.1055 2.1641 2.1655 2.1655 0 0 0 2.166 2.166 2.1655 2.1655 0 0 0 2.166-2.166 2.1655 2.1655 0 0 0-2.166-2.1641 2.1655 2.1655 0 0 0-0.060547 0zm0.060547 7.6172a2.1655 2.1655 0 0 0-2.166 2.166 2.1655 2.1655 0 0 0 2.166 2.166 2.1655 2.1655 0 0 0 2.166-2.166 2.1655 2.1655 0 0 0-2.166-2.166zm0 7.6191a2.1655 2.1655 0 0 0-2.166 2.166 2.1655 2.1655 0 0 0 2.166 2.166 2.1655 2.1655 0 0 0 2.166-2.166 2.1655 2.1655 0 0 0-2.166-2.166z"\n    fill="#4F4F4F" />\n</svg>'}),st=e=>{const{disabled:t,className:s,title:i,onClick:n,icon:r}=e;return _.createElement("button",{disabled:t,className:(0,Ne.classes)(je,s),title:i,onClick:n},_.createElement(r.react,{elementPosition:"center",tag:"span"}))},it=(0,Ne.style)({userSelect:"none",display:"flex",flexDirection:"row",alignItems:"center",boxSizing:"border-box",color:"var(--jp-ui-font-color1)",lineHeight:"var(--jp-private-running-item-height)",padding:"0px 4px",listStyleType:"none",$nest:{"&:hover":{backgroundColor:"var(--jp-layout-color2)"}}},Pe),nt=(0,Ne.style)((()=>{const e={color:"white",background:"var(--jp-brand-color1)",$nest:{"&:hover":{color:"white",background:"var(--jp-brand-color1) !important"},"&:hover .jp-icon-selectable[fill]":{fill:"white"},"&:hover .jp-icon-selectable[stroke]":{stroke:"white"},"& .jp-icon-selectable[fill]":{fill:"white"},"& .jp-icon-selectable-inverse[fill]":{fill:"var(--jp-brand-color1)"}}};return e.$nest[`& .${je}:active`]={backgroundColor:"var(--jp-brand-color1)"},e.$nest[`& .${je}:hover`]={backgroundColor:"var(--jp-brand-color1)"},e})()),rt=(0,Ne.style)({fontSize:"10px",marginLeft:"5px"}),ot=(0,Ne.style)({color:"white !important"}),at=(0,Ne.style)({color:"var(--jp-brand-color0)"}),lt=(0,Ne.style)({color:"var(--jp-warn-color0)",fontWeight:"bold"}),ct=(0,Ne.style)({color:"var(--jp-info-color0)"}),ht=((0,Ne.style)({display:"none"}),(0,Ne.style)({marginTop:"5px"}),(0,Ne.style)({flex:"0 0 auto"})),dt=(0,Ne.style)({display:"flex",alignItems:"center"}),pt=(0,Ne.style)({display:"flex",width:"100%"}),mt=(0,Ne.style)({display:"flex",marginLeft:"auto"}),gt=(0,Ne.style)({flex:"0 0 auto",height:"16px",width:"16px",marginRight:"4px"}),ut=(0,Ne.style)({flex:"1 1 auto",fontSize:"var(--jp-ui-font-size1)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),ft=(0,Ne.style)({color:"var(--jp-ui-font-color2)",fontSize:"var(--jp-ui-font-size0)",margin:"0px 4px"}),_t=e=>{const t="/"===(s=e.filepath)[s.length-1]?s:p.PathExt.basename(s);var s;const i=e.filepath.slice(0,e.filepath.length-t.length).replace(/^\/|\/$/g,""),n=e.filetype.icon||m.fileIcon;return _.createElement(_.Fragment,null,_.createElement(n.react,{className:gt,elementPosition:"center",tag:"span"}),_.createElement("span",{className:ut},t,_.createElement("span",{className:ft},i)))},bt={M:"Modified",A:"Added",D:"Deleted",R:"Renamed",C:"Copied",U:"Updated",B:"Behind","?":"Untracked","!":"Ignored"};class yt extends _.PureComponent{constructor(){super(...arguments),this._onDoubleClick=e=>{e.stopPropagation()}}render(){return this.props.model.addMark(this.props.fname,"untracked"!==this.props.stage),_.createElement("input",{name:"gitMark",className:ht,type:"checkbox",checked:this.props.checked,onDoubleClick:this._onDoubleClick})}}class vt extends _.PureComponent{constructor(e){super(e),this._onClick=e=>{this.props.markBox?e.shiftKey?this.props.markUntilFile(this.props.file):(this.props.model.toggleMark(this.props.file.to),this.props.setSelection(this.props.file,{singleton:!0})):e.ctrlKey||e.metaKey?this.props.setSelection(this.props.file):e.shiftKey?this.props.setSelection(this.props.file,{group:!0}):this.props.setSelection(this.props.file,{singleton:!0})}}_getFileChangedLabel(e){return bt[e]||"Unmodified"}_getFileChangedLabelClass(e){return"M"===e?this.props.selected?(0,Ne.classes)(rt,at,ot):(0,Ne.classes)(rt,at):"!"===e?this.props.selected?(0,Ne.classes)(rt,lt,ot):(0,Ne.classes)(rt,lt):this.props.selected?(0,Ne.classes)(rt,ct,ot):(0,Ne.classes)(rt,ct)}_getFileClass(){const e=this.props.selected?(0,Ne.classes)(it,nt):it;return this.props.className?`${e} ${this.props.className}`:e}render(){const{file:e}=this.props,t="staged"===e.status?e.x:e.y,s="unmerged"===e.status?"Conflicted":this._getFileChangedLabel(t);return _.createElement("div",{"data-test-selected":this.props.selected,"data-test-checked":this.props.checked,className:this._getFileClass(),onClick:this._onClick,onContextMenu:this.props.contextMenu&&(e=>{this.props.contextMenu(this.props.file,e)}),onDoubleClick:this.props.onDoubleClick,style:this.props.style,title:this.props.trans.__(`%1 • ${s}`,this.props.file.to)},_.createElement("div",{className:pt},_.createElement("div",{className:dt+" "+ut},this.props.markBox&&_.createElement(yt,{fname:this.props.file.to,stage:this.props.file.status,model:this.props.model,checked:this.props.checked}),_.createElement(_t,{filepath:this.props.file.to,filetype:this.props.file.type})),_.createElement("div",{className:mt},this.props.actions,_.createElement("span",{className:this._getFileChangedLabelClass("unmerged"===this.props.file.status?"!":this.props.file.y)},"unmerged"===this.props.file.status?"!":"?"===this.props.file.y?"U":t))))}}var Ct=s(737);const wt=(0,Ne.style)({display:"flex",flexDirection:"row",alignItems:"center",margin:"4px 0px",padding:"4px",fontWeight:600,borderBottom:"var(--jp-border-width) solid var(--jp-border-color2)",letterSpacing:"1px",fontSize:"12px",$nest:{"&:hover":{backgroundColor:"var(--jp-layout-color2)"}}},Pe),kt=(0,Ne.style)((()=>{const e={margin:"0",padding:"0",overflow:"auto",$nest:{}},t=`&:focus-within .${wt} .${Be}`;e.$nest[t]={display:"block"};const s=`&:hover .${wt} .${Be}`;return e.$nest[s]={display:"block"},e})()),xt=(0,Ne.style)({fontSize:"var(--jp-ui-font-size1)",flex:"1 1 auto",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}),Et=(0,Ne.style)({fontSize:"var(--jp-ui-font-size1)",flex:"0 0 auto",whiteSpace:"nowrap",borderRadius:"2px"}),St=(0,Ne.style)({flex:"0 0 auto",backgroundColor:"transparent",height:"13px",width:"12px",border:"none",outline:"none",paddingLeft:"0px"}),Ft=e=>{const[t,s]=_.useState(!0),i=e.files.length;return _.createElement("div",{className:kt},_.createElement("div",{className:wt,onClick:()=>{e.collapsible&&i>0&&s(!t)}},e.selectAllButton&&e.selectAllButton,e.collapsible&&_.createElement("button",{className:St},t&&i>0?_.createElement(m.caretDownIcon.react,null):_.createElement(m.caretRightIcon.react,null)),_.createElement("span",{className:xt},e.heading),e.actions,_.createElement("span",{className:Et},"(",i,")")),t&&i>0&&_.createElement(Ct.FixedSizeList,{height:Math.max(Math.min(e.height-34,25*i),25),itemCount:i,itemData:e.files,itemKey:(e,t)=>t[e].to,itemSize:25,style:{overflowX:"hidden"},width:"auto"},e.rowRenderer))};async function Rt(e,t,s){if((await(0,n.showDialog)({title:t.__("Discard all changes"),body:s?t.__("Your current changes forbid pulling the latest changes. Do you want to permanently discard those changes? This action cannot be undone."):t.__("Are you sure you want to permanently discard changes to all files? This action cannot be undone."),buttons:[n.Dialog.cancelButton({label:t.__("Cancel")}),n.Dialog.warnButton({label:t.__("Discard")})]})).button.accept)try{return e.resetToCommit("HEAD")}catch(e){return(0,n.showErrorMessage)(t.__("Discard all changes failed."),e),Promise.reject(e)}return Promise.reject({cancelled:!0,message:"The user refused to discard all changes"})}const Dt=e=>{const{className:t,onChange:s,checked:i}=e;return _.createElement("input",{type:"checkbox",className:t,onChange:s,style:{marginRight:"10px"},checked:i,"data-test-id":"SelectAllButton"})},Nt={"partially-staged":[_e.gitFileOpen,_e.gitFileUnstage,_e.gitFileDiff,_e.gitFileHistory],"remote-changed":[_e.gitFileOpen],unstaged:[_e.gitFileOpen,_e.gitFileStage,_e.gitFileDiscard,_e.gitFileDiff,_e.gitFileHistory],untracked:[_e.gitFileOpen,_e.gitFileTrack,_e.gitIgnore,_e.gitIgnoreExtension,_e.gitFileDelete],staged:[_e.gitFileOpen,_e.gitFileUnstage,_e.gitFileDiff,_e.gitCommitAmendStaged,_e.gitFileHistory],unmodified:[_e.gitFileHistory],unmerged:[_e.gitFileDiff]},jt={"partially-staged":[_e.gitFileOpen,_e.gitFileDiscard,_e.gitFileDiff,_e.gitFileHistory],"remote-changed":[_e.gitFileOpen],staged:[_e.gitFileOpen,_e.gitFileDiscard,_e.gitFileDiff,_e.gitFileHistory],unstaged:[_e.gitFileOpen,_e.gitFileDiscard,_e.gitFileDiff,_e.gitFileHistory],untracked:[_e.gitFileOpen,_e.gitIgnore,_e.gitIgnoreExtension,_e.gitFileDelete],unmodified:[_e.gitFileHistory],unmerged:[_e.gitFileDiff]},Bt=(e,t)=>e.x===t.x&&e.y===t.y&&e.from===t.from&&e.to===t.to&&e.status===t.status,Pt=e=>t=>{t.stopPropagation(),e(t)};class Mt extends _.Component{constructor(e){super(e),this.openContextMenu=(e,t)=>{let s;t.preventDefault(),this._isSelectedFile(e)?s=this.state.selectedFiles:(this._selectOnlyOneFile(e),s=[e]);const i=new f.Menu({commands:this.props.commands});Es(Nt[s[0].status],i,s),i.open(t.clientX,t.clientY)},this.openSimpleContextMenu=(e,t)=>{t.preventDefault();const s=new f.Menu({commands:this.props.commands});Es(jt[e.status],s,[e]),s.open(t.clientX,t.clientY)},this.resetAllStagedFiles=async e=>{e.stopPropagation(),await this.props.model.reset()},this.resetSelectedFiles=e=>{this._isSelectedFile(e)?this.state.selectedFiles.forEach((e=>this.props.model.reset(e.to))):this.props.model.reset(e.to)},this.openSelectedFiles=e=>{this._isSelectedFile(e)?this.props.commands.execute(_e.gitFileOpen,{files:this.state.selectedFiles}):this.props.commands.execute(_e.gitFileOpen,{files:[e]})},this.addAllUnstagedFiles=async e=>{e.stopPropagation(),await this.props.model.addAllUnstaged()},this.discardAllUnstagedFiles=async e=>{if(e.stopPropagation(),(await(0,n.showDialog)({title:this.props.trans.__("Discard all changes"),body:this.props.trans.__("Are you sure you want to permanently discard changes to all unstaged files? This action cannot be undone."),buttons:[n.Dialog.cancelButton({label:this.props.trans.__("Cancel")}),n.Dialog.warnButton({label:this.props.trans.__("Discard")})]})).button.accept)try{await this.props.model.checkout()}catch(e){(0,n.showErrorMessage)(this.props.trans.__("Discard all unstaged changes failed."),e)}},this.discardAllChanges=async e=>{e.stopPropagation(),await Rt(this.props.model,this.props.trans)},this.addFile=async(...e)=>{await this.props.model.add(...e)},this.discardChanges=e=>{this._isSelectedFile(e)?this.props.commands.execute(_e.gitFileDiscard,{files:this.state.selectedFiles}):this.props.commands.execute(_e.gitFileDiscard,{files:[e]})},this.addAllUntrackedFiles=async e=>{e.stopPropagation(),await this.props.model.addAllUntracked()},this.addAllMarkedFiles=async()=>{await this.addFile(...this.markedFiles.map((e=>e.to)))},this.setSelection=(e,t)=>{t&&t.singleton&&this._selectOnlyOneFile(e),t&&t.group&&this._selectUntilFile(e),t||this._toggleFile(e)},this.markUntilFile=e=>{if(!this.state.lastClickedFile)return void this.props.model.setMark(e.to,!0);const t=this.props.files.filter((e=>!["unmerged","remote-changed"].includes(e.status))),s=t.findIndex((e=>Bt(e,this.state.lastClickedFile))),i=t.findIndex((t=>Bt(t,e)));i>s?t.slice(s,i+1).forEach((e=>this.props.model.setMark(e.to,!0))):t.slice(i,s+1).forEach((e=>this.props.model.setMark(e.to,!0)))},this.toggleAllFiles=e=>{const t=this._areFilesAllMarked();e.forEach((e=>this.props.model.setMark(e.to,!t)))},this._selectOnlyOneFile=e=>{this.setState({selectedFiles:[e],lastClickedFile:e})},this._toggleFile=e=>{e.status===this.state.lastClickedFile.status?this.state.selectedFiles.find((t=>Bt(t,e)))?this.setState({selectedFiles:this.state.selectedFiles.filter((t=>!Bt(t,e))),lastClickedFile:e}):this.setState({selectedFiles:[...this.state.selectedFiles,e],lastClickedFile:e}):this._selectOnlyOneFile(e)},this._selectFiles=e=>{this.setState((t=>({selectedFiles:[...t.selectedFiles,...e.filter((e=>!t.selectedFiles.some((t=>Bt(t,e)))))]})))},this._deselectFiles=e=>{this.setState((t=>({selectedFiles:t.selectedFiles.filter((t=>!e.some((e=>Bt(t,e)))))})))},this._selectUntilFile=e=>{if(!this.state.lastClickedFile||e.status!==this.state.lastClickedFile.status)return void this._selectOnlyOneFile(e);const t=this.state.lastClickedFile.status,s=this.props.files.filter((e=>e.status===t)),i=this.props.files.filter((e=>"partially-staged"===e.status));switch(t){case"staged":s.push(...i.map((e=>Object.assign(Object.assign({},e),{status:"staged"}))));break;case"unstaged":s.push(...i.map((e=>Object.assign(Object.assign({},e),{status:"unstaged"}))))}s.sort(((e,t)=>e.to.localeCompare(t.to)));const n=s.findIndex((e=>Bt(e,this.state.lastClickedFile))),r=s.findIndex((t=>Bt(t,e)));if(r>n){const e=s.findIndex(((e,t)=>t>n&&!this._isSelectedFile(e)));-1===e?this._deselectFiles(s.slice(r+1)):r<e?this._deselectFiles(s.slice(r+1,e)):this._selectFiles(s.slice(e,r+1))}else if(r<n){const e=s.findIndex(((e,t)=>t<n&&this._isSelectedFile(e)));-1===e?this._selectFiles(s.slice(r,n)):r<e?this._selectFiles(s.slice(r,e)):this._deselectFiles(s.slice(e,r))}else this._selectOnlyOneFile(e)},this.pullFromRemote=async e=>{await this.props.commands.execute(be.gitPull,{})},this._renderUnmergedRow=e=>{const{data:t,index:s,style:i}=e,n=t[s],r=this._createDiffButton(n);return _.createElement(vt,{trans:this.props.trans,actions:!n.is_binary&&r,contextMenu:this.openContextMenu,file:n,model:this.props.model,selected:this._isSelectedFile(n),setSelection:this.setSelection,onDoubleClick:()=>this._openDiffViews([n]),style:Object.assign({},i)})},this._renderStagedRow=e=>{const t=this.props.settings.get("doubleClickDiff").composite,{data:s,index:i,style:n}=e,r=s[i],o=this._createDiffButton(r);return _.createElement(vt,{trans:this.props.trans,actions:_.createElement(_.Fragment,null,_.createElement(st,{className:Be,icon:Ze,title:this.props.trans.__("Open this file"),onClick:Pt((()=>this.openSelectedFiles(r)))}),o,_.createElement(st,{className:Be,icon:Xe,title:this.props.trans.__("Unstage this change"),onClick:Pt((()=>{this.resetSelectedFiles(r)}))})),file:r,contextMenu:this.openContextMenu,model:this.props.model,selected:this._isSelectedFile(r),setSelection:this.setSelection,onDoubleClick:t?o?()=>this._openDiffViews([r]):()=>{}:()=>this.openSelectedFiles(r),style:n})},this._renderChangedRow=e=>{const t=this.props.settings.get("doubleClickDiff").composite,{data:s,index:i,style:n}=e,r=s[i],o=this._createDiffButton(r);return _.createElement(vt,{trans:this.props.trans,actions:_.createElement(_.Fragment,null,_.createElement(st,{className:Be,icon:Ze,title:this.props.trans.__("Open this file"),onClick:Pt((()=>this.openSelectedFiles(r)))}),o,_.createElement(st,{className:Be,icon:We,title:this.props.trans.__("Discard changes"),onClick:Pt((()=>{this.discardChanges(r)}))}),_.createElement(st,{className:Be,icon:Oe,title:this.props.trans.__("Stage this change"),onClick:Pt((()=>{this._isSelectedFile(r)?this.addFile(...this.state.selectedFiles.map((e=>e.to))):this.addFile(r.to)}))})),file:r,contextMenu:this.openContextMenu,model:this.props.model,selected:this._isSelectedFile(r),setSelection:this.setSelection,onDoubleClick:t?o?()=>this._openDiffViews([r]):()=>{}:()=>this.openSelectedFiles(r),style:n})},this._renderUntrackedRow=e=>{const t=this.props.settings.get("doubleClickDiff").composite,{data:s,index:i,style:n}=e,r=s[i];return _.createElement(vt,{trans:this.props.trans,actions:_.createElement(_.Fragment,null,_.createElement(st,{className:Be,icon:Ze,title:this.props.trans.__("Open this file"),onClick:Pt((()=>this.openSelectedFiles(r)))}),_.createElement(st,{className:Be,icon:Oe,title:this.props.trans.__("Track this file"),onClick:Pt((()=>{this._isSelectedFile(r)?this.addFile(...this.state.selectedFiles.map((e=>e.to))):this.addFile(r.to)}))})),file:r,contextMenu:this.openContextMenu,model:this.props.model,onDoubleClick:()=>{t||this.props.commands.execute(_e.gitFileOpen,{files:[r]})},selected:this._isSelectedFile(r),setSelection:this.setSelection,style:n})},this._renderRemoteChangedRow=e=>{const t=this.props.settings.get("doubleClickDiff").composite,{data:s,index:i,style:n}=e,r=s[i];return _.createElement(vt,{trans:this.props.trans,actions:_.createElement(_.Fragment,null,_.createElement(st,{className:Be,icon:Ze,title:this.props.trans.__("Open this file"),onClick:Pt((()=>this.openSelectedFiles(r)))})),file:r,contextMenu:this.openContextMenu,model:this.props.model,onDoubleClick:()=>{t||this.props.commands.execute(_e.gitFileOpen,{files:[r]})},selected:this._isSelectedFile(r),setSelection:this.setSelection,style:n})},this._renderSimpleStageRow=e=>{const{data:t,index:s,style:i}=e,n=t[s],r=this.props.settings.get("doubleClickDiff").composite,o=()=>{this.props.commands.execute(_e.gitFileOpen,{files:[n]})};let a=_.createElement(st,{className:Be,icon:Ze,title:this.props.trans.__("Open this file"),onClick:Pt(o)}),l=r?()=>{}:o;if("unstaged"===n.status||"partially-staged"===n.status){const e=this._createDiffButton(n);a=_.createElement(_.Fragment,null,_.createElement(st,{className:Be,icon:Ze,title:this.props.trans.__("Open this file"),onClick:Pt(o)}),e,_.createElement(st,{className:Be,icon:We,title:this.props.trans.__("Discard changes"),onClick:Pt((()=>{this.discardChanges(n)}))})),l=r?e?()=>this._openDiffViews([n]):()=>{}:o}else if("staged"===n.status){const e=this._createDiffButton(n);a=_.createElement(_.Fragment,null,_.createElement(st,{className:Be,icon:Ze,title:this.props.trans.__("Open this file"),onClick:Pt(o)}),e,_.createElement(st,{className:Be,icon:We,title:this.props.trans.__("Discard changes"),onClick:Pt((()=>{this.discardChanges(n)}))})),l=r?e?()=>this._openDiffViews([n]):()=>{}:o}const c=this.markedFiles.some((e=>Bt(e,n)));return _.createElement(vt,{trans:this.props.trans,actions:a,file:n,markBox:!0,model:this.props.model,onDoubleClick:l,contextMenu:this.openSimpleContextMenu,setSelection:this.setSelection,style:i,markUntilFile:this.markUntilFile,checked:c})},this.state={selectedFiles:[],lastClickedFile:null,markedFiles:e.model.markedFiles}}componentDidMount(){const{model:e}=this.props;e.markChanged.connect((()=>{this.setState({markedFiles:e.markedFiles})}),this),e.repositoryChanged.connect((()=>{this.setState({markedFiles:e.markedFiles})}),this)}componentWillUnmount(){y.Signal.clearData(this)}get markedFiles(){return this.props.model.markedFiles}render(){const e=[],t=[];if(this.props.settings.composite.simpleStaging){const s=[];return this.props.files.forEach((i=>{switch(i.status){case"remote-changed":e.push(i);break;case"unmerged":t.push(i);break;default:s.push(i)}})),_.createElement("div",{className:Me},_.createElement(he(),{disableWidth:!0},(({height:i})=>_.createElement(_.Fragment,null,this._renderUnmerged(t,i,!1),this._renderRemoteChanged(e,i),this._renderSimpleStage(s,i)))))}{const s=[],i=[],n=[];return this.props.files.forEach((r=>{switch(r.status){case"staged":s.push(r);break;case"unstaged":i.push(r);break;case"untracked":n.push(r);break;case"partially-staged":s.push(Object.assign(Object.assign({},r),{status:"staged"})),i.push(Object.assign(Object.assign({},r),{status:"unstaged"}));break;case"unmerged":t.push(r);break;case"remote-changed":e.push(r)}})),_.createElement("div",{className:Me,onContextMenu:e=>e.preventDefault()},_.createElement(he(),{disableWidth:!0},(({height:r})=>_.createElement(_.Fragment,null,this._renderUnmerged(t,r),this._renderRemoteChanged(e,r),this._renderStaged(s,r),this._renderChanged(i,r),this._renderUntracked(n,r)))))}}_isSelectedFile(e){return this.state.selectedFiles.some((t=>Bt(t,e)))}_renderUnmerged(e,t,s=!0){return e.length>0?_.createElement(Ft,{collapsible:s,files:e,heading:this.props.trans.__("Conflicted"),height:t,rowRenderer:this._renderUnmergedRow}):null}_renderStaged(e,t){return _.createElement(Ft,{actions:_.createElement(st,{className:Be,disabled:0===e.length,icon:Xe,title:this.props.trans.__("Unstage all changes"),onClick:this.resetAllStagedFiles}),collapsible:!0,files:e,heading:this.props.trans.__("Staged"),height:t,rowRenderer:this._renderStagedRow})}_renderChanged(e,t){const s=0===e.length;return _.createElement(Ft,{actions:_.createElement(_.Fragment,null,_.createElement(st,{className:Be,disabled:s,icon:We,title:this.props.trans.__("Discard All Changes"),onClick:this.discardAllUnstagedFiles}),_.createElement(st,{className:Be,disabled:s,icon:Oe,title:this.props.trans.__("Stage all changes"),onClick:this.addAllUnstagedFiles})),collapsible:!0,heading:this.props.trans.__("Changed"),height:t,files:e,rowRenderer:this._renderChangedRow})}_renderUntracked(e,t){return _.createElement(Ft,{actions:_.createElement(st,{className:Be,disabled:0===e.length,icon:Oe,title:this.props.trans.__("Track all untracked files"),onClick:this.addAllUntrackedFiles}),collapsible:!0,heading:this.props.trans.__("Untracked"),height:t,files:e,rowRenderer:this._renderUntrackedRow})}_renderRemoteChanged(e,t){return e.length>0&&_.createElement(Ft,{actions:_.createElement(st,{className:Be,disabled:0===e.length,icon:Oe,title:this.props.trans.__("Pull from remote branch"),onClick:this.pullFromRemote}),collapsible:!0,heading:this.props.trans.__("Remote Changes"),height:t,files:e,rowRenderer:this._renderRemoteChangedRow})}_renderSimpleStage(e,t){return _.createElement(Ft,{selectAllButton:_.createElement(Dt,{onChange:()=>{this.toggleAllFiles(e)},checked:this._areFilesAllMarked()}),actions:_.createElement(st,{className:Be,disabled:0===e.length,icon:We,title:this.props.trans.__("Discard All Changes"),onClick:this.discardAllChanges}),heading:this.props.trans.__("Changed"),height:t,files:e,rowRenderer:this._renderSimpleStageRow})}_createDiffButton(e){let t;return t=this.props.settings.composite.simpleStaging?()=>this._openDiffViews([e]):()=>{this._isSelectedFile(e)?this._openDiffViews(this.state.selectedFiles):this._openDiffViews([e])},(Se(e.to)||!e.is_binary)&&_.createElement(st,{className:Be,icon:ze,title:this.props.trans.__("Diff this file"),onClick:Pt(t)})}async _openDiffViews(e){try{await this.props.commands.execute(_e.gitFileDiff,{files:e.map((e=>({filePath:e.to,isText:!e.is_binary,status:e.status})))})}catch(e){console.error(`Failed to open diff views.\n${e}`)}}_areFilesAllMarked(){const e=this.props.files.filter((e=>!["unmerged","remote-changed"].includes(e.status)));return 0!==e.length&&e.every((e=>this.state.markedFiles.some((t=>Bt(e,t)))))}}var It=s(2663),Ot=s(6856),Lt=s(998),Tt=s(5996);const At=(0,Ne.style)({width:"400px",color:"var(--jp-ui-font-color1)!important",borderRadius:"3px!important",backgroundColor:"var(--jp-layout-color1)!important"}),Ht=(0,Ne.style)({position:"absolute",top:"10px",right:"12px",height:"30px",width:"30px",padding:0,border:"none",borderRadius:"50%",backgroundColor:"var(--jp-layout-color1)",$nest:{svg:{fill:"var(--jp-ui-font-color1)"},"&:hover":{backgroundColor:"var(--jp-border-color2)"},"&:active":{backgroundColor:"var(--jp-border-color2)"}}}),Ut=(0,Ne.style)({boxSizing:"border-box",position:"relative",padding:"15px",borderBottom:"var(--jp-border-width) solid var(--jp-border-color2)"}),zt=(0,Ne.style)({fontWeight:700}),Wt=(0,Ne.style)({padding:"15px",$nest:{"> p":{marginBottom:"7px"}}}),Gt=(0,Ne.style)({boxSizing:"border-box",width:"100%",height:"2em",marginBottom:"16px",padding:"1px 18px 2px 7px",color:"var(--jp-ui-font-color1)",fontSize:"var(--jp-ui-font-size1)",fontWeight:300,backgroundColor:"var(--jp-layout-color1)",border:"var(--jp-border-width) solid var(--jp-border-color2)",borderRadius:"3px",$nest:{"&:active":{border:"var(--jp-border-width) solid var(--jp-brand-color1)"},"&:focus":{border:"var(--jp-border-width) solid var(--jp-brand-color1)"}}}),$t=(0,Ne.style)({padding:0,paddingBottom:"4px"}),Vt=(0,Ne.style)({boxSizing:"border-box",display:"inline-block",position:"relative",width:"100%",marginRight:"11px",fontSize:"var(--jp-ui-font-size1)"}),Zt=(0,Ne.style)({boxSizing:"border-box",width:"100%",height:"2em",padding:"1px 18px 2px 7px",color:"var(--jp-ui-font-color1)",fontSize:"var(--jp-ui-font-size1)",fontWeight:300,backgroundColor:"var(--jp-layout-color1)",border:"var(--jp-border-width) solid var(--jp-border-color2)",borderRadius:"3px",$nest:{"&:active":{border:"var(--jp-border-width) solid var(--jp-brand-color1)"},"&:focus":{border:"var(--jp-border-width) solid var(--jp-brand-color1)"}}}),qt=(0,Ne.style)({position:"absolute",right:"5px",top:"0.6em",height:"1.1em",width:"1.1em",padding:0,backgroundColor:"var(--jp-inverse-layout-color4)",border:"none",borderRadius:"50%",$nest:{svg:{width:"0.5em!important",height:"0.5em!important",fill:"var(--jp-ui-inverse-font-color0)"},"&:hover":{backgroundColor:"var(--jp-inverse-layout-color3)"},"&:active":{backgroundColor:"var(--jp-inverse-layout-color2)"}}}),Kt=(0,Ne.style)({boxSizing:"border-box",display:"block",border:"var(--jp-border-width) solid var(--jp-border-color2)",borderRadius:"3px",paddingTop:0,paddingBottom:0}),Xt=(0,Ne.style)({flexDirection:"row",flexWrap:"wrap",width:"100%",padding:"4px 11px 4px 11px!important",fontSize:"var(--jp-ui-font-size1)",lineHeight:"1.5em"}),Yt=(0,Ne.style)({color:"white!important",backgroundColor:"var(--jp-brand-color1)!important",$nest:{"& .jp-icon-selectable[fill]":{fill:"white"}}}),Jt=(0,Ne.style)({flexBasis:0,flexGrow:1,marginTop:"auto",marginBottom:"auto",marginRight:"auto"}),Qt=(0,Ne.style)({marginBottom:"auto",whiteSpace:"break-spaces"}),es=(0,Ne.style)({width:"16px",height:"16px",margin:"auto 8px auto 0"}),ts=(0,Ne.style)({}),ss=(0,Ne.style)({fontWeight:700}),is=(0,Ne.style)({color:"#ff0000"}),ns=(0,Ne.style)({padding:"15px!important",borderTop:"var(--jp-border-width) solid var(--jp-border-color2)"}),rs=(0,Ne.style)({boxSizing:"border-box",width:"9em",height:"2em",color:"white",fontSize:"var(--jp-ui-font-size1)",border:"0",borderRadius:"3px"}),os=(0,Ne.style)({backgroundColor:"var(--md-grey-500)",$nest:{"&:hover":{backgroundColor:"var(--md-grey-600)"},"&:active":{backgroundColor:"var(--md-grey-700)"}}}),as=(0,Ne.style)({backgroundColor:"var(--md-blue-500)",$nest:{"&:hover":{backgroundColor:"var(--md-blue-600)"},"&:active":{backgroundColor:"var(--md-blue-700)"},"&:disabled":{cursor:"default",color:"var(--jp-ui-inverse-font-color0)",backgroundColor:"var(--jp-layout-color3)"},"&:disabled:hover":{backgroundColor:"var(--jp-layout-color3)"},"&:disabled:active":{backgroundColor:"var(--jp-layout-color3)"}}});function ls(e){const[t,s]=b().useState(""),[i,n]=b().useState(null),r=e.branches.filter((e=>!t||e.name.includes(t))),{trans:o}=e;return b().createElement(It.Z,{classes:{paper:At},open:!0,onClose:e.onClose},b().createElement("div",{className:Ut},b().createElement("p",{className:zt},o.__("Merge Branch")),b().createElement("button",{className:Ht},b().createElement(Tt.Z,{titleAccess:o.__("Close this dialog"),fontSize:"small",onClick:()=>{e.onClose()}}))),b().createElement("div",{className:Wt},b().createElement("p",null,o.__("Select the branch to merge in %1",e.currentBranch)),b().createElement("div",{className:$t},b().createElement("div",{className:Vt},b().createElement("input",{className:Zt,type:"text",onChange:e=>{s(e.target.value)},value:t,placeholder:o.__("Filter"),title:o.__("Filter branch list")}),t?b().createElement("button",{className:qt},b().createElement(Tt.Z,{titleAccess:o.__("Clear the current filter"),fontSize:"small",onClick:()=>{s("")}})):null)),b().createElement(Ct.FixedSizeList,{className:Kt,height:200,itemSize:27.5,itemCount:r.length,itemData:r,itemKey:(e,t)=>t[e].name,style:{overflowX:"hidden"},width:"auto"},(function(e){const{data:t,index:s,style:r}=e,a=t[s],l=a.name===i;return b().createElement(Lt.Z,{button:!0,title:o.__("Create a new branch based on: %1",a.name),className:(0,Ne.classes)(Xt,l?Yt:null),onClick:()=>{n(a.name)},style:r},b().createElement(Le.react,{className:es,tag:"span"}),b().createElement("div",{className:Jt},b().createElement("p",{className:ts},a.name)))}))),b().createElement(Ot.Z,{className:ns},b().createElement("input",{className:(0,Ne.classes)(rs,os),type:"button",title:o.__("Close this dialog without merging a branch"),value:o.__("Cancel"),onClick:()=>{e.onClose()}}),b().createElement("input",{className:(0,Ne.classes)(rs,as),type:"button",title:o.__("Merge branch"),value:o.__("Merge"),onClick:()=>{e.onClose(i)},disabled:null===i})))}const cs=new class{constructor(){this._signal=new y.Signal(this)}get signal(){return this._signal}log(e){this._signal.emit(e)}},hs=_.createContext(cs);class ds extends Error{constructor(...e){super(...e),this.name="CancelledError"}}class ps extends f.Widget{constructor(e,t=e.__("Enter credentials for remote repository"),s=""){super(),this._trans=e,this.node.appendChild(this.createBody(t,s))}createBody(e,t){const s=document.createElement("div"),i=document.createElement("label"),n=document.createElement("label");this._checkboxCacheCredentials=document.createElement("input");const r=document.createElement("span");this._user=document.createElement("input"),this._user.type="text",this._password=document.createElement("input"),this._password.type="password";const o=document.createElement("span"),a=document.createElement("div");return s.className="jp-CredentialsBox",a.className="jp-CredentialsBox-warning",o.textContent=e,a.textContent=t,this._user.placeholder=this._trans.__("username"),this._password.placeholder=this._trans.__("password / personal access token"),n.className="jp-CredentialsBox-label-checkbox",this._checkboxCacheCredentials.type="checkbox",r.textContent=this._trans.__("Save my login temporarily"),i.appendChild(o),i.appendChild(this._user),i.appendChild(this._password),s.appendChild(i),s.appendChild(a),n.appendChild(this._checkboxCacheCredentials),n.appendChild(r),s.appendChild(n),s}getValue(){return{username:this._user.value,password:this._password.value,cache_credentials:this._checkboxCacheCredentials.checked}}}const ms=(0,Ne.style)({color:"var(--jp-ui-font-color1)!important",borderRadius:"3px!important",backgroundColor:"var(--jp-layout-color1)!important"}),gs=(0,Ne.style)({display:"flex",flexDirection:"column",$nest:{"& > input":{marginTop:"10px",lineHeight:"20px"}}}),us=(0,Ne.style)({padding:"15px 0px !important",justifyContent:"space-around !important"}),fs=(0,Ne.style)({margin:"1.5rem 0rem 1rem",padding:"0px"}),_s=(0,Ne.style)({marginTop:"2px",display:"grid",rowGap:"5px",columnGap:"10px",gridTemplateColumns:"auto auto auto"});class bs extends _.Component{constructor(e){super(e),this.state={newRemote:{name:"",url:""},existingRemotes:null}}async componentDidMount(){try{const e=await this.props.model.getRemotes();this.setState({existingRemotes:e})}catch(e){console.error(e)}}render(){return _.createElement(It.Z,{classes:{paper:ms},open:!0,onClose:this.props.onClose},_.createElement("div",{className:Ut},_.createElement("p",{className:zt},this.props.trans.__("Manage Remotes")),_.createElement("button",{className:Ht},_.createElement(Tt.Z,{titleAccess:this.props.trans.__("Close this dialog"),fontSize:"small",onClick:()=>this.props.onClose()}))),_.createElement("div",{className:Wt},_.createElement("label",{className:gs},_.createElement("span",null,this.props.trans.__("Enter a new remote repository name and URL")),_.createElement("input",{ref:e=>{this._nameInput=e},type:"text",placeholder:this.props.trans.__("name"),onChange:e=>this.setState({newRemote:Object.assign(Object.assign({},this.state.newRemote),{name:e.target.value})})}),_.createElement("input",{ref:e=>{this._urlInput=e},type:"text",placeholder:this.props.trans.__("Remote Git repository URL"),onChange:e=>this.setState({newRemote:Object.assign(Object.assign({},this.state.newRemote),{url:e.target.value})}),onKeyPress:e=>{"Enter"===e.key&&this._addRemoteButton.click()}})),this.props.warningContent&&_.createElement("div",{className:"jp-RemoteDialog-warning"},this.props.warningContent),_.createElement(Ot.Z,{className:us},_.createElement("input",{ref:e=>{this._addRemoteButton=e},className:(0,Ne.classes)(rs,as),type:"button",title:this.props.trans.__("Add Remote"),value:this.props.trans.__("Add"),onClick:async()=>{const{name:e,url:t}=this.state.newRemote;try{await this.props.model.addRemote(t,e),this._nameInput.value="",this._urlInput.value="",this.setState((e=>({existingRemotes:[...e.existingRemotes,e.newRemote],newRemote:{name:"",url:""}})))}catch(e){console.error(e),(0,n.showErrorMessage)(this.props.trans.__("Error when adding remote repository"),e)}},disabled:!this.state.newRemote.name||!this.state.newRemote.url})),_.createElement("div",{className:fs},_.createElement("p",null,this.props.trans.__("Existing Remotes:")),null===this.state.existingRemotes?_.createElement("p",null,"Loading remote repositories..."):this.state.existingRemotes.length>0?_.createElement("div",{className:_s},this.state.existingRemotes.map(((e,t)=>_.createElement(_.Fragment,{key:`remote-${t}`},_.createElement("span",null,e.name),_.createElement("span",null,e.url),_.createElement(st,{icon:et,title:this.props.trans.__("Remove this remote"),onClick:async()=>{await this.props.model.removeRemote(e.name),this.setState({existingRemotes:this.state.existingRemotes.filter((t=>t.name!==e.name))})}}))))):_.createElement("p",null," This repository does not have any remote. "))))}}class ys extends f.Widget{constructor(e,t){super(),this.node.appendChild(this.createBody(e,t))}createBody(e,t){const s=document.createElement("div"),i=document.createElement("div");i.textContent=e;const n=document.createElement("label");this._checkbox=document.createElement("input"),this._checkbox.type="checkbox",this._checkbox.checked=!0;const r=document.createElement("span");return r.textContent=t,n.appendChild(this._checkbox),n.appendChild(r),s.appendChild(i),s.appendChild(n),s}getValue(){return{checked:this._checkbox.checked}}}class vs extends f.Widget{constructor(e,t){super(),this._trans=e,this._model=t,this._radioButtons=[],this.node.appendChild(this.createBody()),this.addRemoteOptions()}createBody(){const e=document.createElement("div"),t=document.createElement("div");t.className="jp-remote-text",t.textContent=this._trans.__("Choose a remote to push to.");const s=document.createElement("div");s.className="jp-remote-options-wrapper";const i=document.createElement("div");i.textContent=this._trans.__("Loading remote repositories..."),s.appendChild(i),this._remoteOptionsContainer=s;const n=document.createElement("label");n.className="jp-force-box-container",this._forceCheckbox=document.createElement("input"),this._forceCheckbox.type="checkbox",this._forceCheckbox.checked=!1;const r=document.createElement("span");return r.textContent=this._trans.__("Force Push"),n.appendChild(this._forceCheckbox),n.appendChild(r),e.appendChild(t),e.appendChild(s),e.appendChild(n),e}async addRemoteOptions(){const e=await this._model.getRemotes();if(this._remoteOptionsContainer.innerHTML="",e.length>0)e.forEach((e=>{const t=document.createElement("div");t.className="jp-button-wrapper";const s=document.createElement("input");s.type="radio",s.id=e.name,s.value=e.name,s.name="option",s.className="jp-option","origin"===e.name&&(s.checked=!0),this._radioButtons.push(s);const i=document.createElement("label");i.htmlFor=e.name,i.textContent=`${e.name}: ${e.url}`,t.appendChild(s),t.appendChild(i),this._remoteOptionsContainer.appendChild(t)}));else{const e=document.createElement("div");e.textContent=this._trans.__("This repository has no known remotes."),this._remoteOptionsContainer.appendChild(e)}}getValue(){var e;return{remoteName:null===(e=this._radioButtons.find((e=>e.checked)))||void 0===e?void 0:e.value,force:this._forceCheckbox.checked}}}var Cs,ws=s(5100);class ks extends ws.k{constructor(e){var t;super(e),(null===(t=e.isPreview)||void 0===t||t)&&(ks.disposePreviewWidget(ks.previewWidget),ks.previewWidget=this)}static disposePreviewWidget(e){return e&&ks.previewWidget.dispose()}static pinWidget(e,t,s){setTimeout((()=>{const i=(e>=0?t.contentNode.children[e]:null).querySelector(".lm-TabBar-tabLabel");i.classList.add("jp-git-tab-mod-preview");const n=()=>{i.classList.remove("jp-git-tab-mod-preview"),i.removeEventListener("click",n,!0),ks.previewWidget===s&&(ks.previewWidget=null)};i.addEventListener("click",n,!0),s.disposed.connect((()=>{i.removeEventListener("click",n,!0)}))}),0)}onAfterAttach(e){super.onAfterAttach(e),this.node.addEventListener("click",this._onClick.bind(this),!1)}onBeforeDetach(e){this.node.removeEventListener("click",this._onClick.bind(this),!1),super.onBeforeAttach(e)}_onClick(){ks.previewWidget=null}}function xs(e,t){return s=>{const{files:i}=s;return i.length>1?t:e}}function Es(e,t,s){e.forEach((e=>{e===_e.gitFileDiff?t.addItem({command:e,args:{files:s.map((e=>({filePath:e.to,isText:!e.is_binary,status:e.status})))}}):t.addItem({command:e,args:{files:s}})}))}function Ss(e,t,s,i){let n,r,o;function a(s){const i=s.isVisible,n=s.parentMenu,a=(0,g.toArray)(t.selectedItems()),l=new Set(a.map((t=>{var s;return null===e.pathRepository||null===(s=e.getFile(t.path))||void 0===s?void 0:s.status})).filter((e=>void 0!==e))),c=new Set([].concat(...[...l].map((e=>Nt[e]))).filter((e=>e!==_e.gitFileOpen&&e!==_e.gitFileDelete&&void 0!==e)).map((e=>e===_e.gitFileStage||e===_e.gitFileTrack?_e.gitFileAdd:e))),h=!r||r.length!==c.size||!r.every((e=>c.has(e))),d=a.map((e=>e.path)),p=!o||!g.ArrayExt.shallowEqual(o,d);if(h||p){const t=[...c];s.clearItems(),Es(t,s,d.map((t=>e.getFile(t))).filter((e=>void 0!==e))),i&&n.triggerActiveItem(),r=t,o=d}}function l(t){var s,i;if(n||(n=null!==(i=null===(s=t.menu.items.find((e=>{var t;return"submenu"===e.type&&"jp-contextmenu-git"===(null===(t=e.submenu)||void 0===t?void 0:t.id)})))||void 0===s?void 0:s.submenu)&&void 0!==i?i:null),!n)return;a(n);const r=e.status;e.refreshStatus().then((()=>{e.status!==r&&a(n)})).catch((e=>{console.error("Fail to refresh model when displaying git context menu.",e)}))}if(s.opened)s.opened.connect(l);else{class e extends f.Menu{onBeforeAttach(e){l(s),super.onBeforeAttach(e)}}const t='.jp-DirListing-item[data-isdir="false"]';n=new e({commands:s.menu.commands}),n.title.label=i.__("Git"),n.title.icon=Ie.bindprops({stylesheet:"menuItem"}),s.addItem({type:"submenu",submenu:n,selector:t,rank:5})}}async function Fs(e,t,s,i,r,o=!1){try{let s;switch(t){case Cs.Clone:const{path:t,url:n,versioning:o,submodules:a}=i;s=await e.clone(t,n,r,null==o||o,null!=a&&a);break;case Cs.Pull:s=await e.pull(r);break;case Cs.Push:s=await e.push(r,!1,i.remote);break;case Cs.ForcePush:s=await e.push(r,!0,i.remote);break;case Cs.Fetch:s=await e.fetch(r),e.credentialsRequired=!1;break;default:s={code:-1,message:"Unknown git command"}}return s.message}catch(r){if(ye.some((e=>r.message.indexOf(e)>-1))){const r=await(0,n.showDialog)({title:s.__("Git credentials required"),body:new ps(s,s.__("Enter credentials for remote repository"),o?s.__("Incorrect username or password."):"")});if(r.button.accept)return await Fs(e,t,s,i,r.value,!0);throw new ds}throw r}}ks.previewWidget=null,function(e){e.Clone="Clone",e.Pull="Pull",e.Push="Push",e.ForcePush="ForcePush",e.Fetch="Fetch"}(Cs||(Cs={}));var Rs=s(5118),Ds=s(8041),Ns=s(9156),js=s(3127),Bs=s(7842),Ps=s(5494);const Ms="jp-mod-hideUnchanged";class Is extends f.Panel{constructor(e,t,s){super(),this._areUnchangedCellsHidden=!1,this._lastSerializeModel=null;const i=new u.PromiseDelegate;this._isReady=i.promise,this._model=e,this._renderMime=t,this._trans=null!=s?s:d.nullTranslator.load("jupyterlab_git"),this.addClass("nbdime-Widget"),this.refresh().then((()=>{i.resolve()})).catch((e=>{console.error(this._trans.__("Failed to refresh Notebook diff."),e,null==e?void 0:e.traceback)}))}get areUnchangedCellsHidden(){return this._areUnchangedCellsHidden}set areUnchangedCellsHidden(e){this._areUnchangedCellsHidden!==e&&(Os.toggleShowUnchanged(this._scroller,this._hasConflict,this._areUnchangedCellsHidden),this._areUnchangedCellsHidden=e)}get _hasConflict(){return this._model.hasConflict}get model(){return this._model}get nbdimeWidget(){return this._nbdWidget}get ready(){return this._isReady}get isFileResolved(){const e=this.nbdimeWidget;this._lastSerializeModel=e.model.serialize();const t=e.validateMerged(this._lastSerializeModel);return JSON.stringify(this._lastSerializeModel)===JSON.stringify(t)}async getResolvedFile(){var e;return Promise.resolve({format:"json",type:"notebook",content:null!==(e=this._lastSerializeModel)&&void 0!==e?e:this.nbdimeWidget.model.serialize()})}async refresh(){var e,t;if(!(null===(e=this._scroller)||void 0===e?void 0:e.parent)){for(;this.widgets.length>0;)this.widgets[0].dispose();const e=Os.diffHeader(this._model.reference.label,this._model.challenger.label,this._hasConflict,this._trans.__("Common Ancestor"));this.addWidget(e),this._scroller=new f.Panel,this._scroller.addClass("nbdime-root"),this._scroller.node.tabIndex=-1,this.addWidget(this._scroller)}try{const e=await this._model.reference.content(),s=await this._model.challenger.content(),i=await(null===(t=this._model.base)||void 0===t?void 0:t.content()),n=i?this.createMergeView.bind(this):this.createDiffView.bind(this);for(this._nbdWidget=await n(s,e,i);this._scroller.widgets.length>0;)this._scroller.widgets[0].dispose();this._scroller.addWidget(this._nbdWidget);try{await this._nbdWidget.init(),Os.markUnchangedRanges(this._scroller.node,this._hasConflict)}catch(e){console.debug(this._trans.__("Failed to init notebook diff view: %1",e)),Os.markUnchangedRanges(this._scroller.node,this._hasConflict)}}catch(e){this.showError(e)}}async createDiffView(e,t){const s=await ve("diffnotebook","POST",{currentContent:e,previousContent:t}),i=new js.NotebookDiffModel(s.base,s.diff);return new Bs.NotebookDiffWidget(i,this._renderMime)}async createMergeView(e,t,s){const i=await ve("diffnotebook","POST",{currentContent:e,previousContent:t,baseContent:s}),n=new Rs.NotebookMergeModel(i.base,i.merge_decisions);return new Ds.NotebookMergeWidget(n,this._renderMime)}onActivateRequest(e){var t;(null===(t=this._scroller)||void 0===t?void 0:t.parent)&&this._scroller.node.focus()}showError(e){var t;for(console.error(this._trans.__("Failed to load file diff."),e,null===(t=e)||void 0===t?void 0:t.traceback);this.widgets.length>0;)this.widgets[0].dispose();const s=(e.message||e).replace("\n","<br />");this.node.innerHTML=`<p class="jp-git-diff-error">\n      <span>${this._trans.__("Error Loading Notebook Diff:")}</span>\n      <span class="jp-git-diff-error-message">${s}</span>\n    </p>`}}var Os;!function(e){function t(e){if(!e.parentElement||!e.parentElement.parentElement)return e;const t=e.parentElement.parentElement;return t.classList.contains(Ps.CHUNK_PANEL_CLASS)?t:e}function s(e,s){var i;const n=s?Ds.CELLMERGE_CLASS:Bs.CELLDIFF_CLASS,r=s?Ns.UNCHANGED_MERGE_CLASS:Ps.UNCHANGED_DIFF_CLASS,o=s?".jp-Notebook-merge":".jp-Notebook-diff",a=e.querySelectorAll(`.${n}`);let l=-1;for(let e=0;e<a.length;++e){const s=a[e];if(s.classList.contains(r))-1===l&&(l=e);else if(-1!==l){const i=e-l;t(s).setAttribute("data-nbdime-NCellsHiddenBefore",i.toString()),l=-1}}if(-1!==l){const s=a.length-l;if(0===l)return void(null!==(i=e.querySelector(o))&&void 0!==i?i:e).setAttribute("data-nbdime-AllCellsHidden",s.toString());t(a[l-1]).setAttribute("data-nbdime-NCellsHiddenAfter",s.toString())}}e.diffHeader=function(e,t,s,i){const n=s?"jp-git-merge-banner":"jp-git-diff-banner",r=document.createElement("div");return r.className="jp-git-diff-header",r.innerHTML=`<div class="${n}">\n        <span>${e}</span>\n        <span class="jp-spacer"></span>\n        ${s?`<span>${i}</span><span class="jp-spacer"></span>`:""}\n        <span>${t}</span>\n      </div>`,new f.Widget({node:r})},e.toggleShowUnchanged=function(e,t,i){const n=e.hasClass(Ms);if(void 0===i)i=n;else if(n!==i)return;i?e.removeClass(Ms):(s(e.node,t),e.addClass(Ms)),e.update()},e.markUnchangedRanges=s}(Os||(Os={}));var Ls=s(6393);const Ts=(0,Ne.keyframes)({to:{fillOpacity:1}}),As=(0,Ne.style)({$nest:{"& .jp-icon3":{animationName:Ts,animationDuration:"1s"}}}),Hs=(0,Ne.keyframes)({"0%":{fillOpacity:1},"50%":{fillOpacity:.6},"100%":{fillOpacity:1}}),Us=(0,Ne.style)({$nest:{"& .jp-icon3":{animationName:Hs,animationDuration:"2s",animationIterationCount:"infinite"}}}),zs=(0,Ne.style)({$nest:{"& > .MuiBadge-badge":{top:6,right:15,backgroundColor:"var(--jp-warn-color1)"}}}),Ws=(0,Ne.style)({fontSize:"var(--jp-ui-font-size1)",lineHeight:"100%"}),Gs=(0,Ne.style)({display:"flex",flexDirection:"column",backgroundColor:"var(--jp-layout-color1)"}),$s=(0,Ne.style)({display:"flex",flexDirection:"row",flexWrap:"wrap",minHeight:"35px",lineHeight:"var(--jp-private-running-item-height)",backgroundColor:"var(--jp-layout-color1)",borderBottom:"var(--jp-border-width) solid var(--jp-border-color2)"}),Vs=(0,Ne.style)({background:"var(--jp-layout-color1)"}),Zs=(0,Ne.style)({boxSizing:"border-box",display:"flex",flexDirection:"row",flexWrap:"wrap",width:"100%",minHeight:"50px",padding:"4px 11px 4px 11px",fontSize:"var(--jp-ui-font-size1)",lineHeight:"1.5em",color:"var(--jp-ui-font-color1)",textAlign:"left",border:"none",borderBottom:"var(--jp-border-width) solid var(--jp-border-color2)",borderRadius:0,background:"var(--jp-layout-color1)"}),qs=(0,Ne.style)({$nest:{"&:hover":{backgroundColor:"var(--jp-layout-color2)"},"&:active":{backgroundColor:"var(--jp-layout-color3)"}}}),Ks=(0,Ne.style)({width:"16px",height:"16px",margin:"auto 8px auto 0"}),Xs=(0,Ne.style)({flexBasis:0,flexGrow:1,marginTop:"auto",marginBottom:"auto",marginRight:"auto"}),Ys=(0,Ne.style)({}),Js=(0,Ne.style)({marginBottom:"auto",fontWeight:700}),Qs=(0,Ne.style)({boxSizing:"border-box",height:"24px",width:"var(--jp-private-running-button-width) !important",margin:"auto 0 auto 0",padding:"0px 6px !important",$nest:{"& span":{margin:"auto",width:"16px"}}}),ei=(0,Ne.style)({flex:"1 1 auto"}),ti=(0,Ne.style)({$nest:{"& > .MuiBadge-badge":{top:12,right:15,backgroundColor:"var(--jp-warn-color1)"}}});class si extends n.ReactWidget{constructor(e,t){super(),this._locked=!1,this._status="",this._model=e,this._trans=t,this.addClass("jp-git-StatusWidget")}set status(e){this._status=e,this._locked||this._animate()}render(){return b().createElement(b().Fragment,null,b().createElement(n.UseSignal,{signal:this._model.credentialsRequiredChanged,initialArgs:!1},((e,t)=>b().createElement(Ls.Badge,{className:zs,variant:"dot",invisible:!t,"data-test-id":"git-credential-badge"},b().createElement(st,{className:(0,Ne.classes)(Qs,"idle"!==this._status?Us:As),icon:Ie,onClick:t?async()=>this._showGitOperationDialog():void 0,title:t?`Git: ${this._trans.__("credentials required")}`:`Git: ${this._trans.__(this._status)}`})))),b().createElement(n.UseSignal,{signal:this._model.headChanged},(()=>this._model.currentBranch&&b().createElement("span",{className:Ws},this._model.currentBranch.name))))}async _showGitOperationDialog(){try{await Fs(this._model,Cs.Fetch,this._trans)}catch(e){console.error("Encountered an error when fetching. Error:",e)}}async _animate(){this._locked=!0,this.update(),await(500,new Promise((e=>setTimeout(e,500)))),this._locked=!1,this.update()}}var ii;function ni(e,t,s,i){t.toolbar.addItem("gitClone",n.ReactWidget.create(_.createElement(n.UseSignal,{signal:e.repositoryChanged,initialArgs:{name:"pathRepository",oldValue:null,newValue:e.pathRepository}},((e,t)=>_.createElement(n.ToolbarButtonComponent,{enabled:null===t.newValue,icon:Te,onClick:()=>{s.execute(be.gitClone)},tooltip:i.__("Git Clone")})))))}!function(e){e.createEventCallback=function(e){return function(t,s){let i;switch(s){case"empty":i="idle";break;case"git:checkout":i="checking out…";break;case"git:clone":i="cloning repository…";break;case"git:commit:create":i="committing changes…";break;case"git:commit:revert":i="reverting changes…";break;case"git:init":i="initializing repository…";break;case"git:merge":i="merging…";break;case"git:pull":i="pulling changes…";break;case"git:pushing":i="pushing changes…";break;case"git:refresh":i="refreshing…";break;case"git:reset:changes":i="resetting changes…";break;case"git:reset:hard":i="discarding changes…";break;default:i=/git:add:files/.test(s)?"adding files…":"working…"}e.status=i}},e.isStatusWidgetActive=function(e){return e?function(){return e.composite.displayStatus}:function(){return!1}}}(ii||(ii={}));var ri=s(6975),oi=s(6234),ai=s(2285),li=s(5917),ci=s(433);function hi(e){return _.createElement(ai.Z,Object.assign({},e,{direction:"up"}))}class di extends _.Component{constructor(e){super(e),this._onClick=e=>{this.props.onClick?this.props.onClick(e):this._onClose(e,"click")},this._onClose=(e,t)=>{"clickaway"!==t&&this.props.onClose(e)}}render(){let e=null;const t=this.props.severity||"info";let s;return"success"===t&&(e=this.props.duration||5e3),this.props.error?s=_.createElement(Ls.Button,{color:"inherit",size:"small",onClick:()=>{(0,n.showErrorMessage)(this.props.trans.__("Error"),this.props.error,[n.Dialog.warnButton({label:this.props.trans.__("Dismiss")})])}},this.props.trans.__("Show")):this.props.details&&(s=_.createElement(Ls.Button,{color:"inherit",size:"small",onClick:()=>{(0,n.showDialog)({title:this.props.trans.__("Detailed message"),body:this.props.details,buttons:[n.Dialog.okButton({label:this.props.trans.__("Dismiss")})]})}},this.props.trans.__("Details"))),_.createElement(oi.Z,null,_.createElement(li.Z,{key:"git:alert",open:this.props.open,anchorOrigin:{vertical:"bottom",horizontal:"right"},autoHideDuration:e,TransitionComponent:hi,onClick:this._onClick,onClose:this._onClose},_.createElement(ci.Z,{action:s,variant:"filled",severity:t},this.props.message||this.props.trans.__("(missing message)"))))}}var pi=s(3733),mi=s(5477);const gi=(0,Ne.style)({position:"absolute",top:"50%",left:"50%",color:"var(--jp-ui-inverse-font-color0)",textAlign:"center"});class ui extends _.Component{constructor(e){super(e),this._onClick=e=>{this.props.onClick&&this.props.onClick(e)}}render(){return _.createElement(pi.Z,{disableAutoFocus:!0,disableEnforceFocus:!0,open:this.props.open,onClick:this._onClick},_.createElement("div",{className:gi},_.createElement(mi.Z,{color:"inherit"})))}}const fi=new Map([[fe.ERROR,"error"],[fe.WARNING,"warning"],[fe.SUCCESS,"success"],[fe.INFO,"info"],[fe.RUNNING,"info"]]),_i=1e3;class bi extends _.Component{constructor(e){super(e),this.state={blockUI:!1,lastUpdate:Date.now()-_i,logStack:[],showAlert:!1}}static getDerivedStateFromProps(e,t){const s=t.logStack[t.logStack.length-1],i=Date.now();return e.log!==s&&(i-t.lastUpdate>_i&&t.logStack.shift(),s&&e.log.level>s.level?(t.logStack.splice(0,1,e.log),t.lastUpdate=i):t.logStack.push(e.log),t.blockUI=e.settings.composite.blockWhileCommandExecutes,t.showAlert=!0),t}render(){this.state.logStack.length>1&&setTimeout((()=>{this.state.logStack.length>1&&this.setState({blockUI:this.props.settings.composite.blockWhileCommandExecutes,logStack:this.state.logStack.slice(1),lastUpdate:Date.now(),showAlert:!0})}),_i);const e=this.state.logStack[0];return _.createElement(_.Fragment,null,_.createElement(ui,{open:this.state.blockUI&&e.level===fe.RUNNING&&this.state.showAlert,onClick:()=>{this.setState({blockUI:!1})}}),_.createElement(di,{details:null==e?void 0:e.details,error:null==e?void 0:e.error,open:this.state.showAlert,message:(null==e?void 0:e.message)||this.props.log.message,severity:fi.get((null==e?void 0:e.level)||this.props.log.level),onClose:()=>this.setState({showAlert:!1}),trans:this.props.trans}))}}var yi=s(1423),vi=s(1579);const Ci=(0,Ne.style)({display:"flex",flexDirection:"column",height:"100%",overflowY:"auto"}),wi=(0,Ne.style)({fontSize:"var(--jp-ui-font-size1)",lineHeight:"var(--jp-content-line-height)",margin:"13px 11px 4px 11px",textAlign:"left"}),ki=(0,Ne.style)({alignSelf:"center",boxSizing:"border-box",height:"28px",width:"200px",marginTop:"5px",border:"0",borderRadius:"3px",color:"white",fontSize:"var(--jp-ui-font-size1)",backgroundColor:"var(--md-blue-500)",$nest:{"&:hover":{backgroundColor:"var(--md-blue-600)"},"&:active":{backgroundColor:"var(--md-blue-700)"}}}),xi=(0,Ne.style)({minHeight:"36px!important",$nest:{"button:last-of-type":{borderRight:"none"}}}),Ei=(0,Ne.style)({width:"50%",minWidth:"0!important",maxWidth:"50%!important",minHeight:"36px!important",backgroundColor:"var(--jp-layout-color2)!important",borderBottom:"var(--jp-border-width) solid var(--jp-border-color2)!important",borderRight:"var(--jp-border-width) solid var(--jp-border-color2)!important",$nest:{span:{textTransform:"none"}}}),Si=(0,Ne.style)({backgroundColor:"var(--jp-layout-color1)!important"}),Fi=(0,Ne.style)({height:"3px!important",backgroundColor:"var(--jp-brand-color1)!important",transition:"none!important"});class Ri extends f.Widget{constructor(){super(),this.node.appendChild(this.createBody())}createBody(){const e=document.createElement("div"),t=document.createElement("span");return this._name=document.createElement("input"),this._email=document.createElement("input"),e.className="jp-RedirectForm",t.textContent="Enter your name and email for commit",this._name.placeholder="Name",this._email.placeholder="Email",e.appendChild(t),e.appendChild(this._name),e.appendChild(this._email),e}getValue(){return{name:this._name.value,email:this._email.value}}}var Di=s(6057),Ni=s(282),ji=s(4837),Bi=s(2795),Pi=s(170),Mi=s(5639),Ii=s(9829),Oi=s(9895),Li=s(6762);const Ti=(0,Ne.style)({flex:"1 1 auto",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}),Ai=(0,Ne.style)({marginTop:"6px",marginBottom:"0",borderBottom:"var(--jp-border-width) solid var(--jp-border-color2)"}),Hi=(0,Ne.style)({padding:"4px 11px 4px",display:"flex"}),Ui=(0,Ne.style)({flex:"1 1 auto",boxSizing:"border-box",display:"inline-block",position:"relative",fontSize:"var(--jp-ui-font-size1)"}),zi=(0,Ne.style)({boxSizing:"border-box",width:"100%",height:"2em",padding:"1px 18px 2px 7px",color:"var(--jp-ui-font-color1)",fontSize:"var(--jp-ui-font-size1)",fontWeight:300,backgroundColor:"var(--jp-layout-color1)",border:"var(--jp-border-width) solid var(--jp-border-color2)",borderRadius:"3px",$nest:{"&:active":{border:"var(--jp-border-width) solid var(--jp-brand-color1)"},"&:focus":{border:"var(--jp-border-width) solid var(--jp-brand-color1)"}}}),Wi=(0,Ne.style)({position:"absolute",right:"5px",top:"0.6em",height:"1.1em",width:"1.1em",padding:0,backgroundColor:"var(--jp-inverse-layout-color4)",border:"none",borderRadius:"50%",$nest:{svg:{width:"0.5em!important",height:"0.5em!important",fill:"var(--jp-ui-inverse-font-color0)"},"&:hover":{backgroundColor:"var(--jp-inverse-layout-color3)"},"&:active":{backgroundColor:"var(--jp-inverse-layout-color2)"}}}),Gi=(0,Ne.style)({boxSizing:"border-box",width:"7.7em",height:"2em",flex:"0 0 auto",marginLeft:"5px",color:"white",fontSize:"var(--jp-ui-font-size1)",backgroundColor:"var(--md-blue-500)",border:"0",borderRadius:"3px",$nest:{"&:hover":{backgroundColor:"var(--md-blue-600)"},"&:active":{backgroundColor:"var(--md-blue-700)"}}}),$i=(0,Ne.style)({padding:"4px 11px!important",userSelect:"none"},Pe),Vi=(0,Ne.style)({color:"white!important",backgroundColor:"var(--jp-brand-color1)!important",$nest:{"& .jp-icon-selectable[fill]":{fill:"white"}}}),Zi=(0,Ne.style)({width:"16px",height:"16px",marginRight:"4px"}),qi=(0,Ne.style)({display:"flex",flexWrap:"wrap",marginTop:"auto",padding:"8px",paddingTop:"1em",alignItems:"flex-start",backgroundColor:"var(--jp-layout-color1)",borderTop:"var(--jp-border-width) solid var(--jp-border-color2)"}),Ki=(0,Ne.style)({marginBottom:"1em",padding:"var(--jp-code-padding)",outline:"none",overflowX:"auto",border:"var(--jp-border-width) solid var(--jp-border-color2)",borderRadius:"3px"}),Xi=(0,Ne.style)({fontWeight:"bold",marginBottom:"0.5em",color:"var(--jp-warn-color1)",padding:0}),Yi=(0,Ne.style)({color:"var(--jp-warn-color1)",padding:0,$nest:{"&:last-child":{paddingBottom:0}}}),Ji=(0,Ne.style)({height:"2em",marginBottom:"1em",padding:"var(--jp-code-padding)",outline:"none",overflowX:"auto",border:"var(--jp-border-width) solid var(--jp-border-color2)",borderRadius:"3px",$nest:{"&.Mui-error":{border:"calc(2 * var(--jp-border-width)) solid var(--jp-error-color1)"}}}),Qi=(0,Ne.style)({marginBottom:"1em",padding:"var(--jp-code-padding)",outline:"none",overflowX:"auto",resize:"none",border:"var(--jp-border-width) solid var(--jp-border-color2)",borderRadius:"3px",$nest:{"&>*::placeholder":{color:"var(--jp-ui-font-color3)"},"&>*::-webkit-input-placeholder":{color:"var(--jp-ui-font-color3)"},"&>*::-moz-placeholder":{color:"var(--jp-ui-font-color3)"},"&>*::-ms-input-placeholder":{color:"var(--jp-ui-font-color3)"}}}),en=(0,Ne.style)({cursor:"pointer",color:"var(--jp-ui-inverse-font-color1)",backgroundColor:"var(--jp-brand-color1)",$nest:{"&:hover":{backgroundColor:"var(--jp-brand-color2)"}}}),tn=(0,Ne.style)({flex:"0 0 20px",lineHeight:"initial",$nest:{"& .jp-icon3[fill]":{fill:"var(--jp-ui-inverse-font-color1)"}}}),sn=((0,Ne.style)({width:"100%",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around"}),(0,Ne.style)({maxWidth:"250px"})),nn=((0,Ne.style)({fontSize:"var(--jp-ui-font-size1)",whiteSpace:"break-spaces"}),(0,Ne.style)({color:"var(--jp-ui-font-color1)",fontSize:"var(--jp-ui-font-size1)",fontFamily:"var(--jp-ui-font-family)",backgroundColor:"var(--jp-layout-color1)"})),rn=(0,Ne.style)({outline:"none",border:"var(--jp-border-width) solid var(--jp-brand-color1)"}),on=(0,Ne.style)({cursor:"not-allowed !important",color:"var(--jp-ui-font-color2) !important",backgroundColor:"var(--jp-layout-color3) !important",pointerEvents:"auto !important"});var an=s(959);function ln(e){var t,s,i,n;const r=null!==(t=e.summaryPlaceholder)&&void 0!==t?t:e.trans.__("Summary");return _.createElement(_.Fragment,null,_.createElement(an.Z,{className:Ji,classes:{root:nn,focused:rn,disabled:on},error:e.error,type:"text",placeholder:r,title:e.disabled?e.trans.__("Amending the commit will re-use the previous commit summary"):e.trans.__("Enter a commit message summary (a single line, preferably less than 50 characters)"),value:e.summary,onChange:function(t){e.setSummary(t.target.value)},onKeyPress:function(e){"Enter"===e.key&&e.preventDefault()},disabled:null!==(s=e.disabled)&&void 0!==s&&s,disableUnderline:!0,fullWidth:!0}),_.createElement(an.Z,{className:Qi,classes:{root:nn,focused:rn,disabled:on},multiline:!0,minRows:5,maxRows:10,placeholder:null!==(i=e.descriptionPlaceholder)&&void 0!==i?i:e.trans.__("Description (optional)"),title:e.disabled?e.trans.__("Amending the commit will re-use the previous commit summary"):e.trans.__("Enter a commit message description"),value:e.description,onChange:function(t){e.setDescription(t.target.value)},disabled:null!==(n=e.disabled)&&void 0!==n&&n,disableUnderline:!0,fullWidth:!0}))}class cn extends _.Component{constructor(e){super(e),this._getSubmitKeystroke=()=>this.props.commands.keyBindings.find((e=>e.command===be.gitSubmitCommand)).keys.join(" "),this._handleClose=e=>{this._anchorRef.current&&this._anchorRef.current.contains(e.target)||this.setState({open:!1})},this._handleMenuItemClick=(e,t)=>{this.setState({open:!1}),this.props.setAmend(1===t)},this._handleToggle=()=>{this.setState({open:!this.state.open})},this._handleCommand=(e,t)=>{t.id===be.gitSubmitCommand&&this._canCommit()&&this.props.onCommit()},this._options=[],this._options.push({title:this.props.trans.__("Create a new commit"),description:this.props.trans.__("New commit will be created and show up as a next one after the previous commit (default).")},{title:this.props.trans.__("Amend previous commit"),description:this.props.trans.__("Staged changes will be added to the previous commit and its date will be updated.")}),this._anchorRef=_.createRef(),this.state={open:!1}}componentDidMount(){this.props.commands.commandExecuted.connect(this._handleCommand)}componentWillUnmount(){this.props.commands.commandExecuted.disconnect(this._handleCommand)}render(){var e;const t=!this._canCommit(),s=this.props.hasFiles?this.props.summary||this.props.amend?this.props.label:this.props.trans.__("Disabled: No commit message summary"):this.props.trans.__("Disabled: No files are staged for commit"),i=Di.CommandRegistry.formatKeystroke(this._getSubmitKeystroke()),n=this.props.trans.__("Summary (%1 to commit)",i);return _.createElement("div",{className:(0,Ne.classes)(qi,"jp-git-CommitBox")},null!==(e=this.props.warning)&&void 0!==e?e:null,!this.props.amend&&_.createElement(ln,{error:this.props.hasFiles&&!this.props.amend&&0===this.props.summary.length,trans:this.props.trans,summary:this.props.summary,summaryPlaceholder:n,description:this.props.description,setSummary:this.props.setSummary,setDescription:this.props.setDescription}),_.createElement(ji.Z,{ref:this._anchorRef,fullWidth:!0,size:"small"},_.createElement(Ni.Z,{classes:{root:en,disabled:on},title:s,disabled:t,onClick:this.props.onCommit},this.props.label),_.createElement(Ni.Z,{classes:{root:en},className:tn,size:"small","aria-controls":this.state.open?"split-button-menu":void 0,"aria-expanded":this.state.open?"true":void 0,"aria-label":"select commit variant","aria-haspopup":"menu",onClick:this._handleToggle},_.createElement(tt.react,{tag:"span"}))),_.createElement(Li.Z,{open:this.state.open,anchorEl:this._anchorRef.current,role:void 0,transition:!0,disablePortal:!0},(({TransitionProps:e})=>_.createElement(Pi.Z,Object.assign({},e),_.createElement(Oi.Z,{classes:{root:nn},className:sn},_.createElement(Bi.Z,{onClickAway:this._handleClose},_.createElement(Ii.Z,{id:"split-button-menu"},this._options.map(((e,t)=>_.createElement(Mi.Z,{key:e.title,classes:{root:nn},selected:this.props.amend?1===t:0===t,onClick:e=>this._handleMenuItemClick(e,t)},(this.props.amend?1===t:0===t)?_.createElement(m.checkIcon.react,{className:Zi,tag:"span"}):_.createElement("span",{className:Zi}),_.createElement("div",{className:Jt},_.createElement("p",{className:ss},e.title),_.createElement("p",{className:Qt},e.description))))))))))))}_canCommit(){return this.props.amend?this.props.hasFiles:!(!this.props.hasFiles||!this.props.summary)}}const hn=(0,Ne.style)({flex:"0 0 auto",display:"flex",flexDirection:"column",marginBlockStart:0,marginBlockEnd:0,paddingLeft:0,overflowY:"auto",borderTop:"var(--jp-border-width) solid var(--jp-border-color2)"}),dn=(0,Ne.style)({paddingLeft:10}),pn=(0,Ne.style)({flex:"0 0 auto",width:"100%",fontSize:"12px",marginBottom:"10px",marginTop:"5px",paddingTop:"5px"}),mn=(0,Ne.style)({fontSize:"13px",fontWeight:"bold",paddingTop:"5px",$nest:{"& span":{alignItems:"center",display:"inline-flex",marginLeft:"5px"},"& span:nth-of-type(1)":{marginLeft:"0px"}}}),gn=(0,Ne.style)({flex:"1 1 auto",margin:"0"}),un=(0,Ne.style)({paddingBottom:"0.5em",fontSize:"13px",fontWeight:"bold"}),fn=(0,Ne.style)({userSelect:"none",display:"flex",flexDirection:"row",alignItems:"center",color:"var(--jp-ui-font-color1)",height:"var(--jp-private-running-item-height)",lineHeight:"var(--jp-private-running-item-height)",whiteSpace:"nowrap",overflow:"hidden",$nest:{"&:hover":{backgroundColor:"var(--jp-layout-color2)"},"&:active":{backgroundColor:"var(--jp-layout-color3)"}}}),_n=(0,Ne.style)({display:"inline-block",width:"13px",height:"13px",right:"10px"}),bn=(0,Ne.style)({$nest:{".jp-icon3":{fill:"var(--md-green-500)"}}}),yn=(0,Ne.style)({$nest:{".jp-icon3":{fill:"var(--md-red-500)"}}}),vn=(0,Ne.style)({$nest:{ul:{paddingLeft:0,margin:0}}}),Cn=(0,Ne.style)({float:"right"}),wn=(0,Ne.style)({paddingTop:"5px",whiteSpace:"pre-wrap",wordWrap:"break-word"});class kn extends _.PureComponent{constructor(){super(...arguments),this._renderFile=e=>{const{data:t,index:s,style:i}=e,n=t[s],r=n.modified_file_path,o=n.previous_file_path,a=!!Se(r)||!n.is_binary;return _.createElement("li",{className:fn,onClick:this.props.onOpenDiff(r,a,o),style:i,title:r},_.createElement(_t,{filepath:r,filetype:n.type}),a?_.createElement(st,{icon:ze,title:this.props.trans.__("View file changes")}):null)}}render(){var e;return _.createElement("div",{className:this.props.className},_.createElement("div",{className:pn},_.createElement("div",{className:mn},_.createElement("span",{title:this.props.trans.__("# Files Changed")},_.createElement(m.fileIcon.react,{className:_n,tag:"span"}),this.props.numFiles),_.createElement("span",{title:this.props.trans.__("# Insertions")},_.createElement(Ge.react,{className:(0,Ne.classes)(_n,bn),tag:"span"}),this.props.insertions),_.createElement("span",{title:this.props.trans.__("# Deletions")},_.createElement(He.react,{className:(0,Ne.classes)(_n,yn),tag:"span"}),this.props.deletions))),_.createElement("div",{className:gn},_.createElement("div",{className:un},this.props.trans.__("Changed"),null!==(e=this.props.actions)&&void 0!==e?e:null),this.props.files.length>0&&_.createElement(Ct.FixedSizeList,{className:vn,height:24*Math.min(5,this.props.files.length),innerElementType:"ul",itemCount:this.props.files.length,itemData:this.props.files,itemKey:(e,t)=>t[e].modified_file_path,itemSize:24,style:{overflowX:"hidden"},width:"auto"},this._renderFile)))}}function xn(e){const[t,s]=_.useState(!1),[i,n]=_.useState([]),{referenceCommit:r,challengerCommit:o,model:a}=e,l=null!==r&&null!==o,c=i.reduce(((e,t)=>{const s=Number.parseInt(t.insertion,10);return e+(Number.isNaN(s)?0:s)}),0),h=i.reduce(((e,t)=>{const s=Number.parseInt(t.deletion,10);return e+(Number.isNaN(s)?0:s)}),0);return _.useEffect((()=>{(async()=>{if(null===r||null===o)return void n([]);let t=null;try{if(t=await a.diff(r.commit,o.commit),0!==t.code)throw new Error(t.message)}catch(t){const s=`Failed to get the diff for ${r.commit} and ${o.commit}.`;return console.error(s,t),void e.logger.log({level:fe.ERROR,message:s,error:t})}n(t?t.result.map((e=>{const t=e.filename.split("/"),s=t[t.length-1],i=e.filename;return{deletion:e.deletions,insertion:e.insertions,is_binary:"-"===e.deletions||"-"===e.insertions,modified_file_name:s,modified_file_path:i,type:e.filetype}})):[])})()}),[r,o]),_.createElement("div",{className:hn},_.createElement("div",{className:wt,onClick:()=>s(!t)},_.createElement("button",{className:St},t?_.createElement(m.caretRightIcon.react,null):_.createElement(m.caretDownIcon.react,null)),_.createElement("span",{className:xt},e.header),_.createElement(st,{title:e.trans.__("Close"),icon:m.closeIcon,onClick:t=>{e.onClose(t)}})),!t&&(i.length?_.createElement(kn,{className:dn,deletions:`${h}`,files:i,insertions:`${c}`,numFiles:`${i.length}`,onOpenDiff:e.onOpenDiff,trans:e.trans}):_.createElement("p",null,l?e.trans.__("No changes"):e.trans.__("No challenger commit selected."))))}const En=(0,Ne.style)({minHeight:"48px",top:0,position:"sticky",flexGrow:0,flexShrink:0,overflowX:"hidden",backgroundColor:"var(--jp-toolbar-active-background)"}),Sn=(0,Ne.style)({display:"flex",justifyContent:"center",padding:"10px 0",color:"var(--jp-ui-font-color2)"}),Fn=(0,Ne.style)({flex:"1 1 auto",display:"flex",flexDirection:"column",minHeight:"200px",marginBlockStart:0,marginBlockEnd:0,paddingLeft:0,overflowY:"auto"}),Rn=(0,Ne.style)({display:"flex"}),Dn=(0,Ne.style)({flexGrow:0,display:"flex",flexShrink:0,flexDirection:"column",padding:"5px 0px 5px 10px",borderBottom:"var(--jp-border-width) solid var(--jp-border-color2)"}),Nn=(0,Ne.style)({display:"flex",color:"var(--jp-ui-font-color2)",paddingBottom:"5px"}),jn=(0,Ne.style)({width:"30%",paddingLeft:"0.5em",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",textAlign:"left",$nest:{"&:first-child":{paddingLeft:0}}}),Bn=(0,Ne.style)({display:"flex",fontSize:"0.8em",marginLeft:"-5px"}),Pn=(0,Ne.style)({padding:"2px",color:"var(--md-grey-900)",border:"var(--jp-border-width) solid var(--md-grey-700)",borderRadius:"4px",margin:"3px"}),Mn=(0,Ne.style)({backgroundColor:"var(--md-blue-100)"}),In=(0,Ne.style)({backgroundColor:"var(--md-orange-100)"}),On=(0,Ne.style)({backgroundColor:"var(--md-red-100)"}),Ln=(0,Ne.style)({backgroundColor:"var(--jp-layout-color1)"}),Tn=(0,Ne.style)({flex:"auto"}),An=(0,Ne.style)({width:"16px",height:"16px",margin:"auto 8px auto auto"}),Hn=(0,Ne.style)({$nest:{"&:hover":{backgroundColor:"var(--jp-layout-color2)"}}}),Un=(0,Ne.style)({borderLeft:"6px solid var(--jp-git-diff-deleted-color1)"}),zn=(0,Ne.style)({borderLeft:"6px solid var(--jp-git-diff-added-color1)"});class Wn extends _.Component{constructor(e){super(e),this._onCommitClick=(e,t)=>{var s;this.props.children?this.props.toggleCommitExpansion(t):null===(s=this.props.onOpenDiff)||void 0===s||s.call(this,e)}}render(){return _.createElement("li",{id:this.props.commit.commit,ref:e=>this.props.setRef(e),className:(0,Ne.classes)(Dn,!this.props.children&&this.props.onOpenDiff?Hn:this.props.expanded?Ln:null,this.props.isReferenceCommit&&Un,this.props.isChallengerCommit&&zn),title:this.props.children?this.props.trans.__("View commit details"):this.props.trans.__("View file changes"),onClick:e=>this._onCommitClick(e,this.props.commit.commit)},_.createElement("div",{className:Nn},_.createElement("span",{className:jn},this.props.commit.author),_.createElement("span",{className:jn},+this.props.commit.commit in ue.Diff.SpecialRef?ue.Diff.SpecialRef[+this.props.commit.commit]:this.props.commit.commit.slice(0,7)),_.createElement("span",{className:jn},this.props.commit.date),!this.props.commit.is_binary&&_.createElement(_.Fragment,null,_.createElement(st,{className:An,disabled:null===this.props.onSelectForCompare,icon:Je,title:this.props.trans.__("Select for compare"),onClick:this.props.onSelectForCompare}),_.createElement(st,{className:An,disabled:null===this.props.onCompareWithSelected,icon:Ae,title:this.props.trans.__("Compare with selected"),onClick:this.props.onCompareWithSelected})),this.props.children?this.props.expanded?_.createElement(m.caretUpIcon.react,{className:An,tag:"span"}):_.createElement(m.caretDownIcon.react,{className:An,tag:"span"}):_.createElement(ze.react,{className:An,tag:"span"})),_.createElement("div",{className:Bn},this._renderBranches()),_.createElement("div",{className:Tn},this.props.commit.commit_msg,this.props.expanded&&this.props.children))}_renderBranches(){const e=this.props.commit.commit,t=[];for(let s=0;s<this.props.branches.length;s++){const i=this.props.branches[s];i.top_commit&&i.top_commit===e&&t.push(i)}return t.map(this._renderBranch,this)}_renderBranch(e){return _.createElement(_.Fragment,{key:e.name},e.is_current_branch&&_.createElement("span",{className:(0,Ne.classes)(Pn,On)},"working"),_.createElement("span",{className:(0,Ne.classes)(Pn,e.is_remote_branch?Mn:In)},e.name))}}const Gn=(0,Ne.style)({height:"auto",width:"380px",color:"var(--jp-ui-font-color1)!important",borderRadius:"3px!important",backgroundColor:"var(--jp-layout-color1)!important"}),$n=(0,Ne.style)({position:"absolute",top:"10px",right:"12px",height:"30px",width:"30px",padding:0,border:"none",borderRadius:"50%",backgroundColor:"var(--jp-layout-color1)",$nest:{svg:{fill:"var(--jp-ui-font-color1)"},"&:hover":{backgroundColor:"var(--jp-border-color2)"},"&:active":{backgroundColor:"var(--jp-border-color2)"}}}),Vn=(0,Ne.style)({boxSizing:"border-box",position:"relative",padding:"15px",borderBottom:"var(--jp-border-width) solid var(--jp-border-color2)"}),Zn=(0,Ne.style)({fontWeight:700}),qn=(0,Ne.style)({padding:"15px",$nest:{"> p":{marginBottom:"7px"}}}),Kn=(0,Ne.style)({padding:"15px!important",borderTop:"var(--jp-border-width) solid var(--jp-border-color2)"}),Xn=(0,Ne.style)({boxSizing:"border-box",width:"9em",height:"2em",color:"white",fontSize:"var(--jp-ui-font-size1)",cursor:"pointer",border:"0",borderRadius:"3px",$nest:{"&:disabled":{cursor:"default"}}}),Yn=(0,Ne.style)({backgroundColor:"var(--md-grey-500)",$nest:{"&:hover":{backgroundColor:"var(--md-grey-600)"},"&:active":{backgroundColor:"var(--md-grey-700)"}}}),Jn=(0,Ne.style)({backgroundColor:"var(--md-blue-500)",$nest:{"&:hover":{backgroundColor:"var(--md-blue-600)"},"&:active":{backgroundColor:"var(--md-blue-700)"},"&:disabled":{color:"var(--jp-ui-inverse-font-color0)",backgroundColor:"var(--jp-layout-color3)"},"&:disabled:hover":{backgroundColor:"var(--jp-layout-color3)"},"&:disabled:active":{backgroundColor:"var(--jp-layout-color3)"}}}),Qn=(0,Ne.style)({display:"flex",flexWrap:"wrap",marginTop:"auto",padding:0,alignItems:"flex-start",backgroundColor:"var(--jp-layout-color1)"});(0,Ne.style)({width:"100%",height:"1.5em",marginBottom:"1em",padding:"var(--jp-code-padding)",outline:"none",overflowX:"auto",color:"var(--jp-ui-font-color1)",fontSize:"var(--jp-ui-font-size1)",fontWeight:300,backgroundColor:"var(--jp-layout-color1)",border:"var(--jp-border-width) solid var(--jp-border-color2)",borderRadius:"3px",$nest:{"&:active":{border:"var(--jp-border-width) solid var(--jp-brand-color1)"},"&:focus":{border:"var(--jp-border-width) solid var(--jp-brand-color1)"}}}),(0,Ne.style)({width:"100%",marginBottom:"1em",padding:"var(--jp-code-padding)",outline:"none",overflowX:"auto",resize:"none",color:"var(--jp-ui-font-color1)",fontSize:"var(--jp-ui-font-size1)",fontWeight:300,backgroundColor:"var(--jp-layout-color1)",border:"var(--jp-border-width) solid var(--jp-border-color2)",borderRadius:"3px",$nest:{"&:focus":{outline:"none",border:"var(--jp-border-width) solid var(--jp-brand-color1)"},"&:active":{outline:"none",border:"var(--jp-border-width) solid var(--jp-brand-color1)"},"&::placeholder":{color:"var(--jp-ui-font-color3)"},"&::-webkit-input-placeholder":{color:"var(--jp-ui-font-color3)"},"&::-moz-placeholder":{color:"var(--jp-ui-font-color3)"},"&::-ms-input-placeholder":{color:"var(--jp-ui-font-color3)"}}});class er extends _.Component{constructor(e){super(e),this._onSummaryChange=e=>{this.setState({summary:e})},this._onDescriptionChange=e=>{this.setState({description:e})},this._onClick=e=>{e.stopPropagation()},this._onClose=e=>{e.stopPropagation(),this.props.onClose(),this._reset()},this._onSubmit=async()=>{this.setState({disabled:!0}),"reset"===this.props.action?this._resetCommit(this.props.commit.commit):this._revertCommit(this.props.commit.commit),this._reset(),this.props.onClose()},this.state={summary:"",description:"",disabled:!1}}render(){const e=this.props.commit.commit.slice(0,7),t="revert"===this.props.action;return _.createElement(It.Z,{classes:{paper:Gn},open:this.props.open,onClick:this._onClick,onClose:this._onClose},_.createElement("div",{className:Vn},_.createElement("p",{className:Zn},t?this.props.trans.__("Revert Changes"):this.props.trans.__("Reset Changes")),_.createElement("button",{className:$n},_.createElement(Tt.Z,{titleAccess:this.props.trans.__("Close this dialog"),fontSize:"small",onClick:this._onClose}))),_.createElement("div",{className:qn},_.createElement("p",null,t?this.props.trans.__("These changes will be reverted. Only commit if you're sure you're okay losing these changes."):this.props.trans.__("All changes after commit %1 will be gone forever (hard reset). Are you sure?",e)),t&&_.createElement("div",{className:Qn},_.createElement(ln,{trans:this.props.trans,summary:this.state.summary,summaryPlaceholder:this._defaultSummary(),description:this.state.description,descriptionPlaceholder:this._defaultDescription(),setSummary:this._onSummaryChange,setDescription:this._onDescriptionChange}))),_.createElement(Ot.Z,{className:Kn},_.createElement("input",{disabled:this.state.disabled,className:(0,Ne.classes)(Xn,Yn),type:"button",title:this.props.trans.__("Cancel changes"),value:"Cancel",onClick:this._onClose}),_.createElement("input",{disabled:this.state.disabled,className:(0,Ne.classes)(Xn,Jn),type:"button",title:this.props.trans.__("Submit changes"),value:"Submit",onClick:this._onSubmit})))}async _resetCommit(e){this.props.logger.log({level:fe.RUNNING,message:this.props.trans.__("Discarding changes…")});try{await this.props.model.resetToCommit(e),this.props.logger.log({level:fe.SUCCESS,message:this.props.trans.__("Successfully discarded changes.")})}catch(t){this.props.logger.log({level:fe.ERROR,message:this.props.trans.__("Failed to discard changes."),error:new Error(`Failed to discard changes after ${e.slice(0,7)}: ${t}`)})}}async _revertCommit(e){this.props.logger.log({level:fe.RUNNING,message:this.props.trans.__("Reverting changes…")});try{await this.props.model.revertCommit(this._commitMessage(),e),this.props.logger.log({level:fe.SUCCESS,message:this.props.trans.__("Successfully reverted changes.")})}catch(t){this.props.logger.log({level:fe.ERROR,message:this.props.trans.__("Failed to revert changes."),error:new Error(`Failed to revert ${e.slice(0,7)}: ${t}`)})}}_defaultSummary(){const e=this.props.commit.commit_msg.split("\n")[0];return this.props.trans.__("Revert '%1'",e)}_defaultDescription(){return this.props.trans.__("This reverts commit %1",this.props.commit.commit)}_commitMessage(){return(this.state.summary||this._defaultSummary())+"\n\n"+(this.state.description||this._defaultDescription())+"\n"}_reset(){this.setState({summary:"",description:"",disabled:!1})}}class tr extends _.Component{constructor(e){super(e),this._onRevertClick=e=>{e.stopPropagation(),this.setState({resetRevertDialog:!0,resetRevertAction:"revert"})},this._onResetClick=e=>{e.stopPropagation(),this.setState({resetRevertDialog:!0,resetRevertAction:"reset"})},this._onResetRevertDialogClose=()=>{this.setState({resetRevertDialog:!1})},this.state={info:"",commitBody:"",numFiles:"",insertions:"",deletions:"",modifiedFiles:[],loadingState:"loading",resetRevertDialog:!1,resetRevertAction:"reset"}}async componentDidMount(){try{const e=await this.props.model.detailedLog(this.props.commit.commit);this.setState({info:e.modified_file_note,commitBody:e.commit_body,numFiles:e.modified_files_count,insertions:e.number_of_insertions,deletions:e.number_of_deletions,modifiedFiles:e.modified_files,loadingState:"success"})}catch(e){return console.error(`Error while getting detailed log for commit ${this.props.commit.commit} and path ${this.props.model.pathRepository}`,e),void this.setState({loadingState:"error"})}}render(){return"loading"===this.state.loadingState?_.createElement("div",null,"…"):"error"===this.state.loadingState?_.createElement("div",null,this.props.trans.__("Error loading commit data")):_.createElement("div",null,_.createElement("p",{className:wn},this.state.commitBody),_.createElement(kn,{actions:_.createElement(_.Fragment,null,_.createElement(st,{className:Cn,icon:We,title:this.props.trans.__("Revert changes introduced by this commit"),onClick:this._onRevertClick}),_.createElement(st,{className:Cn,icon:Ye,title:this.props.trans.__("Discard changes introduced *after* this commit (hard reset)"),onClick:this._onResetClick}),_.createElement(hs.Consumer,null,(e=>_.createElement(er,{open:this.state.resetRevertDialog,action:this.state.resetRevertAction,model:this.props.model,logger:e,commit:this.props.commit,onClose:this._onResetRevertDialogClose,trans:this.props.trans})))),numFiles:this.state.numFiles,insertions:this.state.insertions,deletions:this.state.deletions,files:this.state.modifiedFiles,onOpenDiff:this.props.onOpenDiff,trans:this.props.trans}))}}class sr{constructor(){this._SVGPath=[]}toString(){return this._SVGPath.join(" ")}moveTo(e,t){this._SVGPath.push(`M ${e},${t}`)}lineTo(e,t){this._SVGPath.push(`L ${e},${t}`)}closePath(){this._SVGPath.push("Z")}bezierCurveTo(e,t,s,i,n,r){this._SVGPath.push(`C ${e}, ${t}, ${s}, ${i}, ${n}, ${r}`)}}const ir=["#e11d21","#fbca04","#009800","#006b75","#207de5","#0052cc","#5319e7","#f7c6c7","#fad8c7","#fef2c0","#bfe5bf","#c7def8","#bfdadc","#bfd4f2","#d4c5f9","#cccccc","#84b6eb","#e6e6e6","#cc317c"],nr=function(e){return ir[e%ir.length]};class rr extends _.Component{constructor(e){super(e),this._graphData=[],this._x_step=10,this._dotRadius=this.props.dotRadius||3,this._lineWidth=this.props.lineWidth||2}getGraphData(){return this._graphData=function(e,t){const s=[],i=[0],n=[],r={};function o(e){return null!==r[e]&&void 0!==r[e]||(r[e]=i[0],n.push(i[0]),i[0]++),r[e]}let a=25;return e.forEach(((i,l)=>{let c,h;const d=o(i.sha),p=i.parents.length,m=n.indexOf(d),g=[];if(1===p)if(r[i.parents[0]]||0===r[i.parents[0]]){const e=n.slice(m+1);for(h=0;h<e.length;h++)c=e[h],g.push({from:h+m+1,to:h+m+1-1,branch:c});const t=n.slice(0,m);for(h=0;h<t.length;h++)c=t[h],g.push({from:h,to:h,branch:c});f=d,(u=n).splice(u.indexOf(f),1),g.push({from:m,to:n.indexOf(r[i.parents[0]]),branch:d})}else{for(h=0;h<n.length;h++)c=n[h],g.push({from:h,to:h,branch:c});r[i.parents[0]]=d}else if(2===p){for(r[i.parents[0]]=d,h=0;h<n.length;h++)c=n[h],g.push({from:h,to:h,branch:c});const e=o(i.parents[1]);g.push({from:m,to:n.indexOf(e),branch:e})}var u,f;l-1>=0&&(a+=t(e[l-1].sha));const _=((e,t,s,i,n)=>({sha:e,dot:{lateralOffset:t,branch:s},routes:i,yOffset:n}))(i.sha,m,d,g,a);s.push(_)})),s}(this.props.commits,this.props.getNodeHeight),this._graphData}getBranchCount(){return(e=>{let t=-1;return e.forEach((e=>{t=e.routes.reduce(((e,t)=>Math.max(e,t.from,t.to)),t)})),t+1})(this.getGraphData())}getWidth(){return(this.getBranchCount()+.5)*this._x_step}getHeight(){return this._graphData[this._graphData.length-1].yOffset+this.props.getNodeHeight(this.props.commits[this.props.commits.length-1].sha)}renderRouteNode(e,t){const s={stroke:nr(t),"stroke-width":this._lineWidth,fill:"none"},i=`commits-graph-branch-${t}`;return _.createElement("path",{d:e,style:s,className:i})}renderRoute(e,t,s){const{from:i,to:n,branch:r}=t,o=this._x_step,a=new sr,l=(i+1)*o,c=e,h=(n+1)*o,d=e+s;return a.moveTo(l,c),l===h?a.lineTo(h,d):a.bezierCurveTo(l-o/4,c+s/2,h+o/4,d-s/2,h,d),this.renderRouteNode(a.toString(),r)}renderCommitNode(e,t,s,i){const n=this._dotRadius,r=nr(i),o={stroke:r,"stroke-width":1,fill:r},a=`commits-graph-branch-${i}`;return _.createElement("circle",{cx:e,cy:t,r:n,style:o,"data-sha":s,className:a},_.createElement("title",null,s.slice(0,7)))}renderCommit(e){const{sha:t,dot:s,routes:i,yOffset:n}=e,{lateralOffset:r,branch:o}=s,a=(r+1)*this._x_step,l=n;return[this.renderCommitNode(a,l,t,o),i.map((t=>this.renderRoute(e.yOffset,t,this.props.getNodeHeight(e.sha))))]}render(){const e=[];let t=[];this.getGraphData().forEach((s=>{const i=s,[n,r]=this.renderCommit(i);e.push(n),t=t.concat(r)}));const s=[].concat(t,e),i=this.getHeight(),n=this.getWidth(),r={height:i,width:n,"flex-shrink":0};return _.createElement("svg",{height:i,width:n,style:r},s)}}const or=e=>{var t;const s=()=>{e.model.selectedHistoryFile=null},i=_.useMemo((()=>{var t,s,i;return{author:e.trans.__("You"),commit:`${"staged"===(null===(t=e.model.selectedHistoryFile)||void 0===t?void 0:t.status)?ue.Diff.SpecialRef.INDEX:ue.Diff.SpecialRef.WORKING}`,pre_commits:["HEAD"],is_binary:null!==(i=null===(s=e.commits[0])||void 0===s?void 0:s.is_binary)&&void 0!==i&&i,commit_msg:e.trans.__("Uncommitted Changes"),date:e.trans.__("now")}}),[e.model.selectedHistoryFile]),n=e.model.selectedHistoryFile&&"unmodified"!==(null===(t=e.model.selectedHistoryFile)||void 0===t?void 0:t.status)?[i,...e.commits]:e.commits,[r,o]=_.useState([]),[a,l]=_.useState({}),c=_.useRef({});return _.useEffect((()=>{const t=new ResizeObserver((e=>{for(const t of e){const e=(Array.isArray(t.borderBoxSize)?t.borderBoxSize[0]:t.borderBoxSize).blockSize,s=t.target.id;l((t=>Object.assign(Object.assign({},t),{[s]:e})))}}));return e.commits.forEach((e=>t.observe(c.current[e.commit],{box:"border-box"}))),()=>t.disconnect()}),[e.commits]),_.createElement("div",{className:Rn},!e.model.selectedHistoryFile&&_.createElement(rr,{commits:e.commits.map((e=>({sha:e.commit,parents:e.pre_commits}))),getNodeHeight:e=>{var t;return null!==(t=a[e])&&void 0!==t?t:55}}),_.createElement("ol",{className:Fn},!!e.model.selectedHistoryFile&&_.createElement(vt,{className:En,model:e.model,trans:e.trans,actions:_.createElement(st,{className:Be,icon:m.closeIcon,title:e.trans.__("Discard file history"),onClick:s}),file:e.model.selectedHistoryFile,onDoubleClick:s}),n.length?n.map((t=>{var s,i,n;const a={commit:t,branches:e.branches,model:e.model,commands:e.commands,trans:e.trans},l=e.model.selectedHistoryFile&&!t.is_binary?xe(e.commands)(t)(null!==(s=t.file_path)&&void 0!==s?s:e.model.selectedHistoryFile.to,!t.is_binary,t.previous_file_path):void 0,h=t.commit===(null===(i=e.referenceCommit)||void 0===i?void 0:i.commit),d=t.commit===(null===(n=e.challengerCommit)||void 0===n?void 0:n.commit);return _.createElement(Wn,Object.assign({key:t.commit,setRef:e=>{c.current[t.commit]=e}},a,{isReferenceCommit:h,isChallengerCommit:d,onOpenDiff:l,onSelectForCompare:d?null:e.onSelectForCompare(t),onCompareWithSelected:h||null===e.referenceCommit?null:e.onCompareWithSelected(t),expanded:r.includes(t.commit),toggleCommitExpansion:e=>o((t=>t.includes(e)?t.filter((t=>t!==e)):[...t,e]))}),!e.model.selectedHistoryFile&&_.createElement(tr,Object.assign({},a,{onOpenDiff:xe(e.commands)(t)})))})):_.createElement("li",{className:Sn},e.trans.__("No history found."))))};var ar=s(2822);class lr extends _.Component{constructor(e){super(e),this._renderItem=e=>{const{data:t,index:s,style:i}=e,n=t[s],r=n.name===this.state.base;let o,a;return n.name===this.props.currentBranch?(o=!0,a=this.props.trans.__("The current branch. Pick this if you want to build on work done in this branch.")):["master","main"].includes(n.name)&&(o=!0,a=this.props.trans.__("The default branch. Pick this if you want to start fresh from the default branch.")),_.createElement(Lt.Z,{button:!0,title:this.props.trans.__("Create a new branch based on: %1",n.name),className:(0,Ne.classes)(Xt,r?Yt:null),onClick:this._onBranchClickFactory(n.name),style:i},_.createElement(Le.react,{className:es,tag:"span"}),_.createElement("div",{className:Jt},_.createElement("p",{className:(0,Ne.classes)(ts,o?ss:null)},n.name),a?_.createElement("p",{className:Qt},this.props.trans.__(a)):null))},this._onClose=()=>{this.props.onClose(),this.setState({name:"",filter:"",error:""})},this._onFilterChange=e=>{this._branchList.current.resetAfterIndex(0),this.setState({filter:e.target.value})},this._resetFilter=()=>{this._branchList.current.resetAfterIndex(0),this.setState({filter:""})},this._onNameChange=e=>{this.setState({name:e.target.value,error:""})},this._branchList=_.createRef(),this.state={name:"",base:e.currentBranch||"",filter:"",error:""}}render(){return _.createElement(It.Z,{classes:{paper:At},open:this.props.open,onClose:this._onClose},_.createElement("div",{className:Ut},_.createElement("p",{className:zt},this.props.trans.__("Create a Branch")),_.createElement("button",{className:Ht},_.createElement(Tt.Z,{titleAccess:this.props.trans.__("Close this dialog"),fontSize:"small",onClick:this._onClose}))),_.createElement("div",{className:Wt},this.state.error?_.createElement("p",{className:is},this.state.error):null,_.createElement("p",null,this.props.trans.__("Name")),_.createElement("input",{className:Gt,type:"text",onChange:this._onNameChange,value:this.state.name,placeholder:"",title:this.props.trans.__("Enter a branch name")}),_.createElement("p",null,this.props.trans.__("Create branch based on…")),_.createElement("div",{className:$t},_.createElement("div",{className:Vt},_.createElement("input",{className:Zt,type:"text",onChange:this._onFilterChange,value:this.state.filter,placeholder:this.props.trans.__("Filter"),title:this.props.trans.__("Filter branch menu")}),this.state.filter?_.createElement("button",{className:qt},_.createElement(Tt.Z,{titleAccess:this.props.trans.__("Clear the current filter"),fontSize:"small",onClick:this._resetFilter})):null)),this._renderItems()),_.createElement(Ot.Z,{className:ns},_.createElement("input",{className:(0,Ne.classes)(rs,os),type:"button",title:this.props.trans.__("Close this dialog without creating a new branch"),value:this.props.trans.__("Cancel"),onClick:this._onClose}),_.createElement("input",{className:(0,Ne.classes)(rs,as),type:"button",title:this.props.trans.__("Create a new branch"),value:this.props.trans.__("Create Branch"),onClick:()=>{this._createBranch()},disabled:""===this.state.name||""!==this.state.error})))}_renderItems(){const e=this.props.currentBranch,t=this.state.filter,s=this.props.branches.filter((e=>!t||e.name.includes(t))).slice().sort((function(t,s){return t.name===e?-1:s.name===e?1:"master"===t.name?-1:"master"===s.name?1:"main"===t.name?-1:"main"===s.name?1:0}));return _.createElement(Ct.VariableSizeList,{className:Kt,height:200,estimatedItemSize:27.5,itemCount:s.length,itemData:s,itemKey:(e,t)=>t[e].name,itemSize:e=>{const t=s[e];return[this.props.currentBranch,"master","main"].includes(t.name)?66.5:27.5},ref:this._branchList,style:{overflowX:"hidden"},width:"auto"},this._renderItem)}_onBranchClickFactory(e){const t=this;return function(){t.setState({base:e})}}async _createBranch(){const e={newBranch:!0,branchname:this.state.name,startpoint:this.state.base};this.props.logger.log({level:fe.RUNNING,message:this.props.trans.__("Creating branch…")});try{await this.props.model.checkout(e)}catch(e){return this.setState({error:e.message.replace(/^fatal:/,"")}),void this.props.logger.log({level:fe.ERROR,message:this.props.trans.__("Failed to create branch.")})}this.props.logger.log({level:fe.SUCCESS,message:this.props.trans.__("Branch created.")}),this.props.onClose(),this._branchList.current.resetAfterIndex(0),this.setState({name:"",filter:""})}}function cr(e){return _.createElement(Lt.Z,{key:e},e)}class hr extends _.Component{constructor(e){super(e),this.CHANGES_ERR_MSG=this.props.trans.__("The current branch contains files with uncommitted changes. Please commit or discard these changes before switching to or creating another branch."),this._renderItem=e=>{const{data:t,index:s,style:i}=e,n=t[s],r=n.name===this.props.currentBranch;return _.createElement(Lt.Z,{button:!0,title:r?"":this.props.trans.__("Switch to branch: %1",n.name),className:(0,Ne.classes)($i,r?Vi:null),onClick:this._onBranchClickFactory(n.name),style:i},_.createElement(Le.react,{className:Zi,tag:"span"}),_.createElement("span",{className:Ti},n.name),!n.is_remote_branch&&!r&&_.createElement(_.Fragment,null,_.createElement(st,{className:Be,icon:et,title:this.props.trans.__("Delete this branch locally"),onClick:async e=>{e.stopPropagation(),await this._onDeleteBranch(n.name)}}),_.createElement(st,{className:Be,icon:Ve,title:this.props.trans.__("Merge this branch into the current one"),onClick:e=>{e.stopPropagation(),this._onMergeBranch(n.name)}})))},this._onFilterChange=e=>{this.setState({filter:e.target.value})},this._resetFilter=()=>{this.setState({filter:""})},this._onDeleteBranch=async e=>{if((await(0,n.showDialog)({title:this.props.trans.__("Delete branch"),body:_.createElement("p",null,this.props.trans.__("Are you sure you want to permanently delete the branch "),_.createElement("b",null,e),"?",_.createElement("br",null),this.props.trans.__("This action cannot be undone.")),buttons:[n.Dialog.cancelButton({label:this.props.trans.__("Cancel")}),n.Dialog.warnButton({label:this.props.trans.__("Delete")})]})).button.accept)try{await this.props.model.deleteBranch(e),await this.props.model.refreshBranch()}catch(t){console.error(`Failed to delete branch ${e}`,t)}},this._onMergeBranch=async e=>{await this.props.commands.execute(be.gitMerge,{branch:e})},this._onNewBranchClick=()=>{this.props.branching?this.setState({branchDialog:!0}):(0,n.showErrorMessage)(this.props.trans.__("Creating a new branch is disabled"),this.CHANGES_ERR_MSG)},this._onNewBranchDialogClose=()=>{this.setState({branchDialog:!1})},this.state={filter:"",branchDialog:!1}}render(){return _.createElement("div",{className:Ai},this._renderFilter(),this._renderBranchList(),this._renderNewBranchDialog())}_renderFilter(){return _.createElement("div",{className:Hi},_.createElement("div",{className:Ui},_.createElement("input",{className:zi,type:"text",onChange:this._onFilterChange,value:this.state.filter,placeholder:this.props.trans.__("Filter"),title:this.props.trans.__("Filter branch menu")}),this.state.filter?_.createElement("button",{className:Wi},_.createElement(Tt.Z,{titleAccess:this.props.trans.__("Clear the current filter"),fontSize:"small",onClick:this._resetFilter})):null),_.createElement("input",{className:Gi,type:"button",title:this.props.trans.__("Create a new branch"),value:this.props.trans.__("New Branch"),onClick:this._onNewBranchClick}))}_renderBranchList(){const e=this.state.filter,t=this.props.branches.filter((t=>!e||t.name.includes(e)));return _.createElement(Ct.FixedSizeList,{height:Math.min(Math.max(150,24.8*t.length),400),itemCount:t.length,itemData:t,itemKey:(e,t)=>t[e].name,itemSize:24.8,style:{overflowX:"hidden",paddingTop:0,paddingBottom:0},width:"auto"},this._renderItem)}_renderNewBranchDialog(){return _.createElement(lr,{currentBranch:this.props.currentBranch,branches:this.props.branches,logger:this.props.logger,open:this.state.branchDialog,model:this.props.model,onClose:this._onNewBranchDialogClose,trans:this.props.trans})}_onBranchClickFactory(e){const t=this;return async function(){if(!t.props.branching)return void(0,n.showErrorMessage)(t.props.trans.__("Switching branches is disabled"),t.CHANGES_ERR_MSG);const s={branchname:e};t.props.logger.log({level:fe.RUNNING,message:t.props.trans.__("Switching branch…")});try{await t.props.model.checkout(s)}catch(e){return function(e,t,s){e.message.includes("following files would be overwritten")?(t.log({message:"",level:fe.INFO}),(0,n.showDialog)({title:s.__("Unable to switch branch"),body:_.createElement(_.Fragment,null,_.createElement("p",null,s.__("Your changes to the following files would be overwritten by switching:")),_.createElement(ar.Z,null,e.message.split("\n").slice(1,-3).map(cr)),_.createElement("span",null,s.__("Please commit, stash, or discard your changes before you switch branches."))),buttons:[n.Dialog.okButton({label:s.__("Dismiss")})]})):t.log({level:fe.ERROR,message:s.__("Failed to switch branch."),error:e})}(e,t.props.logger,t.props.trans)}t.props.logger.log({level:fe.SUCCESS,message:t.props.trans.__("Switched branch.")})}}}function dr(e){return _.createElement(Lt.Z,{key:e},e)}class pr extends _.Component{constructor(e){super(e),this._renderItem=e=>{const{data:t,index:s,style:i}=e,n=t[s];return _.createElement(Lt.Z,{button:!0,title:this.props.trans.__("Checkout to tag: %1",n),className:$i,onClick:this._onTagClickFactory(n),style:i},_.createElement(Qe.react,{className:Zi,tag:"span"}),_.createElement("span",{className:Ti},n))},this._onFilterChange=e=>{this.setState({filter:e.target.value})},this._resetFilter=()=>{this.setState({filter:""})},this.state={filter:"",tags:[]}}componentDidMount(){this.props.model.tags().then((e=>{this.setState({tags:e.tags})})).catch((e=>{console.error(e),this.setState({tags:[]}),(0,n.showErrorMessage)(this.props.trans.__("Fail to get the tags."),e)}))}render(){return _.createElement("div",{className:Ai},this._renderFilter(),this._renderTagList())}_renderFilter(){return _.createElement("div",{className:Hi},_.createElement("div",{className:Ui},_.createElement("input",{className:zi,type:"text",onChange:this._onFilterChange,value:this.state.filter,placeholder:this.props.trans.__("Filter"),title:this.props.trans.__("Filter branch menu")}),this.state.filter?_.createElement("button",{className:Wi},_.createElement(Tt.Z,{titleAccess:this.props.trans.__("Clear the current filter"),fontSize:"small",onClick:this._resetFilter})):null))}_renderTagList(){const e=this.state.filter,t=this.state.tags.filter((t=>!e||t.includes(e)));return _.createElement(Ct.FixedSizeList,{height:Math.min(Math.max(150,24.8*t.length),400),itemCount:t.length,itemData:t,itemKey:(e,t)=>t[e],itemSize:24.8,style:{overflowX:"hidden",paddingTop:0,paddingBottom:0},width:"auto"},this._renderItem)}_onTagClickFactory(e){const t=this;return async function(){if(t.props.branching){t.props.logger.log({level:fe.RUNNING,message:t.props.trans.__("Checking tag out…")});try{await t.props.model.checkoutTag(e)}catch(e){return function(e,t,s){e.message.includes("following files would be overwritten")?(t.log({message:"",level:fe.INFO}),(0,n.showDialog)({title:s.__("Unable to checkout tag"),body:_.createElement(_.Fragment,null,_.createElement("p",null,s.__("Your changes to the following files would be overwritten by switching:")),_.createElement(ar.Z,null,e.message.split("\n").slice(1,-3).map(dr)),_.createElement("span",null,s.__("Please commit, stash, or discard your changes before you checkout tags."))),buttons:[n.Dialog.okButton({label:s.__("Dismiss")})]})):t.log({level:fe.ERROR,message:s.__("Failed to checkout tag."),error:e})}(e,t.props.logger,t.props.trans)}t.props.logger.log({level:fe.SUCCESS,message:t.props.trans.__("Tag checkout.")})}else(0,n.showErrorMessage)(t.props.trans.__("Checkout tags is disabled"),t.props.trans.__("The repository contains files with uncommitted changes. Please commit or discard these changes before switching to a tag."))}}}class mr extends _.Component{constructor(e){super(e),this._onPullClick=async()=>{await this.props.commands.execute(be.gitPull)},this._onPushClick=async()=>{await this.props.commands.execute(be.gitPush)},this._onBranchClick=()=>{this.setState({branchMenu:!this.state.branchMenu})},this._onRefreshClick=async()=>{this.props.logger.log({level:fe.RUNNING,message:this.props.trans.__("Refreshing…")});try{await this.props.model.refresh(),this.props.logger.log({level:fe.SUCCESS,message:this.props.trans.__("Successfully refreshed.")})}catch(e){console.error(e),this.props.logger.log({level:fe.ERROR,message:this.props.trans.__("Failed to refresh."),error:e})}},this.state={branchMenu:!1,tab:0}}render(){return _.createElement("div",{className:Gs},this._renderTopNav(),this._renderRepoMenu(),this._renderBranchMenu())}_renderTopNav(){var e;const t=this.props.branches.filter((e=>e.is_current_branch)),s=this.props.branches.some((e=>e.is_remote_branch)),i=null!==(null===(e=t[0])||void 0===e?void 0:e.upstream);return _.createElement("div",{className:$s},_.createElement("span",{className:ei}),_.createElement(Ls.Badge,{className:ti,variant:"dot",invisible:!s||0===this.props.nCommitsBehind,"data-test-id":"pull-badge"},_.createElement(st,{className:Qs,disabled:!s,icon:qe,onClick:s?this._onPullClick:void 0,title:s?this.props.trans.__("Pull latest changes")+(this.props.nCommitsBehind>0?this.props.trans.__(" (behind by %1 commits)",this.props.nCommitsBehind):""):this.props.trans.__("No remote repository defined")})),_.createElement(Ls.Badge,{className:ti,variant:"dot",invisible:!s||0===this.props.nCommitsAhead&&i,"data-test-id":"push-badge"},_.createElement(st,{className:Qs,disabled:!s,icon:Ke,onClick:s?this._onPushClick:void 0,title:s?i?this.props.trans.__("Push committed changes")+(this.props.nCommitsAhead>0?this.props.trans.__(" (ahead by %1 commits)",this.props.nCommitsAhead):""):this.props.trans.__("Publish branch"):this.props.trans.__("No remote repository defined")})),_.createElement(st,{className:Qs,icon:m.refreshIcon,onClick:this._onRefreshClick,title:this.props.trans.__("Refresh the repository to detect local and remote changes")}))}_renderRepoMenu(){const e=p.PathExt.basename(this.props.repository||p.PageConfig.getOption("serverRoot"))||"Jupyter Server Root";return _.createElement("div",{className:Vs},_.createElement("button",{disabled:!0,className:Zs,title:this.props.trans.__("Current repository: %1",p.PageConfig.getOption("serverRoot")+"/"+this.props.repository)},_.createElement(Ue.react,{className:Ks}),_.createElement("div",{className:Xs},_.createElement("p",{className:Ys},this.props.trans.__("Current Repository")),_.createElement("p",{className:Js},e))))}_renderBranchMenu(){return null===this.props.model.pathRepository?null:_.createElement("div",{className:Vs},_.createElement("button",{className:(0,Ne.classes)(Zs,qs),title:this.props.trans.__("Manage branches and tags"),onClick:this._onBranchClick},_.createElement(Le.react,{className:Ks}),_.createElement("div",{className:Xs},_.createElement("p",{className:Ys},this.props.trans.__("Current Branch")),_.createElement("p",{className:Js},this.props.currentBranch||"")),this.state.branchMenu?_.createElement(m.caretUpIcon.react,{className:Ks}):_.createElement(m.caretDownIcon.react,{className:Ks})),this.state.branchMenu?this._renderTabs():null)}_renderTabs(){return _.createElement(_.Fragment,null,_.createElement(Ls.Tabs,{classes:{root:xi,indicator:Fi},value:this.state.tab,onChange:(e,t)=>{this.setState({tab:t})}},_.createElement(Ls.Tab,{classes:{root:Ei,selected:Si},title:this.props.trans.__("View branches"),label:this.props.trans.__("Branches"),disableFocusRipple:!0,disableRipple:!0}),_.createElement(Ls.Tab,{classes:{root:Ei,selected:Si},title:this.props.trans.__("View tags"),label:this.props.trans.__("Tags"),disableFocusRipple:!0,disableRipple:!0})),0===this.state.tab?this._renderBranches():this._renderTags())}_renderBranches(){return _.createElement(hr,{currentBranch:this.props.currentBranch||"",branches:this.props.branches,branching:this.props.branching,commands:this.props.commands,logger:this.props.logger,model:this.props.model,trans:this.props.trans})}_renderTags(){return _.createElement(pr,{logger:this.props.logger,model:this.props.model,branching:this.props.branching,trans:this.props.trans})}}var gr=s(8463),ur=s(4697);function fr(e){return _.createElement(gr.Z,{classes:{root:nn},className:Ki,variant:"outlined"},_.createElement(ur.Z,{className:Xi,avatar:e.headerIcon,title:e.title,disableTypography:!0}),_.createElement(Ls.CardContent,{className:Yi},e.content))}var _r=s(4810);class br extends _.Component{constructor(e){super(e),this.refreshBranches=async()=>{this.setState({branches:this.props.model.branches})},this.refreshCurrentBranch=async()=>{const{currentBranch:e}=this.props.model;this.setState({currentBranch:e?e.name:"master",referenceCommit:null,challengerCommit:null})},this.refreshHistory=async()=>{if(null!==this.props.model.pathRepository){const e=await this.props.model.log(this.props.settings.composite.historyCount);let t=new Array;0===e.code&&(t=e.commits),this.setState({pastCommits:t})}},this.refreshView=async()=>{null!==this.props.model.pathRepository&&(await this.refreshBranches(),await this.refreshHistory())},this.commitFiles=async()=>{let e=this.state.commitSummary;if(this.state.commitDescription&&(e=e+"\n\n"+this.state.commitDescription+"\n"),!e&&!this.state.commitAmend)return;const t=this.props.settings.composite.simpleStaging?this._commitMarkedFiles:this._commitStagedFiles;try{this.state.commitAmend?await t(null):await t(e),this.setState({commitSummary:"",commitDescription:""})}catch(e){console.error(e)}},this._onTabChange=(e,t)=>{1===t&&this.refreshHistory(),this.setState({tab:t})},this._setCommitDescription=e=>{this.setState({commitDescription:e})},this._setCommitSummary=e=>{this.setState({commitSummary:e})},this._setCommitAmend=e=>{this.setState({commitAmend:e})},this._commitMarkedFiles=async e=>{this.props.logger.log({level:fe.RUNNING,message:this.props.trans.__("Staging files...")}),await this.props.model.reset(),await this.props.model.add(...this._markedFiles.map((e=>e.to))),await this._commitStagedFiles(e)},this._commitStagedFiles=async e=>{const t={level:fe.ERROR,message:this.props.trans.__("Failed to commit changes.")};try{await this._hasIdentity(this.props.model.pathRepository),this.props.logger.log({level:fe.RUNNING,message:this.props.trans.__("Committing changes...")}),this.state.commitAmend?await this.props.model.commit(null,!0):await this.props.model.commit(e),this.props.logger.log({level:fe.SUCCESS,message:this.props.trans.__("Committed changes.")});const t=this.props.model.branches.some((e=>e.is_remote_branch));this.props.settings.composite.commitAndPush&&t&&await this.props.commands.execute(be.gitPush)}catch(e){throw this.props.logger.log(Object.assign(Object.assign({},t),{error:e})),e}},this._previousRepoPath=null;const{branches:t,currentBranch:s,pathRepository:i,hasDirtyFiles:n}=e.model;this.state={branches:t,currentBranch:s?s.name:"master",files:[],remoteChangedFiles:[],nCommitsAhead:0,nCommitsBehind:0,pastCommits:[],repository:i,tab:0,commitSummary:"",commitDescription:"",commitAmend:!1,hasDirtyFiles:n,referenceCommit:null,challengerCommit:null}}componentDidMount(){const{model:e,settings:t}=this.props;e.repositoryChanged.connect(((e,t)=>{this.setState({repository:t.newValue,referenceCommit:null,challengerCommit:null}),this.refreshView()}),this),e.statusChanged.connect((async()=>{const t=await e.remoteChangedFiles();this.setState({files:e.status.files,remoteChangedFiles:t,nCommitsAhead:e.status.ahead,nCommitsBehind:e.status.behind})}),this),e.branchesChanged.connect((async()=>{await this.refreshBranches()}),this),e.headChanged.connect((async()=>{await this.refreshCurrentBranch(),1===this.state.tab&&this.refreshHistory()}),this),e.selectedHistoryFileChanged.connect((()=>{this.setState({tab:1}),this.refreshHistory()}),this),e.notifyRemoteChanges.connect(((e,t)=>{this.warningDialog(t)}),this),t.changed.connect(this.refreshView,this),e.dirtyFilesStatusChanged.connect(((e,t)=>{this.setState({hasDirtyFiles:t})}))}componentWillUnmount(){y.Signal.clearData(this)}render(){return _.createElement("div",{className:Ci},null!==this.state.repository?_.createElement(_.Fragment,null,this._renderToolbar(),this._renderMain()):this._renderWarning())}_renderToolbar(){const e=Boolean(this.props.settings.composite.disableBranchWithChanges&&(this._hasUnStagedFile()||this._hasStagedFile()));return _.createElement(mr,{currentBranch:this.state.currentBranch,branches:this.state.branches,branching:!e,commands:this.props.commands,logger:this.props.logger,model:this.props.model,nCommitsAhead:this.state.nCommitsAhead,nCommitsBehind:this.state.nCommitsBehind,repository:this.state.repository||"",trans:this.props.trans})}_renderMain(){return _.createElement(_.Fragment,null,this._renderTabs(),1===this.state.tab?this._renderHistory():this._renderChanges())}_renderTabs(){return _.createElement(vi.Z,{classes:{root:xi,indicator:Fi},value:this.state.tab,onChange:this._onTabChange},_.createElement(yi.Z,{classes:{root:Ei,selected:Si},title:this.props.trans.__("View changed files"),label:this.props.trans.__("Changes"),disableFocusRipple:!0,disableRipple:!0}),_.createElement(yi.Z,{classes:{root:Ei,selected:Si},title:this.props.trans.__("View commit history"),label:this.props.trans.__("History"),disableFocusRipple:!0,disableRipple:!0}))}_renderChanges(){const e=this.props.model.branches.some((e=>e.is_remote_branch)),t=this.props.settings.composite.commitAndPush&&e?this.state.commitAmend?this.props.trans.__("Commit (Amend) and Push"):this.props.trans.__("Commit and Push"):this.state.commitAmend?this.props.trans.__("Commit (Amend)"):this.props.trans.__("Commit"),s=this.props.trans.__("Warning"),i=this.props.settings.composite.simpleStaging,n=i?this.props.trans.__("You have unsaved tracked files. You probably want to save all changes before committing."):this.props.trans.__("You have unsaved staged files. You probably want to save and stage all needed changes before committing.");return _.createElement(_.Fragment,null,_.createElement(Mt,{files:this._sortedFiles,model:this.props.model,commands:this.props.commands,settings:this.props.settings,trans:this.props.trans}),_.createElement(cn,{commands:this.props.commands,hasFiles:i?this._markedFiles.length>0:this._hasStagedFile(),trans:this.props.trans,label:t,summary:this.state.commitSummary,description:this.state.commitDescription,amend:this.state.commitAmend,setSummary:this._setCommitSummary,setDescription:this._setCommitDescription,setAmend:this._setCommitAmend,onCommit:this.commitFiles,warning:this.state.hasDirtyFiles&&_.createElement(fr,{headerIcon:_.createElement(_r.WarningRounded,null),title:s,content:n})}))}_renderHistory(){return _.createElement(_.Fragment,null,_.createElement(or,{branches:this.state.branches,commits:this.state.pastCommits,model:this.props.model,commands:this.props.commands,trans:this.props.trans,referenceCommit:this.state.referenceCommit,challengerCommit:this.state.challengerCommit,onSelectForCompare:e=>async t=>{t.stopPropagation(),this.setState({referenceCommit:e},(()=>{this._openSingleFileComparison(t)}))},onCompareWithSelected:e=>async t=>{t.stopPropagation(),this.setState({challengerCommit:e},(()=>{this._openSingleFileComparison(t)}))}}),null===this.props.model.selectedHistoryFile&&(this.state.referenceCommit||this.state.challengerCommit)&&_.createElement(xn,{header:this.props.trans.__("Compare %1 and %2",this.state.referenceCommit?this.state.referenceCommit.commit.substring(0,7):"...",this.state.challengerCommit?this.state.challengerCommit.commit.substring(0,7):"..."),referenceCommit:this.state.referenceCommit,challengerCommit:this.state.challengerCommit,commands:this.props.commands,model:this.props.model,logger:this.props.logger,trans:this.props.trans,onClose:e=>{e.stopPropagation(),this.setState({referenceCommit:null,challengerCommit:null})},onOpenDiff:this.state.referenceCommit&&this.state.challengerCommit?xe(this.props.commands)(this.state.challengerCommit,this.state.referenceCommit):void 0}))}_renderWarning(){const e=this.props.filebrowser.path,{commands:t}=this.props;return _.createElement(_.Fragment,null,_.createElement("div",{className:wi},e?_.createElement(_.Fragment,null,_.createElement("b",{title:e},p.PathExt.basename(e))," ",this.props.trans.__("is not")):this.props.trans.__("You are not currently in"),this.props.trans.__(" a Git repository. To use Git, navigate to a local repository, initialize a repository here, or clone an existing repository.")),_.createElement("button",{className:ki,onClick:()=>t.execute("filebrowser:toggle-main")},this.props.trans.__("Open the FileBrowser")),_.createElement("button",{className:ki,onClick:()=>t.execute(be.gitInit)},this.props.trans.__("Initialize a Repository")),t.hasCommand(be.gitClone)&&_.createElement("button",{className:ki,onClick:async()=>{await t.execute(be.gitClone),await t.execute("filebrowser:toggle-main")}},this.props.trans.__("Clone a Repository")))}async _hasIdentity(e){if(e!==this._previousRepoPath)try{const t=(await this.props.model.config()).options,s=Object.keys(t);if(s.indexOf("user.name")<0||s.indexOf("user.email")<0){const e=await(0,n.showDialog)({title:this.props.trans.__("Who is committing?"),body:new Ri});if(!e.button.accept)throw new Error(this.props.trans.__("User refused to set identity."));const{name:t,email:s}=e.value;await this.props.model.config({"user.name":t,"user.email":s})}this._previousRepoPath=e}catch(e){if(e instanceof ue.GitResponseError)throw e;throw new Error(this.props.trans.__("Failed to set your identity. %1",e.message))}}_hasStagedFile(){return this.state.files.some((e=>"staged"===e.status||"partially-staged"===e.status))}_hasUnStagedFile(){return this.state.files.some((e=>"unstaged"===e.status||"partially-staged"===e.status))}get _markedFiles(){return this._sortedFiles.filter((e=>this.props.model.getMark(e.to)))}get _sortedFiles(){const{files:e,remoteChangedFiles:t}=this.state;let s=e;return t&&(s=s.concat(t)),s.sort(((e,t)=>e.to.localeCompare(t.to))),s}async warningDialog(e){const t=this.props.trans.__("One or more open files are behind %1 head. Do you want to pull the latest remote version?",this.props.model.status.remote),s=new n.Dialog({title:t,body:this._renderBody(e.notNotified,e.notified),buttons:[n.Dialog.cancelButton({label:this.props.trans.__("Continue Without Pulling")}),n.Dialog.warnButton({label:this.props.trans.__("Pull"),caption:this.props.trans.__("Git Pull from Remote Branch")})]});(await s.launch()).button.accept&&await this.props.commands.execute(be.gitPull,{})}_renderBody(e,t=[]){const s=e.map((e=>{console.log(e.to);const t=this.props.trans.__(e.to);return _.createElement("li",{key:t},t)}));let i=_.createElement("ul",null,s);if(t.length>0){const e=this.props.trans.__("The following open files remain behind:"),s=t.map((e=>{console.log(e.to);const t=this.props.trans.__(e.to);return _.createElement("li",{key:t},t)}));i=_.createElement("div",null,i,e,_.createElement("ul",null,s))}return _.createElement("div",null,i)}_openSingleFileComparison(e){this.props.model.selectedHistoryFile&&this.state.referenceCommit&&this.state.challengerCommit&&xe(this.props.commands)(this.state.challengerCommit,this.state.referenceCommit)(this.props.model.selectedHistoryFile.to,!this.props.model.selectedHistoryFile.is_binary)(e)}}const yr=(0,Ne.style)({display:"flex",flexDirection:"column",minWidth:"300px",color:"var(--jp-ui-font-color1)",background:"var(--jp-layout-color1)",fontSize:"var(--jp-ui-font-size1)"});class vr extends n.ReactWidget{constructor(e,t,s,i,n,r){super(r),this.node.id="GitSession-root",this.addClass(yr),this._trans=n,this._commands=s,this._fileBrowserModel=i,this._model=e,this._settings=t,e.refreshStandbyCondition=()=>!this._settings.composite.refreshIfHidden&&this.isHidden}onBeforeShow(e){this._model.refresh().catch((e=>{console.error("Fail to refresh model when displaying GitWidget.",e)})),super.onBeforeShow(e)}render(){return _.createElement(ri.ZP,{injectFirst:!0},_.createElement(hs.Consumer,null,(e=>_.createElement(_.Fragment,null,_.createElement(br,{commands:this._commands,filebrowser:this._fileBrowserModel,logger:e,model:this._model,settings:this._settings,trans:this._trans}),_.createElement(n.UseSignal,{signal:e.signal,initialArgs:{message:"",level:fe.INFO}},((e,t)=>(null==t?void 0:t.message)?_.createElement(bi,{log:t,settings:this._settings,trans:this._trans}):null))))))}}class Cr extends f.Widget{constructor(e){super({node:Cr.createFormNode(e)})}getValue(){return{url:encodeURIComponent(this.node.querySelector("#input-link").value.trim()),versioning:Boolean(encodeURIComponent(this.node.querySelector("#download").checked)),submodules:Boolean(encodeURIComponent(this.node.querySelector("#submodules").checked))}}static createFormNode(e){const t=document.createElement("div"),s=document.createElement("div"),i=document.createElement("label"),n=document.createElement("input"),r=document.createElement("span"),o=document.createElement("div"),a=document.createElement("label"),l=document.createElement("input"),c=document.createElement("label"),h=document.createElement("input");return t.className="jp-CredentialsBox",s.className="jp-RedirectForm",o.className="jp-CredentialsBox-wrapper",a.className="jp-CredentialsBox-label-checkbox",c.className="jp-CredentialsBox-label-checkbox",l.id="submodules",h.id="download",n.id="input-link",r.textContent=e.__("Enter the URI of the remote Git repository"),n.placeholder="https://host.com/org/repo.git",a.textContent=e.__("Include submodules"),a.title=e.__("If checked, the remote submodules in the repository will be cloned recursively"),l.setAttribute("type","checkbox"),l.setAttribute("checked","checked"),c.textContent=e.__("Download the repository"),c.title=e.__("If checked, the remote repository default branch will be downloaded instead of cloned"),h.setAttribute("type","checkbox"),i.appendChild(r),i.appendChild(n),s.append(i),a.prepend(l),o.appendChild(a),c.prepend(h),o.appendChild(c),t.appendChild(s),t.appendChild(o),t}}const wr={id:"@jupyterlab/git:clone",requires:[d.ITranslator,ge,o.IFileBrowserFactory],activate:(e,t,s,i)=>{const r=(t=t||d.nullTranslator).load("jupyterlab_git"),o=i.defaultBrowser,a=o.model;e.commands.addCommand(be.gitClone,{label:r.__("Clone a Repository"),caption:r.__("Clone a repository from a URL"),isEnabled:()=>null===s.pathRepository,execute:async()=>{const e=await(0,n.showDialog)({title:r.__("Clone a repo"),body:new Cr(r),focusNodeSelector:"input",buttons:[n.Dialog.cancelButton({label:r.__("Cancel")}),n.Dialog.okButton({label:r.__("Clone")})]});if(e.button.accept&&e.value.url){cs.log({level:fe.RUNNING,message:r.__("Cloning…")});try{const t=await Fs(s,Cs.Clone,r,{path:a.path,url:e.value.url,versioning:e.value.versioning,submodules:e.value.submodules});cs.log({message:r.__("Successfully cloned"),level:fe.SUCCESS,details:t}),await a.refresh()}catch(e){console.error("Encountered an error when cloning the repository. Error: ",e),cs.log({message:r.__("Failed to clone"),level:fe.ERROR,error:e})}}}}),ni(s,o,e.commands,r),Ss(s,o,e.contextMenu,r)},autoStart:!0},kr={id:"@jupyterlab/git:plugin",requires:[a.IMainMenu,i.ILayoutRestorer,o.IFileBrowserFactory,l.IRenderMimeRegistry,c.ISettingRegistry,r.IDocumentManager,h.IStatusBar,d.ITranslator],provides:ge,activate:async function(e,t,s,i,r,o,a,l,c){let h,b,y=null;const C=i.defaultBrowser,w=(c=c||d.nullTranslator).load("jupyterlab_git");try{h=await o.load(kr.id)}catch(e){console.error(w.__("Failed to load settings for the Git Extension.\n%1",e))}try{b=await async function(e){try{const e="settings"+p.URLExt.objectToQueryString({version:"0.41.0"});return await ve(e,"GET")}catch(t){if(t instanceof ue.GitResponseError){const s=t.response;if(404===s.status){const t=e.__("Git server extension is unavailable. Please ensure you have installed the JupyterLab Git server extension by running: pip install --upgrade jupyterlab-git. To confirm that the server extension is installed, run: jupyter server extension list.");throw new me.ServerConnection.ResponseError(s,t)}{const e=t.message;throw console.error("Failed to get the server extension settings",e),new me.ServerConnection.ResponseError(s,e)}}throw t}}(w);const{frontendVersion:e,gitVersion:t,serverVersion:s}=b;if(!t)throw new Error(w.__("git command not found - please ensure you have Git > 2 installed"));{const e=t.split(".");if(Number.parseInt(e[0])<2)throw new Error(w.__("git command version must be > 2; got %1.",t))}if(e&&e!==s)throw new Error(w.__("The versions of the JupyterLab Git server frontend and backend do not match. The @jupyterlab/git frontend extension has version: %1 while the python package has version %2. Please install identical version of jupyterlab-git Python package and the @jupyterlab/git extension. Try running: pip install --upgrade jupyterlab-git",e,s))}catch(e){return console.error(w.__("Failed to load the jupyterlab-git server extension settings"),e),(0,n.showErrorMessage)(w.__("Failed to load the jupyterlab-git server extension"),e.message,[n.Dialog.warnButton({label:w.__("Dismiss")})]),null}if(y=new Fe(a,e.docRegistry,h),Promise.all([e.restored,C.model.restored]).then((()=>{y.pathRepository=C.model.path})),C.model.pathChanged.connect(((e,t)=>{y.pathRepository=t.newValue,y.refreshBranch()})),y.headChanged.connect((()=>{C.model.refresh()})),e.serviceManager.contents.fileChanged.connect((()=>y.refreshStatus())),h){!function(e,t,s,i,r){const{commands:o,shell:a,serviceManager:l}=e,c=r.load("jupyterlab_git");function h(e){const t=e.map((e=>_.createElement("li",{key:e.to},_.createElement("b",null,e.to))));return _.createElement("ul",null,t)}o.addCommand(be.gitSubmitCommand,{label:c.__("Commit from the Commit Box"),caption:c.__("Submit the commit using the summary and description from commit box"),execute:()=>{},isVisible:()=>!1}),o.addCommand(be.gitTerminalCommand,{label:c.__("Open Git Repository in Terminal"),caption:c.__("Open a New Terminal to the Git Repository"),execute:async e=>{const s=await o.execute("terminal:create-new",e);try{return null!==t.pathRepository&&s.content.session.send({type:"stdin",content:[`cd "${t.pathRepository.split('"').join('\\"').split("`").join("\\`")}"\n`]}),s}catch(e){console.error(e),s.dispose()}},isEnabled:()=>null!==t.pathRepository&&e.serviceManager.terminals.isAvailable()}),o.addCommand(be.gitUI,{label:c.__("Git Interface"),caption:c.__("Go to Git user interface"),execute:()=>{try{a.activateById("jp-git-sessions")}catch(e){console.error("Fail to open Git tab.")}}}),o.addCommand(be.gitInit,{label:c.__("Initialize a Repository"),caption:c.__("Create an empty Git repository or reinitialize an existing one"),execute:async()=>{const e=s.path;if((await(0,n.showDialog)({title:c.__("Initialize a Repository"),body:c.__("Do you really want to make this directory a Git Repo?"),buttons:[n.Dialog.cancelButton({label:c.__("Cancel")}),n.Dialog.warnButton({label:c.__("Yes")})]})).button.accept){cs.log({message:c.__("Initializing…"),level:fe.RUNNING});try{await t.init(e),t.pathRepository=e,cs.log({message:c.__("Git repository initialized."),level:fe.SUCCESS})}catch(e){console.error(c.__("Encountered an error when initializing the repository. Error: "),e),cs.log({message:c.__("Failed to initialize the Git repository"),level:fe.ERROR,error:e})}}},isEnabled:()=>null===t.pathRepository}),o.addCommand(be.gitOpenUrl,{label:e=>c.__(e.text),execute:e=>{const t=e.url;window.open(t)}}),o.addCommand(be.gitToggleSimpleStaging,{label:c.__("Simple staging"),isToggled:()=>!!i.composite.simpleStaging,execute:e=>{i.set("simpleStaging",!i.composite.simpleStaging)}}),o.addCommand(be.gitToggleDoubleClickDiff,{label:c.__("Double click opens diff"),isToggled:()=>!!i.composite.doubleClickDiff,execute:e=>{i.set("doubleClickDiff",!i.composite.doubleClickDiff)}}),o.addCommand(be.gitManageRemote,{label:c.__("Manage Remote Repositories"),caption:c.__("Manage Remote Repositories"),isEnabled:()=>null!==t.pathRepository,execute:()=>{if(null===t.pathRepository)return void console.warn(c.__("Not in a Git repository. Unable to add a remote."));const e="git-dialog-ManageRemote";let s=document.querySelector(`#${e}`);s||(s=document.createElement("div"),s.id=e,document.body.appendChild(s));const i=n.ReactWidget.create(_.createElement(bs,{trans:c,model:t,onClose:()=>i.dispose()}));f.Widget.attach(i,s)}}),o.addCommand(be.gitOpenGitignore,{label:c.__("Open .gitignore"),caption:c.__("Open .gitignore"),isEnabled:()=>null!==t.pathRepository,execute:async()=>{await t.ensureGitignore()}}),o.addCommand(be.gitPush,{label:e=>e.advanced?c.__("Push to Remote (Advanced)"):c.__("Push to Remote"),caption:c.__("Push code to remote repository"),isEnabled:()=>null!==t.pathRepository,execute:async e=>{try{let s,i;if(e.advanced){const e=await(0,n.showDialog)({title:c.__("Please select push options."),body:new vs(c,t),buttons:[n.Dialog.cancelButton({label:c.__("Cancel")}),n.Dialog.okButton({label:c.__("Proceed")})]});if(!e.button.accept)return;s=e.value.remoteName,i=e.value.force}cs.log({level:fe.RUNNING,message:c.__("Pushing…")});const r=await Fs(t,i?Cs.ForcePush:Cs.Push,c,e={remote:s});cs.log({message:c.__("Successfully pushed"),level:fe.SUCCESS,details:r})}catch(e){if("CancelledError"===e.name)return cs.log({message:"",level:fe.INFO});console.error(c.__("Encountered an error when pushing changes. Error: "),e),cs.log({message:c.__("Failed to push"),level:fe.ERROR,error:e})}}}),o.addCommand(be.gitPull,{label:e=>e.force?c.__("Pull from Remote (Force)"):c.__("Pull from Remote"),caption:e=>e.force?c.__("Discard all current changes and pull from remote repository"):c.__("Pull latest code from remote repository"),isEnabled:()=>null!==t.pathRepository,execute:async e=>{try{e.force&&await Rt(t,c,e.fallback),cs.log({level:fe.RUNNING,message:c.__("Pulling…")});const s=await Fs(t,Cs.Pull,c);cs.log({message:c.__("Successfully pulled"),level:fe.SUCCESS,details:s})}catch(e){if("CancelledError"===e.name)return cs.log({message:"",level:fe.INFO});console.error("Encountered an error when pulling changes. Error: ",e),("string"==typeof e?e:e.message).toLowerCase().includes("your local changes to the following files would be overwritten by merge")?await o.execute(be.gitPull,{force:!0,fallback:!0}):e.cancelled?cs.log({message:"",level:fe.INFO}):cs.log({message:c.__("Failed to pull"),level:fe.ERROR,error:e})}}}),o.addCommand(be.gitResetToRemote,{label:c.__("Reset to Remote"),caption:c.__("Reset Current Branch to Remote State"),isEnabled:()=>null!==t.pathRepository,execute:async()=>{const e=await(0,n.showDialog)({title:c.__("Reset to Remote"),body:new ys(c.__("To bring the current branch to the state of its corresponding remote tracking branch,             a hard reset will be performed, which may result in some files being permanently deleted             and some changes being permanently discarded. Are you sure you want to proceed?             This action cannot be undone."),c.__("Close all opened files to avoid conflicts")),buttons:[n.Dialog.cancelButton({label:c.__("Cancel")}),n.Dialog.warnButton({label:c.__("Proceed")})]});if(e.button.accept)try{e.value.checked&&(cs.log({message:c.__("Closing all opened files..."),level:fe.RUNNING}),await s.manager.closeAll()),cs.log({message:c.__("Resetting..."),level:fe.RUNNING}),await t.resetToCommit(t.status.remote),cs.log({message:c.__("Successfully reset"),level:fe.SUCCESS,details:c.__("Successfully reset the current branch to its remote state")})}catch(e){console.error("Encountered an error when resetting the current branch to its remote state. Error: ",e),cs.log({message:c.__("Reset failed"),level:fe.ERROR,error:e})}}}),o.addCommand(be.gitShowDiff,{label:c.__("Show Diff"),caption:c.__("Display a file diff."),execute:async s=>{var i,o;const{model:h,isText:d,isPreview:m}=s,_=p.PathExt.join(null!==(i=h.repositoryPath)&&void 0!==i?i:"/",h.filename),b=null!==(o=Se(_))&&void 0!==o?o:d&&ae;if(b){const s=`git-diff-${_}-${h.reference.label}-${h.challenger.label}`,i=a.widgets("main");let o=i.next();for(;o;){if(o.id===s){a.activateById(s);break}o=i.next()}if(!o){const i=new f.Panel,d=new u.PromiseDelegate,y=o=new ks({content:i,reveal:d.promise,isPreview:m});y.id=s,y.title.label=p.PathExt.basename(h.filename),y.title.caption=_,y.title.icon=ze,y.title.closable=!0,y.title.className="jp-git-diff-title",y.addClass("jp-git-diff-parent-widget"),a.add(y,"main"),a.activateById(y.id);const v=e.shell._dockPanel;let C=-1;const w=(0,g.find)(v.tabBars(),(e=>(C=e.titles.indexOf(y.title),-1!==C)));ks.pinWidget(C,w,y);try{const e=await b(h,y.toolbar,r);if(y.toolbar.addItem("spacer",n.Toolbar.createSpacerItem()),h.hasConflict){const s=new n.ToolbarButton({label:c.__("Mark as resolved"),onClick:async()=>{var s;if(e.isFileResolved||(await(0,n.showDialog)({title:c.__("Resolve with conflicts"),body:c.__("Are you sure you want to mark this file as resolved with merge conflicts?")})).button.accept)try{await l.contents.save(_,await e.getResolvedFile()),await t.add(h.filename),await t.refresh()}catch(e){cs.log({message:null!==(s=e.message)&&void 0!==s?s:e,level:fe.ERROR})}finally{y.dispose()}},tooltip:c.__("Mark file as resolved"),className:"jp-git-diff-resolve"});y.toolbar.addItem("resolve",s)}else{const t=new n.ToolbarButton({label:c.__("Refresh"),onClick:async()=>{await e.refresh(),t.hide()},tooltip:c.__("Refresh diff widget"),className:"jp-git-diff-refresh"});t.hide(),y.toolbar.addItem("refresh",t);const s=()=>{t.show()};h.changed.connect(s),e.disposed.connect((()=>h.changed.disconnect(s)))}d.resolve(),i.addWidget(e)}catch(e){console.error(e);const t=`Load Diff Model Error (${e.message||e})`;d.reject(t)}if(h.challenger.source===ue.Diff.SpecialRef.INDEX||h.challenger.source===ue.Diff.SpecialRef.WORKING||h.reference.source===ue.Diff.SpecialRef.INDEX||h.reference.source===ue.Diff.SpecialRef.WORKING){const e=(s,i)=>{const n=i.files.find((e=>h.filename===e.from));n&&"unmodified"!==n.status||(t.statusChanged.disconnect(e),o.dispose())};t.statusChanged.connect(e)}}return o}return await(0,n.showErrorMessage)(c.__("Diff Not Supported"),c.__("Diff is not supported for %1 files.",p.PathExt.extname(h.filename).toLocaleLowerCase())),null},icon:ze.bindprops({stylesheet:"menuItem"})}),o.addCommand(be.gitMerge,{label:c.__("Merge Branch…"),caption:c.__("Merge selected branch in the current branch"),execute:async e=>{let{branch:s}=null!=e?e:{};if(!s){const e=t.branches.filter((e=>!e.is_current_branch&&!e.is_remote_branch)),i="git-dialog-MergeBranch";let r=document.querySelector(`#${i}`);r||(r=document.createElement("div"),r.id=i,document.body.appendChild(r));const o=new u.PromiseDelegate,a=n.ReactWidget.create(_.createElement(ls,{currentBranch:t.currentBranch.name,branches:e,onClose:e=>{a.dispose(),o.resolve(null!=e?e:null)},trans:c}));f.Widget.attach(a,r),s=await o.promise}if(s){cs.log({level:fe.RUNNING,message:c.__("Merging branch '%1'…",s)});try{await t.merge(s)}catch(e){return void cs.log({level:fe.ERROR,message:c.__("Failed to merge branch '%1' into '%2'.",s,t.currentBranch.name),error:e})}cs.log({level:fe.SUCCESS,message:c.__("Branch '%1' merged into '%2'.",s,t.currentBranch.name)})}},isEnabled:()=>t.branches.some((e=>!e.is_current_branch&&!e.is_remote_branch))}),o.addCommand(_e.gitFileOpen,{label:c.__("Open"),caption:xs(c.__("Open selected file"),c.__("Open selected files")),execute:async e=>{const{files:s}=e;for(const e of s){const{x:s,y:i,to:r}=e;if("D"===s||"D"===i)return void await(0,n.showErrorMessage)(c.__("Open File Failed"),c.__("This file has been deleted!"));try{"/"!==r[r.length-1]?o.execute("docmanager:open",{path:t.getRelativeFilePath(r)}):console.log("Cannot open a folder here")}catch(e){console.error(`Fail to open ${r}.`)}}},icon:Ze.bindprops({stylesheet:"menuItem"})}),o.addCommand(_e.openFileFromDiff,{label:c.__("Open File"),caption:c.__("Open file from its diff view"),execute:async s=>{const i=e.contextMenuHitTest((e=>{const t=e.dataset.id;return t&&"git-diff"===t.substring(0,8)}));if(!i)return;const n=(0,g.toArray)(a.widgets("main")).filter((e=>e.id===i.dataset.id));if(0===n.length)return;const r=n[0].content.widgets[0].model,l=r.filename;if(r.reference.source===ue.Diff.SpecialRef.INDEX||r.reference.source===ue.Diff.SpecialRef.WORKING||r.challenger.source===ue.Diff.SpecialRef.INDEX||r.challenger.source===ue.Diff.SpecialRef.WORKING){const e=t.status.files.find((e=>e.from===l));e&&o.execute(_e.gitFileOpen,{files:[e]})}else o.execute("docmanager:open",{path:t.getRelativeFilePath(l)})}}),o.addCommand(_e.gitFileDiff,{label:c.__("Diff"),caption:xs(c.__("Diff selected file"),c.__("Diff selected files")),execute:async s=>{const{files:i}=s;for(const s of i){const{context:i,filePath:n,previousFilePath:r,isText:a,status:l,isPreview:h}=s;if("untracked"===l)continue;const d=t.pathRepository,m=n,g=p.PathExt.join(d,m),u="staged"===l?ue.Diff.SpecialRef.INDEX:ue.Diff.SpecialRef.WORKING,f="unmerged"===l?{currentRef:"MERGE_HEAD",previousRef:"HEAD",baseRef:ue.Diff.SpecialRef.BASE}:null!=i?i:{currentRef:u,previousRef:"HEAD"},_=ue.Diff.SpecialRef[f.currentRef]?{special:ue.Diff.SpecialRef[f.currentRef]}:{git:f.currentRef},b={challenger:{content:async()=>ve(p.URLExt.join(d,"content"),"POST",{filename:m,reference:_}).then((e=>e.content)),label:ue.Diff.SpecialRef[f.currentRef]||f.currentRef,source:f.currentRef,updateAt:Date.now()},filename:m,reference:{content:async()=>ve(p.URLExt.join(d,"content"),"POST",{filename:null!=r?r:m,reference:{git:f.previousRef}}).then((e=>e.content)),label:ue.Diff.SpecialRef[f.previousRef]||f.previousRef,source:f.previousRef,updateAt:Date.now()},repositoryPath:d};r&&(b.reference.label=`${r} (${b.reference.label.slice(0,7)})`,b.challenger.label=`${n} (${b.challenger.label.slice(0,7)})`),f.baseRef&&(b.reference.label=c.__("Current"),b.challenger.label=c.__("Incoming"),b.base={content:async()=>ve(p.URLExt.join(d,"content"),"POST",{filename:m,reference:{special:ue.Diff.SpecialRef[f.baseRef]}}).then((e=>e.content)),label:c.__("Result"),source:f.baseRef,updateAt:Date.now()});const y=new v(b),C=await o.execute(be.gitShowDiff,{model:y,isText:a,isPreview:h});if(C){if("HEAD"===f.previousRef){const e=()=>{y.reference=Object.assign(Object.assign({},y.reference),{updateAt:Date.now()})};t.headChanged.connect(e),C.disposed.connect((()=>{t.headChanged.disconnect(e)}))}if(f.currentRef===ue.Diff.SpecialRef.WORKING){const t=(e,t)=>{const s=new Date(t.newValue.last_modified).valueOf();t.newValue.path===g&&y.challenger.updateAt!==s&&(y.challenger=Object.assign(Object.assign({},y.challenger),{updateAt:s}))};e.serviceManager.contents.fileChanged.connect(t),C.disposed.connect((()=>{e.serviceManager.contents.fileChanged.disconnect(t)}))}}}},icon:ze.bindprops({stylesheet:"menuItem"})}),o.addCommand(_e.gitFileAdd,{label:c.__("Add"),caption:xs(c.__("Stage or track the changes to selected file"),c.__("Stage or track the changes of selected files")),execute:async e=>{const{files:s}=e;for(const e of s)await t.add(e.to)},icon:Oe.bindprops({stylesheet:"menuItem"})}),o.addCommand(_e.gitFileStage,{label:c.__("Stage"),caption:xs(c.__("Stage the changes of selected file"),c.__("Stage the changes of selected files")),execute:async e=>{const{files:s}=e;for(const e of s)await t.add(e.to)},icon:Oe.bindprops({stylesheet:"menuItem"})}),o.addCommand(_e.gitFileTrack,{label:c.__("Track"),caption:xs(c.__("Start tracking selected file"),c.__("Start tracking selected files")),execute:async e=>{const{files:s}=e;for(const e of s)await t.add(e.to)},icon:Oe.bindprops({stylesheet:"menuItem"})}),o.addCommand(_e.gitFileUnstage,{label:c.__("Unstage"),caption:xs(c.__("Unstage the changes of selected file"),c.__("Unstage the changes of selected files")),execute:async e=>{const{files:s}=e;for(const e of s)"D"!==e.x&&await t.reset(e.to)},icon:Xe.bindprops({stylesheet:"menuItem"})}),o.addCommand(_e.gitFileDelete,{label:c.__("Delete"),caption:xs(c.__("Delete this file"),c.__("Delete these files")),execute:async s=>{const{files:i}=s,r=h(i);if((await(0,n.showDialog)({title:c.__("Delete Files"),body:_.createElement("span",null,c.__("Are you sure you want to permanently delete the following files?               This action cannot be undone."),r),buttons:[n.Dialog.cancelButton({label:c.__("Cancel")}),n.Dialog.warnButton({label:c.__("Delete")})]})).button.accept)for(const s of i)try{await e.commands.execute("docmanager:delete-file",{path:t.getRelativeFilePath(s.to)})}catch(e){(0,n.showErrorMessage)(c.__("Deleting %1 failed.",s.to),e,[n.Dialog.warnButton({label:c.__("Dismiss")})])}},icon:m.closeIcon.bindprops({stylesheet:"menuItem"})}),o.addCommand(_e.gitFileDiscard,{label:c.__("Discard"),caption:xs(c.__("Discard recent changes of selected file"),c.__("Discard recent changes of selected files")),execute:async e=>{const{files:s}=e,i=h(s);if((await(0,n.showDialog)({title:c.__("Discard changes"),body:_.createElement("span",null,c.__("Are you sure you want to permanently discard changes to the following files?               This action cannot be undone."),i),buttons:[n.Dialog.cancelButton({label:c.__("Cancel")}),n.Dialog.warnButton({label:c.__("Discard")})]})).button.accept)for(const e of s)try{"staged"!==e.status&&"partially-staged"!==e.status||await t.reset(e.to),("unstaged"===e.status||"partially-staged"===e.status&&"A"!==e.x)&&await t.checkout({filename:e.to})}catch(t){(0,n.showErrorMessage)(c.__("Discard changes for %1 failed.",e.to),t,[n.Dialog.warnButton({label:c.__("Dismiss")})])}},icon:We.bindprops({stylesheet:"menuItem"})}),o.addCommand(_e.gitIgnore,{label:xs(c.__("Ignore this file (add to .gitignore)"),c.__("Ignore these files (add to .gitignore)")),caption:xs(c.__("Ignore this file (add to .gitignore)"),c.__("Ignore these files (add to .gitignore)")),execute:async e=>{const{files:s}=e;for(const e of s)e&&await t.ignore(e.to,!1)}}),o.addCommand(_e.gitIgnoreExtension,{label:e=>{const{files:t}=e,s=t.map((e=>p.PathExt.extname(e.to))).filter((e=>e.length>0)).filter(((e,t,s)=>s.indexOf(e)===t));return c._n("Ignore %2 extension (add to .gitignore)","Ignore %2 extensions (add to .gitignore)",s.length,s.join(", "))},caption:xs(c.__("Ignore this file extension (add to .gitignore)"),c.__("Ignore these files extension (add to .gitignore)")),execute:async e=>{const{files:s}=e;for(const e of s)if(e){const s=p.PathExt.extname(e.to);s.length>0&&(await(0,n.showDialog)({title:c.__("Ignore file extension"),body:c.__("Are you sure you want to ignore all %1 files within this git repository?",s),buttons:[n.Dialog.cancelButton(),n.Dialog.okButton({label:c.__("Ignore")})]})).button.label===c.__("Ignore")&&await t.ignore(e.to,!0)}},isVisible:e=>{const{files:t}=e;return t.some((e=>p.PathExt.extname(e.to).length>0))}}),o.addCommand(_e.gitFileHistory,{label:c.__("History"),caption:c.__("View the history of this file"),execute:e=>{const{files:s}=e,i=s[0];i&&(t.selectedHistoryFile=i,a.activateById("jp-git-sessions"))},isEnabled:e=>{const{files:t}=e;return 1===t.length},icon:$e.bindprops({stylesheet:"menuItem"})}),o.addCommand(_e.gitNoAction,{label:c.__("No actions available"),isEnabled:()=>!1,execute:()=>{}})}(e,y,C.model,h,c);const i=new vr(y,h,e.commands,C.model,w);i.id="jp-git-sessions",i.title.icon=Ie,i.title.caption="Git",s.add(i,"git-sessions"),e.shell.add(i,"left",{rank:200}),e.version.split(".").slice(0,2).join(".")<"3.1"&&t.addMenu(function(e,t){const s=[{text:t.__("Set Up Remotes"),url:"https://www.atlassian.com/git/tutorials/setting-up-a-repository"},{text:t.__("Git Documentation"),url:"https://git-scm.com/doc"}],i=new f.Menu({commands:e});i.title.label=t.__("Git"),[be.gitInit,be.gitClone,be.gitMerge,be.gitPush,be.gitPull,be.gitResetToRemote,be.gitManageRemote,be.gitTerminalCommand].forEach((e=>{i.addItem({command:e}),e===be.gitPush&&i.addItem({command:e,args:{advanced:!0}}),e===be.gitPull&&i.addItem({command:e,args:{force:!0}})})),i.addItem({type:"separator"}),i.addItem({command:be.gitToggleSimpleStaging}),i.addItem({command:be.gitToggleDoubleClickDiff}),i.addItem({type:"separator"}),i.addItem({command:be.gitOpenGitignore}),i.addItem({type:"separator"});const n=new f.Menu({commands:e});return n.title.label=t.__(" Help "),s.map((e=>{n.addItem({args:e,command:be.gitOpenUrl})})),i.addItem({type:"submenu",submenu:n}),i}(e.commands,w),{rank:60}),ni(y,C,e.commands,w),function(e,t,s,i){const n=new si(t,i);e.registerStatusItem("git-status",{align:"left",item:n,isActive:ii.isStatusWidgetActive(s),activeStateChanged:s&&s.changed});const r=ii.createEventCallback(n);t.taskChanged.connect(r),n.disposed.connect((()=>{t.taskChanged.disconnect(r)}))}(l,y,h,w),Ss(y,C,e.contextMenu,w)}return y.registerDiffProvider("Nbdime",[".ipynb"],((e,t,s)=>(async(e,t,s,i)=>{const n=i.load("jupyterlab_git"),r=new Is(e,t,n);if(r.addClass("jp-git-diff-root"),await r.ready,s){const t=document.createElement("input"),i=document.createElement("label");t.className="nbdime-hide-unchanged",t.type="checkbox",t.checked=!0,i.appendChild(t),i.appendChild(document.createElement("span")).textContent=n.__("Hide unchanged cells"),s.addItem("hideUnchanged",new f.Widget({node:i})),e.hasConflict&&s.addItem("clear-outputs",r.nbdimeWidget.widgets[0]),r.areUnchangedCellsHidden=t.checked,t.onchange=()=>{r.areUnchangedCellsHidden=t.checked}}return r})(e,r,t,s))),y},autoStart:!0},xr=[kr,wr]}}]);